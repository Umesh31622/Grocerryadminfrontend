{"ast":null,"code":"var _jsxFileName = \"E:\\\\infyle\\\\Grocerry_final\\\\frontend\\\\src\\\\pages\\\\PriceList.jsx\",\n  _s = $RefreshSig$();\n// // import React, { useEffect, useState, useRef } from \"react\";\n// // import axios from \"axios\";\n// // import \"./PriceList.css\";\n\n// // const API_URL = \"https://grocerrybackend.vercel.app/api/prices\";\n// // const CATEGORY_URL = \"https://grocerrybackend.vercel.app/api/categories\";\n\n// // export default function PriceList() {\n// //   // DATA\n// //   const [items, setItems] = useState([]);\n// //   const [categories, setCategories] = useState([]);\n// //   const [subcategories, setSubcategories] = useState([]);\n\n// //   // UI state\n// //   const [isMobile, setIsMobile] = useState(window.innerWidth < 768);\n// //   const [search, setSearch] = useState(\"\");\n// //   const [loading, setLoading] = useState(false);\n\n// //   // FORM state\n// //   const [form, setForm] = useState({\n// //     name: \"\",\n// //     category: \"\",\n// //     subcategory: \"\",\n// //     description: \"\",\n// //     basePrice: \"\",\n// //     difference: \"\",\n// //     validTill: \"\",\n// //     file: null,\n// //   });\n\n// //   const [editId, setEditId] = useState(null);\n// //   const [isCopyMode, setIsCopyMode] = useState(false);\n\n// //   // category/subcategory add UI\n// //   const [addingCategory, setAddingCategory] = useState(false);\n// //   const [newCategoryName, setNewCategoryName] = useState(\"\");\n// //   const [newCategoryImage, setNewCategoryImage] = useState(null);\n// //   const [newCategoryPreview, setNewCategoryPreview] = useState(null);\n\n// //   const [addingSub, setAddingSub] = useState(false);\n// //   const [newSubName, setNewSubName] = useState(\"\");\n// //   const [newSubImage, setNewSubImage] = useState(null);\n// //   const [newSubPreview, setNewSubPreview] = useState(null);\n\n// //   // bulk\n// //   const [selectedItems, setSelectedItems] = useState([]);\n// //   const [bulkMode, setBulkMode] = useState(false);\n\n// //   // csv import\n// //   const [csvFile, setCsvFile] = useState(null);\n// //   const csvInputRef = useRef();\n\n// //   // pagination\n// //   const [currentPage, setCurrentPage] = useState(1);\n// //   const itemsPerPage = 30;\n\n// //   // -------------------- FETCH --------------------\n// //   useEffect(() => {\n// //     fetchItems();\n// //     fetchCategories();\n\n// //     const handleResize = () => setIsMobile(window.innerWidth < 768);\n// //     window.addEventListener(\"resize\", handleResize);\n// //     return () => window.removeEventListener(\"resize\", handleResize);\n// //     // eslint-disable-next-line\n// //   }, []);\n\n// //   const fetchItems = async () => {\n// //     try {\n// //       setLoading(true);\n// //       const res = await axios.get(API_URL);\n// //       if (res.data && res.data.success) setItems(res.data.data || []);\n// //     } catch (err) {\n// //       console.error(\"Fetch items error\", err);\n// //       alert(\"Could not fetch items\");\n// //     } finally {\n// //       setLoading(false);\n// //     }\n// //   };\n\n// //   const fetchCategories = async () => {\n// //     try {\n// //       const res = await axios.get(CATEGORY_URL);\n// //       if (res.data && res.data.success) setCategories(res.data.categories || []);\n// //     } catch (err) {\n// //       console.error(\"Fetch categories error\", err);\n// //       alert(\"Could not fetch categories\");\n// //     }\n// //   };\n\n// //   // -------------------- SUBCATEGORY AUTO LOAD --------------------\n// //   useEffect(() => {\n// //     if (!form.category) {\n// //       setSubcategories([]);\n// //       setForm((prev) => ({ ...prev, subcategory: \"\" }));\n// //       return;\n// //     }\n\n// //     const cat = categories.find((c) => c._id === form.category);\n// //     const subs = (cat && cat.subcategories) || [];\n// //     setSubcategories(subs);\n\n// //     // keep current subcategory if exists in new subs, otherwise reset\n// //     const exists = subs.some((s) => s._id === form.subcategory);\n// //     if (!exists) setForm((prev) => ({ ...prev, subcategory: \"\" }));\n// //   }, [form.category, categories]);\n\n// //   // -------------------- CREATE CATEGORY --------------------\n// //   const handleCreateCategory = async () => {\n// //     if (!newCategoryName.trim()) return alert(\"Enter category name\");\n// //     try {\n// //       const fd = new FormData();\n// //       fd.append(\"name\", newCategoryName.trim());\n// //       if (newCategoryImage) fd.append(\"image\", newCategoryImage);\n\n// //       const res = await axios.post(CATEGORY_URL, fd);\n// //       if (res.data && res.data.success) {\n// //         alert(\"Category created\");\n// //         setNewCategoryName(\"\");\n// //         setNewCategoryImage(null);\n// //         setNewCategoryPreview(null);\n// //         setAddingCategory(false);\n// //         fetchCategories();\n// //       } else {\n// //         alert(\"Category creation failed\");\n// //       }\n// //     } catch (err) {\n// //       console.error(\"Create category error\", err);\n// //       alert(\"Category creation failed\");\n// //     }\n// //   };\n\n// //   // -------------------- CREATE SUBCATEGORY --------------------\n// //   const handleCreateSub = async () => {\n// //     if (!newSubName.trim()) return alert(\"Enter subcategory name\");\n// //     if (!form.category) return alert(\"Select category first\");\n\n// //     try {\n// //       const fd = new FormData();\n// //       fd.append(\"name\", newSubName.trim());\n// //       if (newSubImage) fd.append(\"image\", newSubImage);\n\n// //       const res = await axios.post(`${CATEGORY_URL}/${form.category}/sub`, fd);\n// //       if (res.data && res.data.success) {\n// //         alert(\"Subcategory created\");\n// //         setNewSubName(\"\");\n// //         setNewSubImage(null);\n// //         setNewSubPreview(null);\n// //         setAddingSub(false);\n// //         fetchCategories();\n// //       } else {\n// //         alert(\"Subcategory creation failed\");\n// //       }\n// //     } catch (err) {\n// //       console.error(\"Create sub error\", err);\n// //       alert(\"Subcategory creation failed\");\n// //     }\n// //   };\n\n// //   // -------------------- FORM HANDLING --------------------\n// //   const handleChange = (e) => {\n// //     const { name, value, files } = e.target;\n// //     if (files && files.length) {\n// //       // file input (both image for product and category/sub)\n// //       setForm((p) => ({ ...p, file: files[0] }));\n// //     } else {\n// //       setForm((p) => ({ ...p, [name]: value }));\n// //     }\n// //   };\n\n// //   // -------------------- SUBMIT (ADD / UPDATE / COPY) --------------------\n// //   const handleSubmit = async (e) => {\n// //     e.preventDefault();\n// //     setLoading(true);\n\n// //     try {\n// //       if (!form.name || !form.category || !form.basePrice) {\n// //         alert(\"Name, category & base price are required\");\n// //         setLoading(false);\n// //         return;\n// //       }\n\n// //       const fd = new FormData();\n// //       // append all keys (including 0 or empty string when necessary)\n// //       Object.keys(form).forEach((k) => {\n// //         const val = form[k];\n// //         if (val !== undefined && val !== null) {\n// //           fd.append(k, val);\n// //         }\n// //       });\n\n// //       let res;\n// //       if (isCopyMode) {\n// //         res = await axios.post(API_URL, fd);\n// //         alert(\"Copied as new item\");\n// //       } else if (editId) {\n// //         res = await axios.put(`${API_URL}/${editId}`, fd);\n// //         alert(\"Updated\");\n// //       } else {\n// //         res = await axios.post(API_URL, fd);\n// //         alert(\"Added\");\n// //       }\n\n// //       // refresh\n// //       await fetchItems();\n// //       await fetchCategories();\n\n// //       // reset\n// //       setForm({\n// //         name: \"\",\n// //         category: \"\",\n// //         subcategory: \"\",\n// //         description: \"\",\n// //         basePrice: \"\",\n// //         difference: \"\",\n// //         validTill: \"\",\n// //         file: null,\n// //       });\n// //       setEditId(null);\n// //       setIsCopyMode(false);\n// //     } catch (err) {\n// //       console.error(\"Save error\", err);\n// //       alert(\"Save failed\");\n// //     } finally {\n// //       setLoading(false);\n// //     }\n// //   };\n\n// //   // -------------------- EDIT --------------------\n// //   const handleEdit = (item) => {\n// //     setForm({\n// //       name: item.name || \"\",\n// //       category: item.category?._id?.toString() || \"\",\n// //       subcategory: item.subcategory?._id?.toString() || \"\",\n// //       description: item.description || \"\",\n// //       basePrice: item.basePrice ?? \"\",\n// //       difference: item.difference ?? \"\",\n// //       validTill: item.validTill ? item.validTill.split(\"T\")[0] : \"\",\n// //       file: null,\n// //     });\n\n// //     // preload subs for better UX\n// //     const cat = categories.find((c) => c._id === item.category?._id);\n// //     setSubcategories(cat?.subcategories || []);\n\n// //     setEditId(item._id);\n// //     setIsCopyMode(false);\n// //     window.scrollTo({ top: 0, behavior: \"smooth\" });\n// //   };\n\n// //   // -------------------- COPY --------------------\n// //   const handleCopyToEdit = (item) => {\n// //     setForm({\n// //       name: item.name || \"\",\n// //       category: item.category?._id?.toString() || \"\",\n// //       subcategory: item.subcategory?._id?.toString() || \"\",\n// //       description: item.description || \"\",\n// //       basePrice: item.basePrice ?? \"\",\n// //       difference: item.difference ?? \"\",\n// //       validTill: item.validTill ? item.validTill.split(\"T\")[0] : \"\",\n// //       file: null,\n// //     });\n\n// //     const cat = categories.find((c) => c._id === item.category?._id);\n// //     setSubcategories(cat?.subcategories || []);\n\n// //     setEditId(null);\n// //     setIsCopyMode(true);\n// //     window.scrollTo({ top: 0, behavior: \"smooth\" });\n// //   };\n\n// //   // -------------------- DELETE --------------------\n// //   const handleDelete = async (id) => {\n// //     if (!window.confirm(\"Delete item?\")) return;\n// //     try {\n// //       await axios.delete(`${API_URL}/${id}`);\n// //       setItems((prev) => prev.filter((x) => x._id !== id));\n// //       setSelectedItems((prev) => prev.filter((x) => x !== id));\n// //     } catch (err) {\n// //       console.error(\"Delete error\", err);\n// //       alert(\"Delete failed\");\n// //     }\n// //   };\n\n// //   // -------------------- STATUS TOGGLE --------------------\n// //   const handleStatusToggle = async (item) => {\n// //     try {\n// //       const newStatus = item.status === \"active\" ? \"inactive\" : \"active\";\n// //       await axios.put(`${API_URL}/status/${item._id}`, { status: newStatus });\n// //       setItems((prev) => prev.map((x) => (x._id === item._id ? { ...x, status: newStatus } : x)));\n// //     } catch (err) {\n// //       console.error(\"Status toggle error\", err);\n// //       alert(\"Status update failed\");\n// //     }\n// //   };\n\n// //   // -------------------- BULK --------------------\n// //   const handleBulkDelete = async () => {\n// //     if (!selectedItems.length) return alert(\"No items selected\");\n// //     if (!window.confirm(\"Delete selected items?\")) return;\n\n// //     try {\n// //       await Promise.all(selectedItems.map((id) => axios.delete(`${API_URL}/${id}`)));\n// //       setSelectedItems([]);\n// //       fetchItems();\n// //       setBulkMode(false);\n// //     } catch (err) {\n// //       console.error(\"Bulk delete error\", err);\n// //       alert(\"Bulk delete failed\");\n// //     }\n// //   };\n\n// //   const updateLocalItemField = (id, key, value) => {\n// //     setItems((prev) => prev.map((x) => (x._id === id ? { ...x, [key]: value } : x)));\n// //   };\n\n// //   const handleBulkSave = async () => {\n// //     if (!selectedItems.length) return alert(\"No items selected for bulk save\");\n\n// //     const updates = items\n// //       .filter((x) => selectedItems.includes(x._id))\n// //       .map((x) => ({\n// //         id: x._id,\n// //         name: x.name,\n// //         basePrice: x.basePrice,\n// //         difference: x.difference,\n// //         validTill: x.validTill,\n// //       }));\n\n// //     try {\n// //       await axios.post(`${API_URL}/bulk-update`, { products: updates });\n// //       setBulkMode(false);\n// //       setSelectedItems([]);\n// //       fetchItems();\n// //     } catch (err) {\n// //       console.error(\"Bulk save error\", err);\n// //       alert(\"Bulk save failed\");\n// //     }\n// //   };\n\n// //   // -------------------- CSV IMPORT/EXPORT --------------------\n// //   const handleCsvSelect = (e) => {\n// //     setCsvFile(e.target.files[0]);\n// //   };\n\n// //   const handleImportCsv = async () => {\n// //     if (!csvFile) return alert(\"Select CSV file\");\n// //     try {\n// //       const fd = new FormData();\n// //       fd.append(\"file\", csvFile);\n// //       const res = await axios.post(`${API_URL}/import`, fd);\n// //       if (res.data && res.data.success) {\n// //         alert(`Imported ${res.data.inserted || 0} items`);\n// //         setCsvFile(null);\n// //         if (csvInputRef.current) csvInputRef.current.value = null;\n// //         fetchItems();\n// //       } else {\n// //         alert(\"CSV import failed\");\n// //       }\n// //     } catch (err) {\n// //       console.error(\"CSV import error\", err);\n// //       alert(\"CSV import failed\");\n// //     }\n// //   };\n\n// //   const handleExportCsv = async () => {\n// //     try {\n// //       const res = await axios.get(`${API_URL}/export`, { responseType: \"blob\" });\n// //       const url = window.URL.createObjectURL(new Blob([res.data]));\n// //       const a = document.createElement(\"a\");\n// //       a.href = url;\n// //       a.download = \"prices.csv\";\n// //       a.click();\n// //       URL.revokeObjectURL(url);\n// //     } catch (err) {\n// //       console.error(\"CSV export error\", err);\n// //       alert(\"CSV export failed\");\n// //     }\n// //   };\n\n// //   const handleExportSelectedCsv = () => {\n// //     if (!selectedItems.length) return alert(\"Select items to export\");\n\n// //     const selectedData = items.filter((x) => selectedItems.includes(x._id));\n// //     const header = [\n// //       \"id\",\n// //       \"name\",\n// //       \"categoryName\",\n// //       \"subcategoryName\",\n// //       \"basePrice\",\n// //       \"difference\",\n// //       \"finalPrice\",\n// //       \"status\",\n// //       \"validTill\",\n// //       \"description\",\n// //       \"imageUrl\",\n// //     ];\n\n// //     const rows = selectedData.map((p) => [\n// //       p._id,\n// //       p.name || \"\",\n// //       p.category?.name || \"\",\n// //       p.subcategory?.name || \"\",\n// //       p.basePrice ?? \"\",\n// //       p.difference ?? \"\",\n// //       (Number(p.basePrice) + Number(p.difference || 0)) || \"\",\n// //       p.status || \"\",\n// //       p.validTill ? new Date(p.validTill).toISOString().split(\"T\")[0] : \"\",\n// //       p.description || \"\",\n// //       p.image || \"\",\n// //     ]);\n\n// //     const csvArray = [header, ...rows];\n// //     const csvContent =\n// //       \"data:text/csv;charset=utf-8,\" +\n// //       csvArray.map((r) => r.map((c) => `\"${String(c).replace(/\"/g, '\"\"')}\"`).join(\",\")).join(\"\\n\");\n\n// //     const encodedUri = encodeURI(csvContent);\n// //     const link = document.createElement(\"a\");\n// //     link.href = encodedUri;\n// //     link.download = `selected_prices_${Date.now()}.csv`;\n// //     link.click();\n// //   };\n\n// //   // -------------------- SEARCH & PAGINATION --------------------\n// //   const filteredItems = items.filter((item) => {\n// //     const t = search.toLowerCase();\n// //     return (\n// //       (item.name || \"\").toString().toLowerCase().includes(t) ||\n// //       (item.category?.name || \"\").toLowerCase().includes(t) ||\n// //       (item.subcategory?.name || \"\").toLowerCase().includes(t)\n// //     );\n// //   });\n\n// //   const indexOfLast = currentPage * itemsPerPage;\n// //   const currentItems = filteredItems.slice(indexOfLast - itemsPerPage, indexOfLast);\n// //   const totalPages = Math.max(1, Math.ceil(filteredItems.length / itemsPerPage));\n\n// //   // -------------------- RENDER --------------------\n// //   return (\n// //     <div className=\"price-container\">\n// //       {/* HEADER */}\n// //       <div className=\"header-section\">\n// //         <h1>üí∞ Product Management</h1>\n// //         <p>Manage prices, categories, images, CSV & bulk actions.</p>\n// //       </div>\n\n// //       {/* SEARCH */}\n// //       <div className=\"search-bar\">\n// //         <input\n// //           type=\"text\"\n// //           placeholder=\"Search product, category or subcategory...\"\n// //           value={search}\n// //           onChange={(e) => {\n// //             setSearch(e.target.value);\n// //             setCurrentPage(1);\n// //           }}\n// //         />\n// //       </div>\n\n// //       {/* BULK BAR */}\n// //       {selectedItems.length > 0 && (\n// //         <div className=\"bulk-bar\">\n// //           <span>{selectedItems.length} selected</span>\n\n// //           {!bulkMode ? (\n// //             <div className=\"bulk-actions\" style={{ display: \"flex\", gap: 10 }}>\n// //               <button className=\"btn delete\" onClick={handleBulkDelete}>\n// //                 üóë Bulk Delete\n// //               </button>\n\n// //               <button className=\"btn primary\" onClick={() => setBulkMode(true)}>\n// //                 ‚úè Bulk Edit\n// //               </button>\n\n// //               <button className=\"btn small\" onClick={handleExportSelectedCsv}>\n// //                 ‚§ì Export Selected\n// //               </button>\n// //             </div>\n// //           ) : (\n// //             <div className=\"bulk-panel\">\n// //               <h3>‚úè Bulk Edit Selected Items</h3>\n\n// //               {items\n// //                 .filter((item) => selectedItems.includes(item._id))\n// //                 .map((item) => (\n// //                   <div key={item._id} className=\"bulk-edit-item-box\">\n// //                     <h4>{item.name}</h4>\n\n// //                     <div className=\"form-grid\">\n// //                       <div className=\"form-group\">\n// //                         <label>Name</label>\n// //                         <input\n// //                           type=\"text\"\n// //                           value={item.name}\n// //                           onChange={(e) => updateLocalItemField(item._id, \"name\", e.target.value)}\n// //                         />\n// //                       </div>\n\n// //                       <div className=\"form-group\">\n// //                         <label>Base Price</label>\n// //                         <input\n// //                           type=\"number\"\n// //                           value={item.basePrice}\n// //                           onChange={(e) =>\n// //                             updateLocalItemField(item._id, \"basePrice\", Number(e.target.value))\n// //                           }\n// //                         />\n// //                       </div>\n// //                           <div className=\"form-group\">\n// //   <label>Category</label>\n// //   <select\n// //     value={item.category?._id || \"\"}\n// //     onChange={(e) => {\n// //       const newCat = e.target.value;\n\n// //       updateLocalItemField(item._id, \"category\", { _id: newCat });\n\n// //       const catObj = categories.find((c) => c._id === newCat);\n// //       const firstSub = catObj?.subcategories?.[0]?._id || \"\";\n\n// //       updateLocalItemField(item._id, \"subcategory\", { _id: firstSub });\n// //     }}\n// //   >\n// //     <option value=\"\">Select Category</option>\n// //     {categories.map((c) => (\n// //       <option key={c._id} value={c._id}>\n// //         {c.name}\n// //       </option>\n// //     ))}\n// //   </select>\n// // </div>\n\n// // <div className=\"form-group\">\n// //   <label>Subcategory</label>\n// //   <select\n// //     value={item.subcategory?._id || \"\"}\n// //     onChange={(e) =>\n// //       updateLocalItemField(item._id, \"subcategory\", { _id: e.target.value })\n// //     }\n// //   >\n// //     <option value=\"\">Select Subcategory</option>\n\n// //     {categories\n// //       .find((c) => c._id === item.category?._id)\n// //       ?.subcategories?.map((s) => (\n// //         <option key={s._id} value={s._id}>\n// //           {s.name}\n// //         </option>\n// //       ))}\n// //   </select>\n// // </div>\n// //                       <div className=\"form-group\">\n// //                         <label>Difference</label>\n// //                         <input\n// //                           type=\"number\"\n// //                           value={item.difference || 0}\n// //                           onChange={(e) =>\n// //                             updateLocalItemField(item._id, \"difference\", Number(e.target.value))\n// //                           }\n// //                         />\n// //                       </div>\n\n// //                       {/* <div className=\"form-group\">\n// //                         <label>Valid Till</label>\n// //                         <input\n// //                           type=\"date\"\n// //                           value={item.validTill ? item.validTill.split(\"T\")[0] : \"\"}\n// //                           onChange={(e) => updateLocalItemField(item._id, \"validTill\", e.target.value)}\n// //                         />\n// //                       </div> */}\n// //                     </div>\n// //                   </div>\n// //                 ))}\n\n// //               <div style={{ display: \"flex\", gap: 10, marginTop: 12 }}>\n// //                 <button className=\"btn primary\" onClick={handleBulkSave}>\n// //                   ‚úî Save All\n// //                 </button>\n// //                 <button className=\"btn cancel\" onClick={() => setBulkMode(false)}>\n// //                   ‚úñ Cancel\n// //                 </button>\n// //               </div>\n// //             </div>\n// //           )}\n// //         </div>\n// //       )}\n\n// //       {/* FORM */}\n// //       <div className=\"price-form-card\">\n// //         <h2>{isCopyMode ? \"üìÑ Save Duplicate Product\" : editId ? \"‚úè Update Product\" : \"‚ûï Add Product\"}</h2>\n\n// //         <form onSubmit={handleSubmit}>\n// //           <div className=\"form-grid\">\n// //             {/* NAME */}\n// //             <div className=\"form-group\">\n// //               <label>Product Name *</label>\n// //               <input required name=\"name\" value={form.name} onChange={handleChange} />\n// //             </div>\n\n// //             {/* CATEGORY */}\n// //             <div className=\"form-group\">\n// //               <label>Category *</label>\n// //               <div className=\"category-row\">\n// //                 <select\n// //                   required\n// //                   name=\"category\"\n// //                   value={form.category}\n// //                   onChange={(e) => {\n// //                     handleChange(e);\n// //                     // reset subcategory on category change (useEffect will set subs)\n// //                     setForm((p) => ({ ...p, subcategory: \"\" }));\n// //                   }}\n// //                 >\n// //                   <option value=\"\">Select Category</option>\n// //                   {categories.map((c) => (\n// //                     <option value={c._id} key={c._id}>\n// //                       {c.name}\n// //                     </option>\n// //                   ))}\n// //                 </select>\n\n// //                 <button type=\"button\" className=\"btn small\" onClick={() => setAddingCategory((v) => !v)}>\n// //                   {addingCategory ? \"Close\" : \"Add\"}\n// //                 </button>\n// //               </div>\n// //             </div>\n\n// //             {/* ADD CATEGORY UI */}\n// //             {addingCategory && (\n// //               <div className=\"form-group full-width addCategoryBox\">\n// //                 <label>Add New Category</label>\n// //                 <div className=\"category-row\">\n// //                   <input\n// //                     value={newCategoryName}\n// //                     onChange={(e) => setNewCategoryName(e.target.value)}\n// //                     placeholder=\"Category name\"\n// //                   />\n// //                   <input\n// //                     type=\"file\"\n// //                     accept=\"image/*\"\n// //                     onChange={(e) => {\n// //                       setNewCategoryImage(e.target.files[0]);\n// //                       setNewCategoryPreview(e.target.files[0] ? URL.createObjectURL(e.target.files[0]) : null);\n// //                     }}\n// //                   />\n// //                   <button className=\"btn primary\" type=\"button\" onClick={handleCreateCategory}>\n// //                     Create\n// //                   </button>\n// //                 </div>\n// //                 {newCategoryPreview && <img src={newCategoryPreview} className=\"categoryPreview\" alt=\"preview\" />}\n// //               </div>\n// //             )}\n\n// //             {/* SUBCATEGORY */}\n// //             <div className=\"form-group\">\n// //               <label>Subcategory</label>\n// //               <div className=\"category-row\">\n// //                 <select name=\"subcategory\" value={form.subcategory} onChange={handleChange} disabled={!subcategories.length}>\n// //                   <option value=\"\">Select Subcategory</option>\n// //                   {subcategories.map((s) => (\n// //                     <option value={s._id} key={s._id}>\n// //                       {s.name}\n// //                     </option>\n// //                   ))}\n// //                 </select>\n\n// //                 {form.category && (\n// //                   <button type=\"button\" className=\"btn small\" onClick={() => setAddingSub((v) => !v)}>\n// //                     {addingSub ? \"Close\" : \"Add\"}\n// //                   </button>\n// //                 )}\n// //               </div>\n// //             </div>\n\n// //             {/* ADD SUBCATEGORY UI */}\n// //             {addingSub && (\n// //               <div className=\"form-group full-width addCategoryBox\">\n// //                 <label>Add New Subcategory</label>\n// //                 <div className=\"category-row\">\n// //                   <input value={newSubName} onChange={(e) => setNewSubName(e.target.value)} placeholder=\"Subcategory name\" />\n// //                   <input\n// //                     type=\"file\"\n// //                     accept=\"image/*\"\n// //                     onChange={(e) => {\n// //                       setNewSubImage(e.target.files[0]);\n// //                       setNewSubPreview(e.target.files[0] ? URL.createObjectURL(e.target.files[0]) : null);\n// //                     }}\n// //                   />\n// //                   <button className=\"btn primary\" type=\"button\" onClick={handleCreateSub}>\n// //                     Create\n// //                   </button>\n// //                 </div>\n// //                 {newSubPreview && <img src={newSubPreview} className=\"categoryPreview\" alt=\"preview\" />}\n// //               </div>\n// //             )}\n\n// //             {/* BASE PRICE */}\n// //             <div className=\"form-group\">\n// //               <label>Base Price *</label>\n// //               <input type=\"number\" required name=\"basePrice\" value={form.basePrice} onChange={handleChange} />\n// //             </div>\n\n// //             {/* DIFFERENCE */}\n// //             <div className=\"form-group\">\n// //               <label>Difference</label>\n// //               <input type=\"number\" name=\"difference\" value={form.difference} onChange={handleChange} />\n// //             </div>\n\n// //             {/* VALID TILL */}\n// //             <div className=\"form-group\">\n// //               <label>Valid Till</label>\n// //               <input type=\"date\" name=\"validTill\" value={form.validTill} onChange={handleChange} />\n// //             </div>\n\n// //             {/* IMAGE */}\n// //             <div className=\"form-group\">\n// //               <label>Image</label>\n// //               <input type=\"file\" accept=\"image/*\" onChange={handleChange} />\n// //             </div>\n// //           </div>\n\n// //           {/* DESCRIPTION */}\n// //           <div className=\"form-group full-width\">\n// //             <label>Description</label>\n// //             <textarea name=\"description\" value={form.description} onChange={handleChange}></textarea>\n// //           </div>\n\n// //           {/* ACTIONS */}\n// //           <div className=\"form-actions\">\n// //             <button className=\"btn primary\" disabled={loading}>\n// //               {loading ? \"Saving...\" : isCopyMode ? \"Save Copy\" : editId ? \"Update\" : \"Add\"}\n// //             </button>\n\n// //             {(editId || isCopyMode) && (\n// //               <button\n// //                 type=\"button\"\n// //                 className=\"btn cancel\"\n// //                 onClick={() => {\n// //                   setEditId(null);\n// //                   setIsCopyMode(false);\n// //                   setForm({\n// //                     name: \"\",\n// //                     category: \"\",\n// //                     subcategory: \"\",\n// //                     description: \"\",\n// //                     basePrice: \"\",\n// //                     difference: \"\",\n// //                     validTill: \"\",\n// //                     file: null,\n// //                   });\n// //                 }}\n// //               >\n// //                 Cancel\n// //               </button>\n// //             )}\n// //           </div>\n// //         </form>\n// //       </div>\n\n// //       {/* CSV CONTROLS */}\n// //       <div className=\"csv-controls\">\n// //         <div>\n// //           <input type=\"file\" accept=\".csv\" ref={csvInputRef} onChange={handleCsvSelect} />\n// //           <button className=\"btn small\" onClick={handleImportCsv}>\n// //             Import CSV\n// //           </button>\n// //         </div>\n\n// //         <div style={{ display: \"flex\", gap: 8 }}>\n// //           <button className=\"btn primary\" onClick={handleExportCsv}>\n// //             Export All CSV\n// //           </button>\n\n// //           <button className=\"btn\" onClick={handleExportSelectedCsv}>\n// //             Export Selected CSV\n// //           </button>\n// //         </div>\n// //       </div>\n\n// //       {/* TABLE */}\n// //       <div className=\"table-card\">\n// //         <div className=\"table-header\">\n// //           <h2>üìã Items</h2>\n// //           <span>Total: {filteredItems.length}</span>\n// //         </div>\n\n// //         {!isMobile ? (\n// //           <table>\n// //             <thead>\n// //               <tr>\n// //                 <th>\n// //                   <input\n// //                     type=\"checkbox\"\n// //                     checked={selectedItems.length === filteredItems.length && filteredItems.length > 0}\n// //                     onChange={() => {\n// //                       if (selectedItems.length === filteredItems.length) setSelectedItems([]);\n// //                       else setSelectedItems(filteredItems.map((x) => x._id));\n// //                     }}\n// //                   />\n// //                 </th>\n// //                 <th>Sr</th>\n// //                 <th>Image</th>\n// //                 <th>Name</th>\n// //                 <th>Category</th>\n// //                 <th>Subcategory</th>\n// //                 <th>Base</th>\n// //                 <th>Diff</th>\n// //                 <th>Final</th>\n// //                 <th>Status</th>\n// //                 <th>Valid Till</th>\n// //                 <th>Actions</th>\n// //               </tr>\n// //             </thead>\n\n// //             <tbody>\n// //               {currentItems.map((item, i) => (\n// //                 <tr key={item._id}>\n// //                   <td>\n// //                     <input\n// //                       type=\"checkbox\"\n// //                       checked={selectedItems.includes(item._id)}\n// //                       onChange={() =>\n// //                         setSelectedItems((prev) => (prev.includes(item._id) ? prev.filter((x) => x !== item._id) : [...prev, item._id]))\n// //                       }\n// //                     />\n// //                   </td>\n\n// //                   <td>{(currentPage - 1) * itemsPerPage + (i + 1)}</td>\n\n// //                   <td>{item.image ? <img src={item.image} alt=\"\" /> : \"No Img\"}</td>\n\n// //                   <td>{item.name}</td>\n// //                   <td>{item.category?.name || \"-\"}</td>\n// //                   <td>{item.subcategory?.name || \"-\"}</td>\n\n// //                   <td>‚Çπ{item.basePrice}</td>\n// //                   <td>{item.difference || 0}</td>\n// //                   <td>‚Çπ{Number(item.basePrice) + Number(item.difference || 0)}</td>\n\n// //                   <td>\n// //                     <button\n// //                       className={item.status === \"active\" ? \"status-active\" : \"status-inactive\"}\n// //                       onClick={() => handleStatusToggle(item)}\n// //                     >\n// //                       {item.status === \"active\" ? \" Active\" : \" Inactive\"}\n// //                     </button>\n// //                   </td>\n\n// //                   <td>{item.validTill ? new Date(item.validTill).toLocaleDateString() : \"-\"}</td>\n\n// //                   <td className=\"actions\">\n// //                     <button className=\"btn edit\" onClick={() => handleEdit(item)}>\n// //                       Edit\n// //                     </button>\n\n// //                     <button className=\"btn delete\" onClick={() => handleDelete(item._id)}>\n// //                       Delete\n// //                     </button>\n\n// //                     <button className=\"btn small\" style={{ background: \"#6f42c1\", color: \"white\" }} onClick={() => handleCopyToEdit(item)}>\n// //                       Copy\n// //                     </button>\n// //                   </td>\n// //                 </tr>\n// //               ))}\n// //             </tbody>\n// //           </table>\n// //         ) : (\n// //           <div className=\"mobile-list\">\n// //             {currentItems.map((item) => (\n// //               <div key={item._id} className=\"mobile-card\">\n// //                 <input\n// //                   type=\"checkbox\"\n// //                   checked={selectedItems.includes(item._id)}\n// //                   onChange={() =>\n// //                     setSelectedItems((prev) => (prev.includes(item._id) ? prev.filter((x) => x !== item._id) : [...prev, item._id]))\n// //                   }\n// //                 />\n\n// //                 {item.image ? <img src={item.image} alt=\"\" /> : <div>No Image</div>}\n\n// //                 <h3>{item.name}</h3>\n\n// //                 <p>\n// //                   <b>Category:</b> {item.category?.name || \"-\"}\n// //                 </p>\n\n// //                 <p>\n// //                   <b>Subcategory:</b> {item.subcategory?.name || \"-\"}\n// //                 </p>\n\n// //                 <p>\n// //                   <b>Base:</b> ‚Çπ{item.basePrice}\n// //                 </p>\n\n// //                 <p>\n// //                   <b>Final:</b> ‚Çπ{Number(item.basePrice) + Number(item.difference || 0)}\n// //                 </p>\n\n// //                 <button className={item.status === \"active\" ? \"status-active\" : \"status-inactive\"} onClick={() => handleStatusToggle(item)}>\n// //                   {item.status === \"active\" ? \"Active\" : \"Inactive\"}\n// //                 </button>\n\n// //                 <div className=\"actions\">\n// //                   <button className=\"btn edit\" onClick={() => handleEdit(item)}>\n// //                     Edit\n// //                   </button>\n\n// //                   <button className=\"btn delete\" onClick={() => handleDelete(item._id)}>\n// //                     Delete\n// //                   </button>\n\n// //                   <button className=\"btn small\" style={{ background: \"#6f42c1\", color: \"white\" }} onClick={() => handleCopyToEdit(item)}>\n// //                     Copy\n// //                   </button>\n// //                 </div>\n// //               </div>\n// //             ))}\n// //           </div>\n// //         )}\n\n// //         {/* PAGINATION */}\n// //         <div className=\"pagination\">\n// //           <button disabled={currentPage === 1} onClick={() => setCurrentPage((p) => p - 1)}>\n// //             Previous\n// //           </button>\n\n// //           {Array.from({ length: totalPages }, (_, i) => (\n// //             <button key={i} className={i + 1 === currentPage ? \"active-page\" : \"\"} onClick={() => setCurrentPage(i + 1)}>\n// //               {i + 1}\n// //             </button>\n// //           ))}\n\n// //           <button disabled={currentPage === totalPages} onClick={() => setCurrentPage((p) => p + 1)}>\n// //             Next\n// //           </button>\n// //         </div>\n// //       </div>\n// //     </div>\n// //   );\n// // }\n// import React, { useEffect, useState, useRef } from \"react\";\n// import axios from \"axios\";\n\n// const API_URL = \"https://grocerrybackend.vercel.app/api/prices\";\n// const CATEGORY_URL = \"https://grocerrybackend.vercel.app/api/categories\";\n\n// export default function PriceList() {\n//   const [items, setItems] = useState([]);\n//   const [categories, setCategories] = useState([]);\n//   const [subcategories, setSubcategories] = useState([]);\n//   const [isMobile, setIsMobile] = useState(window.innerWidth < 768);\n//   const [search, setSearch] = useState(\"\");\n//   const [loading, setLoading] = useState(false);\n\n//   // FORM state\n//   const [form, setForm] = useState({\n//     name: \"\",\n//     category: \"\",\n//     subcategory: \"\",\n//     description: \"\",\n//     basePrice: \"\",\n//     difference: \"\",\n//     validTill: \"\",\n//     file: null,\n//   });\n\n//   const [editId, setEditId] = useState(null);\n//   const [isCopyMode, setIsCopyMode] = useState(false);\n//   const [showForm, setShowForm] = useState(false);\n//   const [showModal, setShowModal] = useState(false);\n//   const [activeMenu, setActiveMenu] = useState(null);\n\n//   const [addingCategory, setAddingCategory] = useState(false);\n//   const [newCategoryName, setNewCategoryName] = useState(\"\");\n//   const [newCategoryImage, setNewCategoryImage] = useState(null);\n//   const [newCategoryPreview, setNewCategoryPreview] = useState(null);\n\n//   const [addingSub, setAddingSub] = useState(false);\n//   const [newSubName, setNewSubName] = useState(\"\");\n//   const [newSubImage, setNewSubImage] = useState(null);\n//   const [newSubPreview, setNewSubPreview] = useState(null);\n\n//   const [selectedItems, setSelectedItems] = useState([]);\n//   const [bulkMode, setBulkMode] = useState(false);\n\n//   const [csvFile, setCsvFile] = useState(null);\n//   const csvInputRef = useRef();\n\n//   const [currentPage, setCurrentPage] = useState(1);\n//   const itemsPerPage = 30;\n\n//   // useEffect(() => {\n//   //   fetchItems();\n//   //   fetchCategories();\n\n//   //   const handleResize = () => setIsMobile(window.innerWidth < 768);\n//   //   window.addEventListener(\"resize\", handleResize);\n//   //   return () => window.removeEventListener(\"resize\", handleResize);\n//   // }, []);\n//   // 1. Pehle categories load karo\n// useEffect(() => {\n//   fetchCategories();\n// }, []);\n\n// // 2. Categories load hone ke baad items load karo\n// useEffect(() => {\n//   if (categories.length > 0) {\n//     fetchItems();\n//   }\n// }, [categories]);\n\n// // 3. Resize listener\n// useEffect(() => {\n//   const handleResize = () => setIsMobile(window.innerWidth < 768);\n//   window.addEventListener(\"resize\", handleResize);\n//   return () => window.removeEventListener(\"resize\", handleResize);\n// }, []);\n\n//   const fetchItems = async () => {\n//     try {\n//       setLoading(true);\n//       const res = await axios.get(API_URL);\n//       // if (res.data && res.data.success) setItems(res.data.data || []);\n//       if (res.data && res.data.success) {\n//   const raw = res.data.data;\n\n//   // Agar categories abhi load nahi hui = raw items set\n//   if (!categories.length) {\n//     setItems(raw);\n//     return;\n//   }\n\n//   // Mapping to category + subcategory object\n//   const enriched = raw.map((item) => {\n//     const cat = categories.find(\n//       (c) =>\n//         c._id === item.category ||\n//         c._id === item.category?._id\n//     );\n\n//     const sub = cat?.subcategories?.find(\n//       (s) =>\n//         s._id === item.subcategory ||\n//         s._id === item.subcategory?._id\n//     );\n\n//     return {\n//       ...item,\n//       category: cat\n//         ? { _id: cat._id, name: cat.name }\n//         : item.category,\n\n//       subcategory: sub\n//         ? { _id: sub._id, name: sub.name }\n//         : item.subcategory,\n//     };\n//   });\n\n//   setItems(enriched);\n// }\n\n//     } catch (err) {\n//       console.error(\"Fetch items error\", err);\n//       alert(\"Could not fetch items\");\n//     } finally {\n//       setLoading(false);\n//     }\n//   };\n\n//   const fetchCategories = async () => {\n//     try {\n//       const res = await axios.get(CATEGORY_URL);\n//       if (res.data && res.data.success) setCategories(res.data.categories || []);\n//     } catch (err) {\n//       console.error(\"Fetch categories error\", err);\n//       alert(\"Could not fetch categories\");\n//     }\n//   };\n\n//   useEffect(() => {\n//     if (!form.category) {\n//       setSubcategories([]);\n//       setForm((prev) => ({ ...prev, subcategory: \"\" }));\n//       return;\n//     }\n\n//     const cat = categories.find((c) => c._id === form.category);\n//     const subs = (cat && cat.subcategories) || [];\n//     setSubcategories(subs);\n\n//     const exists = subs.some((s) => s._id === form.subcategory);\n//     if (!exists) setForm((prev) => ({ ...prev, subcategory: \"\" }));\n//   }, [form.category, categories]);\n\n//   const handleCreateCategory = async () => {\n//     if (!newCategoryName.trim()) return alert(\"Enter category name\");\n//     try {\n//       const fd = new FormData();\n//       fd.append(\"name\", newCategoryName.trim());\n//       if (newCategoryImage) fd.append(\"image\", newCategoryImage);\n\n//       const res = await axios.post(CATEGORY_URL, fd);\n//       if (res.data && res.data.success) {\n//         alert(\"Category created\");\n//         setNewCategoryName(\"\");\n//         setNewCategoryImage(null);\n//         setNewCategoryPreview(null);\n//         setAddingCategory(false);\n//         fetchCategories();\n//       } else {\n//         alert(\"Category creation failed\");\n//       }\n//     } catch (err) {\n//       console.error(\"Create category error\", err);\n//       alert(\"Category creation failed\");\n//     }\n//   };\n\n//   const handleCreateSub = async () => {\n//     if (!newSubName.trim()) return alert(\"Enter subcategory name\");\n//     if (!form.category) return alert(\"Select category first\");\n\n//     try {\n//       const fd = new FormData();\n//       fd.append(\"name\", newSubName.trim());\n//       if (newSubImage) fd.append(\"image\", newSubImage);\n\n//       const res = await axios.post(`${CATEGORY_URL}/${form.category}/sub`, fd);\n//       if (res.data && res.data.success) {\n//         alert(\"Subcategory created\");\n//         setNewSubName(\"\");\n//         setNewSubImage(null);\n//         setNewSubPreview(null);\n//         setAddingSub(false);\n//         fetchCategories();\n//       } else {\n//         alert(\"Subcategory creation failed\");\n//       }\n//     } catch (err) {\n//       console.error(\"Create sub error\", err);\n//       alert(\"Subcategory creation failed\");\n//     }\n//   };\n\n//   const handleChange = (e) => {\n//     const { name, value, files } = e.target;\n//     if (files && files.length) {\n//       setForm((p) => ({ ...p, file: files[0] }));\n//     } else {\n//       setForm((p) => ({ ...p, [name]: value }));\n//     }\n//   };\n\n//   const handleSubmit = async (e) => {\n//     e.preventDefault();\n//     setLoading(true);\n\n//     try {\n//       if (!form.name || !form.category || !form.basePrice) {\n//         alert(\"Name, category & base price are required\");\n//         setLoading(false);\n//         return;\n//       }\n\n//       const fd = new FormData();\n//       Object.keys(form).forEach((k) => {\n//         const val = form[k];\n//         if (val !== undefined && val !== null) {\n//           fd.append(k, val);\n//         }\n//       });\n\n//       let res;\n//       if (isCopyMode) {\n//         res = await axios.post(API_URL, fd);\n//         alert(\"Copied as new item\");\n//       } else if (editId) {\n//         res = await axios.put(`${API_URL}/${editId}`, fd);\n//         alert(\"Updated\");\n//       } else {\n//         res = await axios.post(API_URL, fd);\n//         alert(\"Added\");\n//       }\n\n//       await fetchItems();\n//       await fetchCategories();\n\n//       setForm({\n//         name: \"\",\n//         category: \"\",\n//         subcategory: \"\",\n//         description: \"\",\n//         basePrice: \"\",\n//         difference: \"\",\n//         validTill: \"\",\n//         file: null,\n//       });\n//       setEditId(null);\n//       setIsCopyMode(false);\n//       setShowModal(false);\n//       setShowForm(false);\n//     } catch (err) {\n//       console.error(\"Save error\", err);\n//       alert(\"Save failed\");\n//     } finally {\n//       setLoading(false);\n//     }\n//   };\n\n//   const handleEdit = (item) => {\n//     setForm({\n//       name: item.name || \"\",\n//       category: item.category?._id?.toString() || \"\",\n//       subcategory: item.subcategory?._id?.toString() || \"\",\n//       description: item.description || \"\",\n//       basePrice: item.basePrice ?? \"\",\n//       difference: item.difference ?? \"\",\n//       validTill: item.validTill ? item.validTill.split(\"T\")[0] : \"\",\n//       file: null,\n//     });\n\n//     const cat = categories.find((c) => c._id === item.category?._id);\n//     setSubcategories(cat?.subcategories || []);\n\n//     setEditId(item._id);\n//     setIsCopyMode(false);\n//     setShowModal(true);\n//     setActiveMenu(null);\n//   };\n\n//   const handleCopyToEdit = (item) => {\n//     setForm({\n//       name: item.name || \"\",\n//       category: item.category?._id?.toString() || \"\",\n//       subcategory: item.subcategory?._id?.toString() || \"\",\n//       description: item.description || \"\",\n//       basePrice: item.basePrice ?? \"\",\n//       difference: item.difference ?? \"\",\n//       validTill: item.validTill ? item.validTill.split(\"T\")[0] : \"\",\n//       file: null,\n//     });\n\n//     const cat = categories.find((c) => c._id === item.category?._id);\n//     setSubcategories(cat?.subcategories || []);\n\n//     setEditId(null);\n//     setIsCopyMode(true);\n//     setShowModal(true);\n//     setActiveMenu(null);\n//   };\n\n//   const handleDelete = async (id) => {\n//     if (!window.confirm(\"Delete item?\")) return;\n//     try {\n//       await axios.delete(`${API_URL}/${id}`);\n//       setItems((prev) => prev.filter((x) => x._id !== id));\n//       setSelectedItems((prev) => prev.filter((x) => x !== id));\n//       setActiveMenu(null);\n//     } catch (err) {\n//       console.error(\"Delete error\", err);\n//       alert(\"Delete failed\");\n//     }\n//   };\n\n//   const handleStatusToggle = async (item) => {\n//     try {\n//       const newStatus = item.status === \"active\" ? \"inactive\" : \"active\";\n//       await axios.put(`${API_URL}/status/${item._id}`, { status: newStatus });\n//       setItems((prev) => prev.map((x) => (x._id === item._id ? { ...x, status: newStatus } : x)));\n//     } catch (err) {\n//       console.error(\"Status toggle error\", err);\n//       alert(\"Status update failed\");\n//     }\n//   };\n\n//   const handleBulkDelete = async () => {\n//     if (!selectedItems.length) return alert(\"No items selected\");\n//     if (!window.confirm(\"Delete selected items?\")) return;\n\n//     try {\n//       await Promise.all(selectedItems.map((id) => axios.delete(`${API_URL}/${id}`)));\n//       setSelectedItems([]);\n//       fetchItems();\n//       setBulkMode(false);\n//     } catch (err) {\n//       console.error(\"Bulk delete error\", err);\n//       alert(\"Bulk delete failed\");\n//     }\n//   };\n\n//   const updateLocalItemField = (id, key, value) => {\n//     setItems((prev) => prev.map((x) => (x._id === id ? { ...x, [key]: value } : x)));\n//   };\n\n//   const handleBulkSave = async () => {\n//     if (!selectedItems.length) return alert(\"No items selected for bulk save\");\n\n//     const updates = items\n//       .filter((x) => selectedItems.includes(x._id))\n//       .map((x) => ({\n//         id: x._id,\n//         name: x.name,\n//         basePrice: x.basePrice,\n//         difference: x.difference,\n//         validTill: x.validTill,\n//       }));\n\n//     try {\n//       await axios.post(`${API_URL}/bulk-update`, { products: updates });\n//       setBulkMode(false);\n//       setSelectedItems([]);\n//       fetchItems();\n//     } catch (err) {\n//       console.error(\"Bulk save error\", err);\n//       alert(\"Bulk save failed\");\n//     }\n//   };\n\n//   const handleCsvSelect = (e) => {\n//     setCsvFile(e.target.files[0]);\n//   };\n\n//   const handleImportCsv = async () => {\n//     if (!csvFile) return alert(\"Select CSV file\");\n//     try {\n//       const fd = new FormData();\n//       fd.append(\"file\", csvFile);\n//       const res = await axios.post(`${API_URL}/import`, fd);\n//       if (res.data && res.data.success) {\n//         alert(`Imported ${res.data.inserted || 0} items`);\n//         setCsvFile(null);\n//         if (csvInputRef.current) csvInputRef.current.value = null;\n//         fetchItems();\n//       } else {\n//         alert(\"CSV import failed\");\n//       }\n//     } catch (err) {\n//       console.error(\"CSV import error\", err);\n//       alert(\"CSV import failed\");\n//     }\n//   };\n\n//   // const handleExportCsv = async () => {\n//   //   try {\n//   //     const res = await axios.get(`${API_URL}/export`, { responseType: \"blob\" });\n//   //     const url = window.URL.createObjectURL(new Blob([res.data]));\n//   //     const a = document.createElement(\"a\");\n//   //     a.href = url;\n//   //     a.download = \"prices.csv\";\n//   //     a.click();\n//   //     URL.revokeObjectURL(url);\n//   //   } catch (err) {\n//   //     console.error(\"CSV export error\", err);\n//   //     alert(\"CSV export failed\");\n//   //   }\n//   // };\n// const handleExportCsv = () => {\n//   if (!items.length) return alert(\"No items to export\");\n\n//   const header = [\n//     \"id\",\n//     \"name\",\n//     \"categoryName\",\n//     \"subcategoryName\",\n//     \"basePrice\",\n//     \"difference\",\n//     \"finalPrice\",\n//     \"status\",\n//     \"validTill\",\n//     \"description\",\n//     \"imageUrl\",\n//   ];\n\n//   const rows = items.map((p) => [\n//     p._id,\n//     p.name || \"\",\n//     p.category?.name || \"\",\n//     p.subcategory?.name || \"\",\n//     p.basePrice ?? \"\",\n//     p.difference ?? \"\",\n//     (Number(p.basePrice) + Number(p.difference || 0)) || \"\",\n//     p.status || \"\",\n//     p.validTill ? new Date(p.validTill).toISOString().split(\"T\")[0] : \"\",\n//     p.description || \"\",\n//     p.image || \"\",\n//   ]);\n\n//   const csvArray = [header, ...rows];\n//   const csvContent =\n//     \"data:text/csv;charset=utf-8,\" +\n//     csvArray\n//       .map((r) => r.map((c) => `\"${String(c).replace(/\"/g, '\"\"')}\"`).join(\",\"))\n//       .join(\"\\n\");\n\n//   const encodedUri = encodeURI(csvContent);\n//   const link = document.createElement(\"a\");\n//   link.href = encodedUri;\n//   link.download = `all_prices_${Date.now()}.csv`;\n//   link.click();\n// };\n\n//   const handleExportSelectedCsv = () => {\n//     if (!selectedItems.length) return alert(\"Select items to export\");\n\n//     const selectedData = items.filter((x) => selectedItems.includes(x._id));\n//     const header = [\n//       \"id\",\n//       \"name\",\n//       \"categoryName\",\n//       \"subcategoryName\",\n//       \"basePrice\",\n//       \"difference\",\n//       \"finalPrice\",\n//       \"status\",\n//       \"validTill\",\n//       \"description\",\n//       \"imageUrl\",\n//     ];\n\n//     const rows = selectedData.map((p) => [\n//       p._id,\n//       p.name || \"\",\n//       p.category?.name || \"\",\n//       p.subcategory?.name || \"\",\n//       p.basePrice ?? \"\",\n//       p.difference ?? \"\",\n//       (Number(p.basePrice) + Number(p.difference || 0)) || \"\",\n//       p.status || \"\",\n//       p.validTill ? new Date(p.validTill).toISOString().split(\"T\")[0] : \"\",\n//       p.description || \"\",\n//       p.image || \"\",\n//     ]);\n\n//     const csvArray = [header, ...rows];\n//     const csvContent =\n//       \"data:text/csv;charset=utf-8,\" +\n//       csvArray.map((r) => r.map((c) => `\"${String(c).replace(/\"/g, '\"\"')}\"`).join(\",\")).join(\"\\n\");\n\n//     const encodedUri = encodeURI(csvContent);\n//     const link = document.createElement(\"a\");\n//     link.href = encodedUri;\n//     link.download = `selected_prices_${Date.now()}.csv`;\n//     link.click();\n//   };\n\n//   const filteredItems = items.filter((item) => {\n//     const t = search.toLowerCase();\n//     return (\n//       (item.name || \"\").toString().toLowerCase().includes(t) ||\n//       (item.category?.name || \"\").toLowerCase().includes(t) ||\n//       (item.subcategory?.name || \"\").toLowerCase().includes(t)\n//     );\n//   });\n\n//   const indexOfLast = currentPage * itemsPerPage;\n//   const currentItems = filteredItems.slice(indexOfLast - itemsPerPage, indexOfLast);\n//   const totalPages = Math.max(1, Math.ceil(filteredItems.length / itemsPerPage));\n\n//   return (\n//     <div style={styles.container}>\n//       {/* HEADER */}\n//       <div style={styles.header}>\n//         <h1 style={styles.title}>Product Management</h1>\n//         {/* <p style={styles.subtitle}>Manage prices, categories, images, CSV & bulk actions.</p> */}\n//       </div>\n\n//       {/* SEARCH */}\n//       <div style={styles.searchBar}>\n//         <input\n//           type=\"text\"\n//           placeholder=\"Search product, category or subcategory...\"\n//           value={search}\n//           onChange={(e) => {\n//             setSearch(e.target.value);\n//             setCurrentPage(1);\n//           }}\n//           style={styles.searchInput}\n//         />\n//       </div>\n\n//       {/* ADD PRODUCT BUTTON */}\n//       <div style={styles.addButtonWrapper}>\n//         <button\n//           style={styles.addButton}\n//           onClick={() => {\n//             setShowForm(!showForm);\n//             setEditId(null);\n//             setIsCopyMode(false);\n//           }}\n//         >\n//           {showForm ? \"‚úñ Close Form\" : \"‚ûï Add Product\"}\n//         </button>\n//       </div>\n\n//       {/* BULK BAR */}\n//       {selectedItems.length > 0 && (\n//         <div style={styles.bulkBar}>\n//           <span style={styles.bulkText}>{selectedItems.length} selected</span>\n\n//           {!bulkMode ? (\n//             <div style={{ display: \"flex\", gap: 10, flexWrap: \"wrap\" }}>\n//               <button style={styles.btnDelete} onClick={handleBulkDelete}>\n//                 üóë Bulk Delete\n//               </button>\n\n//               <button style={styles.btnPrimary} onClick={() => setBulkMode(true)}>\n//                 ‚úè Bulk Edit\n//               </button>\n\n//               <button style={styles.btnSmall} onClick={handleExportSelectedCsv}>\n//                 ‚§ì Export Selected\n//               </button>\n//             </div>\n//           ) : (\n//             <div style={styles.bulkPanel}>\n//               <h3 style={styles.bulkPanelTitle}>‚úè Bulk Edit Selected Items</h3>\n\n//               {items\n//                 .filter((item) => selectedItems.includes(item._id))\n//                 .map((item) => (\n//                   <div key={item._id} style={styles.bulkItemBox}>\n//                     <h4 style={styles.bulkItemTitle}>{item.name}</h4>\n\n//                     <div style={styles.formGrid}>\n//                       <div style={styles.formGroup}>\n//                         <label style={styles.label}>Name</label>\n//                         <input\n//                           type=\"text\"\n//                           value={item.name}\n//                           onChange={(e) => updateLocalItemField(item._id, \"name\", e.target.value)}\n//                           style={styles.input}\n//                         />\n//                       </div>\n\n//                       <div style={styles.formGroup}>\n//                         <label style={styles.label}>Base Price</label>\n//                         <input\n//                           type=\"number\"\n//                           value={item.basePrice}\n//                           onChange={(e) =>\n//                             updateLocalItemField(item._id, \"basePrice\", Number(e.target.value))\n//                           }\n//                           style={styles.input}\n//                         />\n//                       </div>\n\n//                       <div style={styles.formGroup}>\n//                         <label style={styles.label}>Category</label>\n//                         <select\n//                           value={item.category?._id || \"\"}\n//                           onChange={(e) => {\n//                             const newCat = e.target.value;\n//                             updateLocalItemField(item._id, \"category\", { _id: newCat });\n//                             const catObj = categories.find((c) => c._id === newCat);\n//                             const firstSub = catObj?.subcategories?.[0]?._id || \"\";\n//                             updateLocalItemField(item._id, \"subcategory\", { _id: firstSub });\n//                           }}\n//                           style={styles.select}\n//                         >\n//                           <option value=\"\">Select Category</option>\n//                           {categories.map((c) => (\n//                             <option key={c._id} value={c._id}>\n//                               {c.name}\n//                             </option>\n//                           ))}\n//                         </select>\n//                       </div>\n\n//                       <div style={styles.formGroup}>\n//                         <label style={styles.label}>Subcategory</label>\n//                         <select\n//                           value={item.subcategory?._id || \"\"}\n//                           onChange={(e) =>\n//                             updateLocalItemField(item._id, \"subcategory\", { _id: e.target.value })\n//                           }\n//                           style={styles.select}\n//                         >\n//                           <option value=\"\">Select Subcategory</option>\n//                           {categories\n//                             .find((c) => c._id === item.category?._id)\n//                             ?.subcategories?.map((s) => (\n//                               <option key={s._id} value={s._id}>\n//                                 {s.name}\n//                               </option>\n//                             ))}\n//                         </select>\n//                       </div>\n\n//                       <div style={styles.formGroup}>\n//                         <label style={styles.label}>Difference</label>\n//                         <input\n//                           type=\"number\"\n//                           value={item.difference || 0}\n//                           onChange={(e) =>\n//                             updateLocalItemField(item._id, \"difference\", Number(e.target.value))\n//                           }\n//                           style={styles.input}\n//                         />\n//                       </div>\n//                     </div>\n//                   </div>\n//                 ))}\n\n//               <div style={{ display: \"flex\", gap: 10, marginTop: 12 }}>\n//                 <button style={styles.btnPrimary} onClick={handleBulkSave}>\n//                   ‚úî Save All\n//                 </button>\n//                 <button style={styles.btnCancel} onClick={() => setBulkMode(false)}>\n//                   ‚úñ Cancel\n//                 </button>\n//               </div>\n//             </div>\n//           )}\n//         </div>\n//       )}\n\n//       {/* FORM */}\n//       {showForm && (\n//         <div style={styles.formCard}>\n//           <h2 style={styles.formTitle}>‚ûï Add Product</h2>\n\n//           <form onSubmit={handleSubmit}>\n//             <div style={styles.formGrid}>\n//               <div style={styles.formGroup}>\n//                 <label style={styles.label}>Product Name *</label>\n//                 <input required name=\"name\" value={form.name} onChange={handleChange} style={styles.input} />\n//               </div>\n\n//               <div style={styles.formGroup}>\n//                 <label style={styles.label}>Category *</label>\n//                 <div style={styles.categoryRow}>\n//                   <select\n//                     required\n//                     name=\"category\"\n//                     value={form.category}\n//                     onChange={(e) => {\n//                       handleChange(e);\n//                       setForm((p) => ({ ...p, subcategory: \"\" }));\n//                     }}\n//                     style={styles.select}\n//                   >\n//                     <option value=\"\">Select Category</option>\n//                     {categories.map((c) => (\n//                       <option value={c._id} key={c._id}>\n//                         {c.name}\n//                       </option>\n//                     ))}\n//                   </select>\n\n//                   <button type=\"button\" style={styles.btnSmall} onClick={() => setAddingCategory((v) => !v)}>\n//                     {addingCategory ? \"Close\" : \"Add\"}\n//                   </button>\n//                 </div>\n//               </div>\n\n//               {addingCategory && (\n//                 <div style={styles.addCategoryBox}>\n//                   <label style={styles.label}>Add New Category</label>\n//                   <div style={styles.categoryRow}>\n//                     <input\n//                       value={newCategoryName}\n//                       onChange={(e) => setNewCategoryName(e.target.value)}\n//                       placeholder=\"Category name\"\n//                       style={styles.input}\n//                     />\n//                     <input\n//                       type=\"file\"\n//                       accept=\"image/*\"\n//                       onChange={(e) => {\n//                         setNewCategoryImage(e.target.files[0]);\n//                         setNewCategoryPreview(e.target.files[0] ? URL.createObjectURL(e.target.files[0]) : null);\n//                       }}\n//                       style={styles.fileInput}\n//                     />\n//                     <button style={styles.btnPrimary} type=\"button\" onClick={handleCreateCategory}>\n//                       Create\n//                     </button>\n//                   </div>\n//                   {newCategoryPreview && <img src={newCategoryPreview} style={styles.preview} alt=\"preview\" />}\n//                 </div>\n//               )}\n\n//               <div style={styles.formGroup}>\n//                 <label style={styles.label}>Subcategory</label>\n//                 <div style={styles.categoryRow}>\n//                   <select name=\"subcategory\" value={form.subcategory} onChange={handleChange} disabled={!subcategories.length} style={styles.select}>\n//                     <option value=\"\">Select Subcategory</option>\n//                     {subcategories.map((s) => (\n//                       <option value={s._id} key={s._id}>\n//                         {s.name}\n//                       </option>\n//                     ))}\n//                   </select>\n\n//                   {form.category && (\n//                     <button type=\"button\" style={styles.btnSmall} onClick={() => setAddingSub((v) => !v)}>\n//                       {addingSub ? \"Close\" : \"Add\"}\n//                     </button>\n//                   )}\n//                 </div>\n//               </div>\n\n//               {addingSub && (\n//                 <div style={styles.addCategoryBox}>\n//                   <label style={styles.label}>Add New Subcategory</label>\n//                   <div style={styles.categoryRow}>\n//                     <input value={newSubName} onChange={(e) => setNewSubName(e.target.value)} placeholder=\"Subcategory name\" style={styles.input} />\n//                     <input\n//                       type=\"file\"\n//                       accept=\"image/*\"\n//                       onChange={(e) => {\n//                         setNewSubImage(e.target.files[0]);\n//                         setNewSubPreview(e.target.files[0] ? URL.createObjectURL(e.target.files[0]) : null);\n//                       }}\n//                       style={styles.fileInput}\n//                     />\n//                     <button style={styles.btnPrimary} type=\"button\" onClick={handleCreateSub}>\n//                       Create\n//                     </button>\n//                   </div>\n//                   {newSubPreview && <img src={newSubPreview} style={styles.preview} alt=\"preview\" />}\n//                 </div>\n//               )}\n\n//               <div style={styles.formGroup}>\n//                 <label style={styles.label}>Base Price *</label>\n//                 <input type=\"number\" required name=\"basePrice\" value={form.basePrice} onChange={handleChange} style={styles.input} />\n//               </div>\n\n//               <div style={styles.formGroup}>\n//                 <label style={styles.label}>Difference</label>\n//                 <input type=\"number\" name=\"difference\" value={form.difference} onChange={handleChange} style={styles.input} />\n//               </div>\n\n//               <div style={styles.formGroup}>\n//                 <label style={styles.label}>Valid Till</label>\n//                 <input type=\"date\" name=\"validTill\" value={form.validTill} onChange={handleChange} style={styles.input} />\n//               </div>\n\n//               <div style={styles.formGroup}>\n//                 <label style={styles.label}>Image</label>\n//                 <input type=\"file\" accept=\"image/*\" onChange={handleChange} style={styles.fileInput} />\n//               </div>\n//             </div>\n\n//             <div style={styles.formGroup}>\n//               <label style={styles.label}>Description</label>\n//               <textarea name=\"description\" value={form.description} onChange={handleChange} style={styles.textarea}></textarea>\n//             </div>\n\n//             <div style={styles.formActions}>\n//               <button style={styles.btnPrimary} disabled={loading}>\n//                 {loading ? \"Saving...\" : \"Add Product\"}\n//               </button>\n//             </div>\n//           </form>\n//         </div>\n//       )}\n\n//       {/* CSV CONTROLS */}\n//       <div style={styles.csvControls}>\n//         <div>\n//           <input type=\"file\" accept=\".csv\" ref={csvInputRef} onChange={handleCsvSelect} style={styles.fileInput} />\n//           <button style={styles.btnSmall} onClick={handleImportCsv}>\n//             Import CSV\n//           </button>\n//         </div>\n\n//         <div style={{ display: \"flex\", gap: 8 }}>\n//           <button style={styles.btnPrimary} onClick={handleExportCsv}>\n//             Export All CSV\n//           </button>\n\n//           <button style={styles.btnSmall} onClick={handleExportSelectedCsv}>\n//             Export Selected CSV\n//           </button>\n//         </div>\n//       </div>\n\n//       {/* TABLE */}\n//       <div style={styles.tableCard}>\n//         <div style={styles.tableHeader}>\n//           <h2 style={styles.tableTitle}>üìã Items</h2>\n//           <span style={styles.totalCount}>Total: {filteredItems.length}</span>\n//         </div>\n\n//         <div style={styles.tableWrapper}>\n//           <table style={styles.table}>\n//             <thead>\n//               <tr>\n//                 <th style={styles.th}>\n//                   <input\n//                     type=\"checkbox\"\n//                     checked={selectedItems.length === filteredItems.length && filteredItems.length > 0}\n//                     onChange={() => {\n//                       if (selectedItems.length === filteredItems.length) setSelectedItems([]);\n//                       else setSelectedItems(filteredItems.map((x) => x._id));\n//                     }}\n//                   />\n//                 </th>\n//                 <th style={styles.th}>Sr</th>\n//                 <th style={styles.th}>Image</th>\n//                 <th style={styles.th}>Name</th>\n//                 <th style={styles.th}>Category</th>\n//                 <th style={styles.th}>Subcategory</th>\n//                 <th style={styles.th}>Base</th>\n//                 <th style={styles.th}>Diff</th>\n//                 <th style={styles.th}>Final</th>\n//                 <th style={styles.th}>Status</th>\n//                 <th style={styles.th}>Valid Till</th>\n//                 <th style={styles.th}>Actions</th>\n//               </tr>\n//             </thead>\n\n//             <tbody>\n//               {currentItems.map((item, i) => (\n//                 <tr key={item._id} style={styles.tr}>\n//                   <td style={styles.td}>\n//                     <input\n//                       type=\"checkbox\"\n//                       checked={selectedItems.includes(item._id)}\n//                       onChange={() =>\n//                         setSelectedItems((prev) => (prev.includes(item._id) ? prev.filter((x) => x !== item._id) : [...prev, item._id]))\n//                       }\n//                     />\n//                   </td>\n\n//                   <td style={styles.td}>{(currentPage - 1) * itemsPerPage + (i + 1)}</td>\n\n//                   <td style={styles.td}>{item.image ? <img src={item.image} style={styles.tableImg} alt=\"\" /> : \"No Img\"}</td>\n\n//                   <td style={styles.td}>{item.name}</td>\n//                   <td style={styles.td}>{item.category?.name || \"-\"}</td>\n//                   <td style={styles.td}>{item.subcategory?.name || \"-\"}</td>\n\n//                   <td style={styles.td}>‚Çπ{item.basePrice}</td>\n//                   <td style={styles.td}>{item.difference || 0}</td>\n//                   <td style={styles.td}>‚Çπ{Number(item.basePrice) + Number(item.difference || 0)}</td>\n\n//                   <td style={styles.td}>\n//                     <button\n//                       style={item.status === \"active\" ? styles.statusActive : styles.statusInactive}\n//                       onClick={() => handleStatusToggle(item)}\n//                     >\n//                       {item.status === \"active\" ? \"Active\" : \"Inactive\"}\n//                     </button>\n//                   </td>\n\n//                   <td style={styles.td}>{item.validTill ? new Date(item.validTill).toLocaleDateString() : \"-\"}</td>\n\n//                   <td style={styles.td}>\n//                     <div style={{ position: \"relative\" }}>\n//                       <button\n//                         style={styles.menuButton}\n//                         onClick={() => setActiveMenu(activeMenu === item._id ? null : item._id)}\n//                       >\n//                         ‚ãÆ\n//                       </button>\n\n//                       {activeMenu === item._id && (\n//                         <div style={styles.dropdown}>\n//                           <button style={styles.dropdownItem} onClick={() => handleEdit(item)}>\n//                             ‚úè Edit\n//                           </button>\n//                           <button style={styles.dropdownItem} onClick={() => handleCopyToEdit(item)}>\n//                             üìÑ Copy\n//                           </button>\n//                           <button style={styles.dropdownItemDelete} onClick={() => handleDelete(item._id)}>\n//                             üóë Delete\n//                           </button>\n//                         </div>\n//                       )}\n//                     </div>\n//                   </td>\n//                 </tr>\n//               ))}\n//             </tbody>\n//           </table>\n//         </div>\n\n//         {/* PAGINATION */}\n//         <div style={styles.pagination}>\n//           <button style={styles.paginationBtn} disabled={currentPage === 1} onClick={() => setCurrentPage((p) => p - 1)}>\n//             Previous\n//           </button>\n\n//           {Array.from({ length: totalPages }, (_, i) => (\n//             <button\n//               key={i}\n//               style={i + 1 === currentPage ? styles.paginationBtnActive : styles.paginationBtn}\n//               onClick={() => setCurrentPage(i + 1)}\n//             >\n//               {i + 1}\n//             </button>\n//           ))}\n\n//           <button style={styles.paginationBtn} disabled={currentPage === totalPages} onClick={() => setCurrentPage((p) => p + 1)}>\n//             Next\n//           </button>\n//         </div>\n//       </div>\n\n//       {/* MODAL FOR EDIT/COPY */}\n//       {showModal && (\n//         <div style={styles.modalOverlay} onClick={() => setShowModal(false)}>\n//           <div style={styles.modal} onClick={(e) => e.stopPropagation()}>\n//             <h2 style={styles.modalTitle}>{isCopyMode ? \"üìÑ Copy Product\" : \"‚úè Edit Product\"}</h2>\n\n//             <form onSubmit={handleSubmit}>\n//               <div style={styles.formGrid}>\n//                 <div style={styles.formGroup}>\n//                   <label style={styles.label}>Product Name *</label>\n//                   <input required name=\"name\" value={form.name} onChange={handleChange} style={styles.input} />\n//                 </div>\n\n//                 <div style={styles.formGroup}>\n//                   <label style={styles.label}>Category *</label>\n//                   <select\n//                     required\n//                     name=\"category\"\n//                     value={form.category}\n//                     onChange={(e) => {\n//                       handleChange(e);\n//                       setForm((p) => ({ ...p, subcategory: \"\" }));\n//                     }}\n//                     style={styles.select}\n//                   >\n//                     <option value=\"\">Select Category</option>\n//                     {categories.map((c) => (\n//                       <option value={c._id} key={c._id}>\n//                         {c.name}\n//                       </option>\n//                     ))}\n//                   </select>\n//                 </div>\n\n//                 <div style={styles.formGroup}>\n//                   <label style={styles.label}>Subcategory</label>\n//                   <select name=\"subcategory\" value={form.subcategory} onChange={handleChange} disabled={!subcategories.length} style={styles.select}>\n//                     <option value=\"\">Select Subcategory</option>\n//                     {subcategories.map((s) => (\n//                       <option value={s._id} key={s._id}>\n//                         {s.name}\n//                       </option>\n//                     ))}\n//                   </select>\n//                 </div>\n\n//                 <div style={styles.formGroup}>\n//                   <label style={styles.label}>Base Price *</label>\n//                   <input type=\"number\" required name=\"basePrice\" value={form.basePrice} onChange={handleChange} style={styles.input} />\n//                 </div>\n\n//                 <div style={styles.formGroup}>\n//                   <label style={styles.label}>Difference</label>\n//                   <input type=\"number\" name=\"difference\" value={form.difference} onChange={handleChange} style={styles.input} />\n//                 </div>\n\n//                 <div style={styles.formGroup}>\n//                   <label style={styles.label}>Valid Till</label>\n//                   <input type=\"date\" name=\"validTill\" value={form.validTill} onChange={handleChange} style={styles.input} />\n//                 </div>\n\n//                 <div style={styles.formGroup}>\n//                   <label style={styles.label}>Image</label>\n//                   <input type=\"file\" accept=\"image/*\" onChange={handleChange} style={styles.fileInput} />\n//                 </div>\n//               </div>\n\n//               <div style={styles.formGroup}>\n//                 <label style={styles.label}>Description</label>\n//                 <textarea name=\"description\" value={form.description} onChange={handleChange} style={styles.textarea}></textarea>\n//               </div>\n\n//               <div style={styles.formActions}>\n//                 <button style={styles.btnPrimary} disabled={loading}>\n//                   {loading ? \"Saving...\" : isCopyMode ? \"Save Copy\" : \"Update\"}\n//                 </button>\n\n//                 <button\n//                   type=\"button\"\n//                   style={styles.btnCancel}\n//                   onClick={() => {\n//                     setShowModal(false);\n//                     setEditId(null);\n//                     setIsCopyMode(false);\n//                     setForm({\n//                       name: \"\",\n//                       category: \"\",\n//                       subcategory: \"\",\n//                       description: \"\",\n//                       basePrice: \"\",\n//                       difference: \"\",\n//                       validTill: \"\",\n//                       file: null,\n//                     });\n//                   }}\n//                 >\n//                   Cancel\n//                 </button>\n//               </div>\n//             </form>\n//           </div>\n//         </div>\n//       )}\n//     </div>\n//   );\n// }\n\n// const styles = {\n//   container: {\n\n//   },\n//   header: {\n\n//   },\n//   title: {\n//     fontSize: \"30px\",\n//     fontWeight: \"700\",\n//     color: \"#0d3b66\",\n//     marginBottom: \"6px\",\n//   },\n//   subtitle: {\n//    fontSize: \"16px\",\n//   },\n//   searchBar: {\n//     maxWidth: \"480px\",\n//     margin: \"0 auto 25px auto\",\n//   },\n//   searchInput: {\n//     width: \"100%\",\n//     padding: \"12px 15px\",\n//     borderRadius: \"12px\",\n//     border: \"1px solid #ced4da\",\n//     background: \"#f9fbfc\",\n//     fontSize: \"15px\",\n//     outline: \"none\",\n//     boxShadow: \"0 2px 6px rgba(0, 0, 0, 0.06)\",\n//   },\n//   addButtonWrapper: {\n//     textAlign: \"center\",\n//     marginBottom: \"25px\",\n//   },\n//   addButton: {\n//     background: \"#007bff\",\n//     color: \"#fff\",\n//     border: \"none\",\n//     borderRadius: \"12px\",\n//     padding: \"12px 24px\",\n//     fontSize: \"16px\",\n//     fontWeight: \"600\",\n//     cursor: \"pointer\",\n//     transition: \"0.25s ease\",\n//   },\n//   bulkBar: {\n//     background: \"#e9f2ff\",\n//     border: \"1px solid #c4d9ff\",\n//     borderRadius: \"14px\",\n//     padding: \"15px 18px\",\n//     marginBottom: \"25px\",\n//     display: \"flex\",\n//     justifyContent: \"space-between\",\n//     alignItems: \"center\",\n//     flexWrap: \"wrap\",\n//     gap: \"14px\",\n//     boxShadow: \"0 3px 10px rgba(0, 80, 160, 0.1)\",\n//   },\n//   bulkText: {\n//     fontSize: \"15px\",\n//     fontWeight: \"600\",\n//     color: \"#0d3b66\",\n//   },\n//   bulkPanel: {\n//     width: \"100%\",\n//     background: \"#f7faff\",\n//     border: \"1px solid #cfe2ff\",\n//     padding: \"20px\",\n//     borderRadius: \"14px\",\n//     marginTop: \"10px\",\n//     boxShadow: \"0 4px 14px rgba(0, 60, 120, 0.08)\",\n//   },\n//   bulkPanelTitle: {\n//     textAlign: \"center\",\n//     fontSize: \"18px\",\n//     fontWeight: \"700\",\n//     marginBottom: \"15px\",\n//   },\n//   bulkItemBox: {\n//     background: \"#ffffff\",\n//     border: \"1px solid #dbe5f5\",\n//     padding: \"18px\",\n//     borderRadius: \"12px\",\n//     marginBottom: \"16px\",\n//     boxShadow: \"0 2px 10px rgba(0, 0, 50, 0.05)\",\n//   },\n//   bulkItemTitle: {\n//     fontSize: \"16px\",\n//     fontWeight: \"600\",\n//     marginBottom: \"12px\",\n//     color: \"#0d3b66\",\n//     borderLeft: \"4px solid #007bff\",\n//     paddingLeft: \"10px\",\n//   },\n//   formCard: {\n//     borderRadius: \"16px\",\n//     padding: \"25px\",\n//     marginBottom: \"28px\",\n//     background: \"#ffffff\",\n//     boxShadow: \"0 4px 16px rgba(0, 0, 0, 0.08)\",\n//     border: \"1px solid #eef2f7\",\n//   },\n//   formTitle: {\n//     fontSize: \"21px\",\n//     fontWeight: \"700\",\n//     color: \"#0d3b66\",\n//     marginBottom: \"15px\",\n//   },\n//   formGrid: {\n//     display: \"grid\",\n//     gridTemplateColumns: \"repeat(auto-fit, minmax(230px, 1fr))\",\n//     gap: \"18px\",\n//   },\n//   formGroup: {\n//     display: \"flex\",\n//     flexDirection: \"column\",\n//     gap: \"6px\",\n//   },\n//   label: {\n//     fontWeight: \"600\",\n//     fontSize: \"14px\",\n//     color: \"#233142\",\n//   },\n//   input: {\n//     padding: \"10px\",\n//     borderRadius: \"10px\",\n//     border: \"1px solid #cfd6e0\",\n//     background: \"#f8fafc\",\n//     transition: \"0.2s ease\",\n//     fontSize: \"14px\",\n//   },\n//   select: {\n//     padding: \"10px\",\n//     borderRadius: \"10px\",\n//     border: \"1px solid #cfd6e0\",\n//     background: \"#f8fafc\",\n//     transition: \"0.2s ease\",\n//     fontSize: \"14px\",\n//   },\n//   textarea: {\n//     padding: \"10px\",\n//     borderRadius: \"10px\",\n//     border: \"1px solid #cfd6e0\",\n//     background: \"#f8fafc\",\n//     transition: \"0.2s ease\",\n//     resize: \"none\",\n//     minHeight: \"80px\",\n//     fontSize: \"14px\",\n//   },\n//   fileInput: {\n//     padding: \"8px\",\n//     fontSize: \"13px\",\n//   },\n//   categoryRow: {\n//     display: \"flex\",\n//     gap: \"10px\",\n//     alignItems: \"center\",\n//   },\n//   addCategoryBox: {\n//     gridColumn: \"1 / -1\",\n//     background: \"#f1f7ff\",\n//     border: \"1px solid #cfe1ff\",\n//     padding: \"16px\",\n//     borderRadius: \"12px\",\n//   },\n//   preview: {\n//     width: \"110px\",\n//     height: \"110px\",\n//     borderRadius: \"12px\",\n//     marginTop: \"10px\",\n//     objectFit: \"cover\",\n//     border: \"1px solid #b7c9e2\",\n//   },\n//   formActions: {\n//     marginTop: \"15px\",\n//     display: \"flex\",\n//     gap: \"12px\",\n//     flexWrap: \"wrap\",\n//   },\n//   btnPrimary: {\n//     background: \"#007bff\",\n//     color: \"#fff\",\n//     border: \"none\",\n//     borderRadius: \"10px\",\n//     padding: \"9px 16px\",\n//     fontWeight: \"600\",\n//     cursor: \"pointer\",\n//     transition: \"0.25s ease\",\n//   },\n//   btnSmall: {\n//     background: \"#43a047\",\n//     color: \"#fff\",\n//     border: \"none\",\n//     borderRadius: \"10px\",\n//     padding: \"9px 16px\",\n//     fontWeight: \"600\",\n//     cursor: \"pointer\",\n//     transition: \"0.25s ease\",\n//   },\n//   btnDelete: {\n//     background: \"#e63946\",\n//     color: \"#fff\",\n//     border: \"none\",\n//     borderRadius: \"10px\",\n//     padding: \"9px 16px\",\n//     fontWeight: \"600\",\n//     cursor: \"pointer\",\n//     transition: \"0.25s ease\",\n//   },\n//   btnCancel: {\n//     background: \"#adb5bd\",\n//     color: \"#fff\",\n//     border: \"none\",\n//     borderRadius: \"10px\",\n//     padding: \"9px 16px\",\n//     fontWeight: \"600\",\n//     cursor: \"pointer\",\n//     transition: \"0.25s ease\",\n//   },\n//   csvControls: {\n//     borderRadius: \"12px\",\n//     padding: \"16px\",\n//     background: \"#f7faff\",\n//     border: \"1px solid #d8e6ff\",\n//     display: \"flex\",\n//     alignItems: \"center\",\n//     justifyContent: \"space-between\",\n//     marginBottom: \"28px\",\n//     flexWrap: \"wrap\",\n//     gap: \"12px\",\n//   },\n//   tableCard: {\n//     background: \"#fff\",\n//     borderRadius: \"14px\",\n//     padding: \"20px\",\n//     boxShadow: \"0 4px 18px rgba(0, 0, 0, 0.08)\",\n//     border: \"1px solid #eef2f7\",\n//   },\n//   tableHeader: {\n//     display: \"flex\",\n//     justifyContent: \"space-between\",\n//     marginBottom: \"15px\",\n//   },\n//   tableTitle: {\n//     fontSize: \"21px\",\n//     fontWeight: \"700\",\n//     color: \"#0d3b66\",\n//   },\n//   totalCount: {\n//     fontSize: \"15px\",\n//     color: \"#6c757d\",\n//     fontWeight: \"600\",\n//   },\n//   tableWrapper: {\n//     overflowX: \"auto\",\n//   },\n//   table: {\n//     width: \"100%\",\n//     borderCollapse: \"collapse\",\n//     fontSize: \"14px\",\n//   },\n//   th: {\n//     background: \"#e9f2ff\",\n//     padding: \"12px\",\n//     fontWeight: \"700\",\n//     color: \"#0d3b66\",\n//     textAlign: \"left\",\n//     whiteSpace: \"nowrap\",\n//   },\n//   tr: {\n//     borderBottom: \"1px solid #edf2f7\",\n//   },\n//   td: {\n//     padding: \"12px 10px\",\n//     whiteSpace: \"nowrap\",\n//   },\n//   tableImg: {\n//     width: \"55px\",\n//     height: \"55px\",\n//     borderRadius: \"8px\",\n//     objectFit: \"cover\",\n//     border: \"1px solid #cfd9e5\",\n//   },\n//   statusActive: {\n//     background: \"#93d8ba\",\n//     padding: \"7px 12px\",\n//     borderRadius: \"8px\",\n//     color: \"black\",\n//     fontWeight: \"600\",\n//     border: \"none\",\n//     cursor: \"pointer\",\n//   },\n//   statusInactive: {\n//     background: \"#d9b1b1\",\n//     padding: \"7px 12px\",\n//     borderRadius: \"8px\",\n//     color: \"black\",\n//     fontWeight: \"600\",\n//     border: \"none\",\n//     cursor: \"pointer\",\n//   },\n//   menuButton: {\n//     background: \"#f0f0f0\",\n//     border: \"none\",\n//     borderRadius: \"6px\",\n//     padding: \"6px 12px\",\n//     fontSize: \"20px\",\n//     fontWeight: \"bold\",\n//     cursor: \"pointer\",\n//     transition: \"0.2s ease\",\n//   },\n//   dropdown: {\n//     position: \"absolute\",\n//     right: \"0\",\n//     top: \"35px\",\n//     background: \"#fff\",\n//     border: \"1px solid #ddd\",\n//     borderRadius: \"8px\",\n//     boxShadow: \"0 4px 12px rgba(0,0,0,0.15)\",\n//     zIndex: \"100\",\n//     minWidth: \"140px\",\n//   },\n//   dropdownItem: {\n//     display: \"block\",\n//     width: \"100%\",\n//     padding: \"10px 15px\",\n//     background: \"transparent\",\n//     border: \"none\",\n//     textAlign: \"left\",\n//     cursor: \"pointer\",\n//     fontSize: \"14px\",\n//     fontWeight: \"500\",\n//     transition: \"0.2s ease\",\n//     borderBottom: \"1px solid #f0f0f0\",\n//   },\n//   dropdownItemDelete: {\n//     display: \"block\",\n//     width: \"100%\",\n//     padding: \"10px 15px\",\n//     background: \"transparent\",\n//     border: \"none\",\n//     textAlign: \"left\",\n//     cursor: \"pointer\",\n//     fontSize: \"14px\",\n//     fontWeight: \"500\",\n//     color: \"#e63946\",\n//     transition: \"0.2s ease\",\n//   },\n//   pagination: {\n//     marginTop: \"18px\",\n//     display: \"flex\",\n//     justifyContent: \"center\",\n//     gap: \"10px\",\n//     flexWrap: \"wrap\",\n//   },\n//   paginationBtn: {\n//     padding: \"9px 13px\",\n//     borderRadius: \"8px\",\n//     background: \"#fff\",\n//     border: \"1px solid #ddd\",\n//     cursor: \"pointer\",\n//     fontSize: \"14px\",\n//   },\n//   paginationBtnActive: {\n//     padding: \"9px 13px\",\n//     borderRadius: \"8px\",\n//     background: \"#007bff\",\n//     color: \"white\",\n//     border: \"1px solid #0062cc\",\n//     cursor: \"pointer\",\n//     fontSize: \"14px\",\n//   },\n//   modalOverlay: {\n//     position: \"fixed\",\n//     top: 0,\n//     left: 0,\n//     right: 0,\n//     bottom: 0,\n//     background: \"rgba(0, 0, 0, 0.5)\",\n//     display: \"flex\",\n//     justifyContent: \"center\",\n//     alignItems: \"center\",\n//     zIndex: \"1000\",\n//     padding: \"20px\",\n//   },\n//   modal: {\n//     background: \"#fff\",\n//     borderRadius: \"16px\",\n//     padding: \"30px\",\n//     maxWidth: \"700px\",\n//     width: \"100%\",\n//     maxHeight: \"90vh\",\n//     overflowY: \"auto\",\n//     boxShadow: \"0 10px 40px rgba(0, 0, 0, 0.3)\",\n//   },\n//   modalTitle: {\n//     fontSize: \"22px\",\n//     fontWeight: \"700\",\n//     color: \"#0d3b66\",\n//     marginBottom: \"20px\",\n//     textAlign: \"center\",\n//   },\n\n// }\nimport React, { useEffect, useState, useRef } from \"react\";\nimport axios from \"axios\";\nimport \"./PriceList.css\"; // <-- new CSS\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst API_URL = \"https://grocerrybackend.vercel.app/api/prices\";\nconst CATEGORY_URL = \"https://grocerrybackend.vercel.app/api/categories\";\nexport default function PriceList() {\n  _s();\n  const [items, setItems] = useState([]);\n  const [categories, setCategories] = useState([]);\n  const [subcategories, setSubcategories] = useState([]);\n  const [isMobile, setIsMobile] = useState(window.innerWidth < 768);\n  const [search, setSearch] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n\n  // FORM state\n  const [form, setForm] = useState({\n    name: \"\",\n    category: \"\",\n    subcategory: \"\",\n    description: \"\",\n    basePrice: \"\",\n    difference: \"\",\n    validTill: \"\",\n    file: null\n  });\n  const [editId, setEditId] = useState(null);\n  const [isCopyMode, setIsCopyMode] = useState(false);\n  const [showForm, setShowForm] = useState(false);\n  const [showModal, setShowModal] = useState(false);\n  const [activeMenu, setActiveMenu] = useState(null);\n  const [addingCategory, setAddingCategory] = useState(false);\n  const [newCategoryName, setNewCategoryName] = useState(\"\");\n  const [newCategoryImage, setNewCategoryImage] = useState(null);\n  const [newCategoryPreview, setNewCategoryPreview] = useState(null);\n  const [addingSub, setAddingSub] = useState(false);\n  const [newSubName, setNewSubName] = useState(\"\");\n  const [newSubImage, setNewSubImage] = useState(null);\n  const [newSubPreview, setNewSubPreview] = useState(null);\n  const [selectedItems, setSelectedItems] = useState([]);\n  const [bulkMode, setBulkMode] = useState(false);\n  const [csvFile, setCsvFile] = useState(null);\n  const csvInputRef = useRef();\n  const [currentPage, setCurrentPage] = useState(1);\n  const itemsPerPage = 30;\n\n  // load categories then items\n  useEffect(() => {\n    fetchCategories();\n  }, []);\n  useEffect(() => {\n    if (categories.length) fetchItems();\n  }, [categories]);\n  useEffect(() => {\n    const handleResize = () => setIsMobile(window.innerWidth < 768);\n    window.addEventListener(\"resize\", handleResize);\n    return () => window.removeEventListener(\"resize\", handleResize);\n  }, []);\n  const fetchItems = async () => {\n    try {\n      setLoading(true);\n      const res = await axios.get(API_URL);\n      if (res.data && res.data.success) {\n        const raw = res.data.data || [];\n        // enrich categories/subcategories to names (if categories loaded)\n        const enriched = raw.map(item => {\n          var _cat$subcategories;\n          const cat = categories.find(c => {\n            var _item$category;\n            return c._id === item.category || c._id === ((_item$category = item.category) === null || _item$category === void 0 ? void 0 : _item$category._id);\n          });\n          const sub = cat === null || cat === void 0 ? void 0 : (_cat$subcategories = cat.subcategories) === null || _cat$subcategories === void 0 ? void 0 : _cat$subcategories.find(s => {\n            var _item$subcategory;\n            return s._id === item.subcategory || s._id === ((_item$subcategory = item.subcategory) === null || _item$subcategory === void 0 ? void 0 : _item$subcategory._id);\n          });\n          return {\n            ...item,\n            category: cat ? {\n              _id: cat._id,\n              name: cat.name\n            } : item.category,\n            subcategory: sub ? {\n              _id: sub._id,\n              name: sub.name\n            } : item.subcategory\n          };\n        });\n        setItems(enriched);\n      }\n    } catch (err) {\n      console.error(\"Fetch items error\", err);\n    } finally {\n      setLoading(false);\n    }\n  };\n  const fetchCategories = async () => {\n    try {\n      const res = await axios.get(CATEGORY_URL);\n      if (res.data && res.data.success) setCategories(res.data.categories || []);\n    } catch (err) {\n      console.error(\"Fetch categories error\", err);\n    }\n  };\n  useEffect(() => {\n    if (!form.category) {\n      setSubcategories([]);\n      setForm(prev => ({\n        ...prev,\n        subcategory: \"\"\n      }));\n      return;\n    }\n    const cat = categories.find(c => c._id === form.category);\n    setSubcategories((cat === null || cat === void 0 ? void 0 : cat.subcategories) || []);\n    const exists = ((cat === null || cat === void 0 ? void 0 : cat.subcategories) || []).some(s => s._id === form.subcategory);\n    if (!exists) setForm(prev => ({\n      ...prev,\n      subcategory: \"\"\n    }));\n  }, [form.category, categories]);\n\n  // form handlers (kept minimal)\n  const handleChange = e => {\n    const {\n      name,\n      value,\n      files\n    } = e.target;\n    if (files && files.length) setForm(p => ({\n      ...p,\n      file: files[0]\n    }));else setForm(p => ({\n      ...p,\n      [name]: value\n    }));\n  };\n\n  // CSV export helpers (kept unchanged from your code)\n  const handleExportCsv = () => {\n    if (!items.length) return alert(\"No items to export\");\n    const header = [\"id\", \"name\", \"categoryName\", \"subcategoryName\", \"basePrice\", \"difference\", \"finalPrice\", \"status\", \"validTill\", \"description\", \"imageUrl\"];\n    const rows = items.map(p => {\n      var _p$category, _p$subcategory;\n      return [p._id, p.name || \"\", ((_p$category = p.category) === null || _p$category === void 0 ? void 0 : _p$category.name) || \"\", ((_p$subcategory = p.subcategory) === null || _p$subcategory === void 0 ? void 0 : _p$subcategory.name) || \"\", p.basePrice || \"\", p.difference || \"\", Number(p.basePrice || 0) + Number(p.difference || 0) || \"\", p.status || \"\", p.validTill ? new Date(p.validTill).toISOString().split(\"T\")[0] : \"\", p.description || \"\", p.image || \"\"];\n    });\n    const csvArray = [header, ...rows];\n    const csvContent = \"data:text/csv;charset=utf-8,\" + csvArray.map(r => r.map(c => `\"${String(c).replace(/\"/g, '\"\"')}\"`).join(\",\")).join(\"\\n\");\n    const encodedUri = encodeURI(csvContent);\n    const link = document.createElement(\"a\");\n    link.href = encodedUri;\n    link.download = `all_prices_${Date.now()}.csv`;\n    link.click();\n  };\n  const handleExportSelectedCsv = () => {\n    if (!selectedItems.length) return alert(\"Select items to export\");\n    const selectedData = items.filter(x => selectedItems.includes(x._id));\n    const header = [\"id\", \"name\", \"categoryName\", \"subcategoryName\", \"basePrice\", \"difference\", \"finalPrice\", \"status\", \"validTill\", \"description\", \"imageUrl\"];\n    const rows = selectedData.map(p => {\n      var _p$category2, _p$subcategory2;\n      return [p._id, p.name || \"\", ((_p$category2 = p.category) === null || _p$category2 === void 0 ? void 0 : _p$category2.name) || \"\", ((_p$subcategory2 = p.subcategory) === null || _p$subcategory2 === void 0 ? void 0 : _p$subcategory2.name) || \"\", p.basePrice || \"\", p.difference || \"\", Number(p.basePrice || 0) + Number(p.difference || 0) || \"\", p.status || \"\", p.validTill ? new Date(p.validTill).toISOString().split(\"T\")[0] : \"\", p.description || \"\", p.image || \"\"];\n    });\n    const csvArray = [header, ...rows];\n    const csvContent = \"data:text/csv;charset=utf-8,\" + csvArray.map(r => r.map(c => `\"${String(c).replace(/\"/g, '\"\"')}\"`).join(\",\")).join(\"\\n\");\n    const encodedUri = encodeURI(csvContent);\n    const link = document.createElement(\"a\");\n    link.href = encodedUri;\n    link.download = `selected_prices_${Date.now()}.csv`;\n    link.click();\n  };\n  const filteredItems = items.filter(item => {\n    var _item$category2, _item$subcategory2;\n    const t = (search || \"\").toLowerCase();\n    return (item.name || \"\").toLowerCase().includes(t) || (((_item$category2 = item.category) === null || _item$category2 === void 0 ? void 0 : _item$category2.name) || \"\").toLowerCase().includes(t) || (((_item$subcategory2 = item.subcategory) === null || _item$subcategory2 === void 0 ? void 0 : _item$subcategory2.name) || \"\").toLowerCase().includes(t);\n  });\n  const indexOfLast = currentPage * itemsPerPage;\n  const currentItems = filteredItems.slice(indexOfLast - itemsPerPage, indexOfLast);\n  const totalPages = Math.max(1, Math.ceil(filteredItems.length / itemsPerPage));\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"pl-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      className: \"pl-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        className: \"pl-title\",\n        children: \"Product Management\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2579,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"pl-top-row\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pl-search\",\n          children: /*#__PURE__*/_jsxDEV(\"input\", {\n            className: \"pl-search-input\",\n            type: \"text\",\n            placeholder: \"Search product, category or subcategory...\",\n            value: search,\n            onChange: e => {\n              setSearch(e.target.value);\n              setCurrentPage(1);\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2584,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2583,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pl-add-wrap\",\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"pl-add-btn\",\n            onClick: () => {\n              setShowForm(!showForm);\n              setEditId(null);\n              setIsCopyMode(false);\n            },\n            children: showForm ? \"‚úñ Close Form\" : \"‚ûï Add Product\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2594,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2593,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 2582,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 2578,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"pl-csv-controls\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"pl-csv-left\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          ref: csvInputRef,\n          className: \"pl-file\",\n          type: \"file\",\n          accept: \".csv\",\n          onChange: e => setCsvFile(e.target.files[0])\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2607,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"pl-btn small\",\n          onClick: () => {\n            if (!csvFile) return alert(\"Choose CSV\");\n            const fd = new FormData();\n            fd.append(\"file\", csvFile);\n            axios.post(`${API_URL}/import`, fd).then(res => {\n              alert(\"Imported\");\n              fetchItems();\n              if (csvInputRef.current) csvInputRef.current.value = null;\n              setCsvFile(null);\n            }).catch(() => alert(\"Import failed\"));\n          },\n          children: \"Import CSV\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2608,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 2606,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"pl-csv-right\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"pl-btn\",\n          onClick: handleExportCsv,\n          children: \"Export All CSV\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2615,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"pl-btn small\",\n          onClick: handleExportSelectedCsv,\n          children: \"Export Selected CSV\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2616,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 2614,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 2605,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"pl-table-card\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"pl-table-header\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"pl-items-title\",\n          children: \"\\uD83D\\uDCCB Items\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2623,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pl-total\",\n          children: [\"Total: \", filteredItems.length]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2624,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 2622,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"pl-table-wrapper\",\n        children: /*#__PURE__*/_jsxDEV(\"table\", {\n          className: \"pl-table\",\n          children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n            children: /*#__PURE__*/_jsxDEV(\"tr\", {\n              children: [/*#__PURE__*/_jsxDEV(\"th\", {\n                children: /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"checkbox\",\n                  checked: selectedItems.length === filteredItems.length && filteredItems.length > 0,\n                  onChange: () => {\n                    if (selectedItems.length === filteredItems.length) setSelectedItems([]);else setSelectedItems(filteredItems.map(x => x._id));\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2631,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2631,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Sr\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2632,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Image\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2633,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                className: \"col-name\",\n                children: \"Name\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2634,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Category\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2635,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Subcat\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2636,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Base\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2637,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Diff\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2638,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Final\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2639,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Status\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2640,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Valid Till\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2641,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Actions\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2642,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 2630,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2629,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n            children: [currentItems.map((item, i) => {\n              var _item$category3, _item$subcategory3;\n              return /*#__PURE__*/_jsxDEV(\"tr\", {\n                className: \"pl-row\",\n                children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                  children: /*#__PURE__*/_jsxDEV(\"input\", {\n                    type: \"checkbox\",\n                    checked: selectedItems.includes(item._id),\n                    onChange: () => setSelectedItems(prev => prev.includes(item._id) ? prev.filter(x => x !== item._id) : [...prev, item._id])\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2649,\n                    columnNumber: 23\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2649,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  children: (currentPage - 1) * itemsPerPage + (i + 1)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2650,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  className: \"pl-imgcell\",\n                  children: item.image ? /*#__PURE__*/_jsxDEV(\"img\", {\n                    className: \"pl-img\",\n                    src: item.image,\n                    alt: \"\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2651,\n                    columnNumber: 60\n                  }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"pl-noimg\",\n                    children: \"No Img\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2651,\n                    columnNumber: 113\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2651,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  className: \"pl-namecell\",\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"pl-name-text\",\n                    children: item.name || \"-\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2655,\n                    columnNumber: 21\n                  }, this), item.description ? /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"pl-name-sub\",\n                    children: item.description\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2656,\n                    columnNumber: 41\n                  }, this) : null]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2654,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  children: ((_item$category3 = item.category) === null || _item$category3 === void 0 ? void 0 : _item$category3.name) || \"-\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2659,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  children: ((_item$subcategory3 = item.subcategory) === null || _item$subcategory3 === void 0 ? void 0 : _item$subcategory3.name) || \"-\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2660,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  children: [\"\\u20B9\", item.basePrice]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2662,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  children: item.difference || 0\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2663,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  children: [\"\\u20B9\", Number(item.basePrice || 0) + Number(item.difference || 0)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2664,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  children: /*#__PURE__*/_jsxDEV(\"button\", {\n                    className: `pl-status ${item.status === \"active\" ? \"active\" : \"inactive\"}`,\n                    onClick: () => {\n                      const newStatus = item.status === \"active\" ? \"inactive\" : \"active\";\n                      axios.put(`${API_URL}/status/${item._id}`, {\n                        status: newStatus\n                      }).then(() => setItems(prev => prev.map(x => x._id === item._id ? {\n                        ...x,\n                        status: newStatus\n                      } : x))).catch(() => alert(\"Status update failed\"));\n                    },\n                    children: item.status === \"active\" ? \"Active\" : \"Inactive\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2667,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2666,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  children: item.validTill ? new Date(item.validTill).toLocaleDateString() : \"-\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2673,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  className: \"pl-actioncell\",\n                  children: /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"pl-action-wrap\",\n                    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                      className: \"pl-menu-btn\",\n                      onClick: () => setActiveMenu(activeMenu === item._id ? null : item._id),\n                      children: \"\\u22EE\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 2677,\n                      columnNumber: 23\n                    }, this), activeMenu === item._id && /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"pl-dropdown\",\n                      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                        className: \"pl-dropdown-item\",\n                        onClick: () => {\n                          handleEdit(item);\n                          setActiveMenu(null);\n                        },\n                        children: \"\\u270F Edit\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 2680,\n                        columnNumber: 27\n                      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                        className: \"pl-dropdown-item\",\n                        onClick: () => {\n                          setIsCopyMode(true);\n                          handleCopyToEdit(item);\n                          setActiveMenu(null);\n                        },\n                        children: \"\\uD83D\\uDCC4 Copy\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 2681,\n                        columnNumber: 27\n                      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                        className: \"pl-dropdown-item danger\",\n                        onClick: () => {\n                          if (window.confirm(\"Delete?\")) {\n                            axios.delete(`${API_URL}/${item._id}`).then(() => {\n                              setItems(prev => prev.filter(x => x._id !== item._id));\n                              setActiveMenu(null);\n                            }).catch(() => alert(\"Delete failed\"));\n                          }\n                        },\n                        children: \"\\uD83D\\uDDD1 Delete\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 2682,\n                        columnNumber: 27\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 2679,\n                      columnNumber: 25\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2676,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2675,\n                  columnNumber: 19\n                }, this)]\n              }, item._id, true, {\n                fileName: _jsxFileName,\n                lineNumber: 2648,\n                columnNumber: 17\n              }, this);\n            }), currentItems.length === 0 && /*#__PURE__*/_jsxDEV(\"tr\", {\n              children: /*#__PURE__*/_jsxDEV(\"td\", {\n                colSpan: \"12\",\n                className: \"pl-no-data\",\n                children: \"No items found\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2691,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2691,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 2646,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2628,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2627,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"pl-pagination\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"pl-page-btn\",\n          disabled: currentPage === 1,\n          onClick: () => setCurrentPage(p => p - 1),\n          children: \"Previous\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2698,\n          columnNumber: 11\n        }, this), Array.from({\n          length: totalPages\n        }, (_, i) => /*#__PURE__*/_jsxDEV(\"button\", {\n          className: `pl-page-btn ${currentPage === i + 1 ? \"active\" : \"\"}`,\n          onClick: () => setCurrentPage(i + 1),\n          children: i + 1\n        }, i, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2700,\n          columnNumber: 13\n        }, this)), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"pl-page-btn\",\n          disabled: currentPage === totalPages,\n          onClick: () => setCurrentPage(p => p + 1),\n          children: \"Next\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2702,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 2697,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 2621,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 2577,\n    columnNumber: 5\n  }, this);\n\n  // small helper functions inside (kept local for brevity)\n  function handleEdit(item) {\n    var _item$category4, _item$category4$_id, _item$subcategory4, _item$subcategory4$_i, _item$basePrice, _item$difference;\n    setForm({\n      name: item.name || \"\",\n      category: ((_item$category4 = item.category) === null || _item$category4 === void 0 ? void 0 : (_item$category4$_id = _item$category4._id) === null || _item$category4$_id === void 0 ? void 0 : _item$category4$_id.toString()) || \"\",\n      subcategory: ((_item$subcategory4 = item.subcategory) === null || _item$subcategory4 === void 0 ? void 0 : (_item$subcategory4$_i = _item$subcategory4._id) === null || _item$subcategory4$_i === void 0 ? void 0 : _item$subcategory4$_i.toString()) || \"\",\n      description: item.description || \"\",\n      basePrice: (_item$basePrice = item.basePrice) !== null && _item$basePrice !== void 0 ? _item$basePrice : \"\",\n      difference: (_item$difference = item.difference) !== null && _item$difference !== void 0 ? _item$difference : \"\",\n      validTill: item.validTill ? item.validTill.split(\"T\")[0] : \"\",\n      file: null\n    });\n    const cat = categories.find(c => {\n      var _item$category5;\n      return c._id === ((_item$category5 = item.category) === null || _item$category5 === void 0 ? void 0 : _item$category5._id);\n    });\n    setSubcategories((cat === null || cat === void 0 ? void 0 : cat.subcategories) || []);\n    setEditId(item._id);\n    setIsCopyMode(false);\n    setShowModal(true);\n    setActiveMenu(null);\n  }\n  function handleCopyToEdit(item) {\n    var _item$category6, _item$category6$_id, _item$subcategory5, _item$subcategory5$_i, _item$basePrice2, _item$difference2;\n    setForm({\n      name: item.name || \"\",\n      category: ((_item$category6 = item.category) === null || _item$category6 === void 0 ? void 0 : (_item$category6$_id = _item$category6._id) === null || _item$category6$_id === void 0 ? void 0 : _item$category6$_id.toString()) || \"\",\n      subcategory: ((_item$subcategory5 = item.subcategory) === null || _item$subcategory5 === void 0 ? void 0 : (_item$subcategory5$_i = _item$subcategory5._id) === null || _item$subcategory5$_i === void 0 ? void 0 : _item$subcategory5$_i.toString()) || \"\",\n      description: item.description || \"\",\n      basePrice: (_item$basePrice2 = item.basePrice) !== null && _item$basePrice2 !== void 0 ? _item$basePrice2 : \"\",\n      difference: (_item$difference2 = item.difference) !== null && _item$difference2 !== void 0 ? _item$difference2 : \"\",\n      validTill: item.validTill ? item.validTill.split(\"T\")[0] : \"\",\n      file: null\n    });\n    const cat = categories.find(c => {\n      var _item$category7;\n      return c._id === ((_item$category7 = item.category) === null || _item$category7 === void 0 ? void 0 : _item$category7._id);\n    });\n    setSubcategories((cat === null || cat === void 0 ? void 0 : cat.subcategories) || []);\n    setEditId(null);\n    setIsCopyMode(true);\n    setShowModal(true);\n    setActiveMenu(null);\n  }\n}\n_s(PriceList, \"wLBaTBYoFYkfeIXPfMjyyRo0KDs=\");\n_c = PriceList;\nvar _c;\n$RefreshReg$(_c, \"PriceList\");","map":{"version":3,"names":["React","useEffect","useState","useRef","axios","jsxDEV","_jsxDEV","API_URL","CATEGORY_URL","PriceList","_s","items","setItems","categories","setCategories","subcategories","setSubcategories","isMobile","setIsMobile","window","innerWidth","search","setSearch","loading","setLoading","form","setForm","name","category","subcategory","description","basePrice","difference","validTill","file","editId","setEditId","isCopyMode","setIsCopyMode","showForm","setShowForm","showModal","setShowModal","activeMenu","setActiveMenu","addingCategory","setAddingCategory","newCategoryName","setNewCategoryName","newCategoryImage","setNewCategoryImage","newCategoryPreview","setNewCategoryPreview","addingSub","setAddingSub","newSubName","setNewSubName","newSubImage","setNewSubImage","newSubPreview","setNewSubPreview","selectedItems","setSelectedItems","bulkMode","setBulkMode","csvFile","setCsvFile","csvInputRef","currentPage","setCurrentPage","itemsPerPage","fetchCategories","length","fetchItems","handleResize","addEventListener","removeEventListener","res","get","data","success","raw","enriched","map","item","_cat$subcategories","cat","find","c","_item$category","_id","sub","s","_item$subcategory","err","console","error","prev","exists","some","handleChange","e","value","files","target","p","handleExportCsv","alert","header","rows","_p$category","_p$subcategory","Number","status","Date","toISOString","split","image","csvArray","csvContent","r","String","replace","join","encodedUri","encodeURI","link","document","createElement","href","download","now","click","handleExportSelectedCsv","selectedData","filter","x","includes","_p$category2","_p$subcategory2","filteredItems","_item$category2","_item$subcategory2","t","toLowerCase","indexOfLast","currentItems","slice","totalPages","Math","max","ceil","className","children","fileName","_jsxFileName","lineNumber","columnNumber","type","placeholder","onChange","onClick","ref","accept","fd","FormData","append","post","then","current","catch","checked","i","_item$category3","_item$subcategory3","src","alt","newStatus","put","toLocaleDateString","handleEdit","handleCopyToEdit","confirm","delete","colSpan","disabled","Array","from","_","_item$category4","_item$category4$_id","_item$subcategory4","_item$subcategory4$_i","_item$basePrice","_item$difference","toString","_item$category5","_item$category6","_item$category6$_id","_item$subcategory5","_item$subcategory5$_i","_item$basePrice2","_item$difference2","_item$category7","_c","$RefreshReg$"],"sources":["E:/infyle/Grocerry_final/frontend/src/pages/PriceList.jsx"],"sourcesContent":["\r\n\r\n// // import React, { useEffect, useState, useRef } from \"react\";\r\n// // import axios from \"axios\";\r\n// // import \"./PriceList.css\";\r\n\r\n// // const API_URL = \"https://grocerrybackend.vercel.app/api/prices\";\r\n// // const CATEGORY_URL = \"https://grocerrybackend.vercel.app/api/categories\";\r\n\r\n// // export default function PriceList() {\r\n// //   // DATA\r\n// //   const [items, setItems] = useState([]);\r\n// //   const [categories, setCategories] = useState([]);\r\n// //   const [subcategories, setSubcategories] = useState([]);\r\n\r\n// //   // UI state\r\n// //   const [isMobile, setIsMobile] = useState(window.innerWidth < 768);\r\n// //   const [search, setSearch] = useState(\"\");\r\n// //   const [loading, setLoading] = useState(false);\r\n\r\n// //   // FORM state\r\n// //   const [form, setForm] = useState({\r\n// //     name: \"\",\r\n// //     category: \"\",\r\n// //     subcategory: \"\",\r\n// //     description: \"\",\r\n// //     basePrice: \"\",\r\n// //     difference: \"\",\r\n// //     validTill: \"\",\r\n// //     file: null,\r\n// //   });\r\n\r\n// //   const [editId, setEditId] = useState(null);\r\n// //   const [isCopyMode, setIsCopyMode] = useState(false);\r\n\r\n// //   // category/subcategory add UI\r\n// //   const [addingCategory, setAddingCategory] = useState(false);\r\n// //   const [newCategoryName, setNewCategoryName] = useState(\"\");\r\n// //   const [newCategoryImage, setNewCategoryImage] = useState(null);\r\n// //   const [newCategoryPreview, setNewCategoryPreview] = useState(null);\r\n\r\n// //   const [addingSub, setAddingSub] = useState(false);\r\n// //   const [newSubName, setNewSubName] = useState(\"\");\r\n// //   const [newSubImage, setNewSubImage] = useState(null);\r\n// //   const [newSubPreview, setNewSubPreview] = useState(null);\r\n\r\n// //   // bulk\r\n// //   const [selectedItems, setSelectedItems] = useState([]);\r\n// //   const [bulkMode, setBulkMode] = useState(false);\r\n\r\n// //   // csv import\r\n// //   const [csvFile, setCsvFile] = useState(null);\r\n// //   const csvInputRef = useRef();\r\n\r\n// //   // pagination\r\n// //   const [currentPage, setCurrentPage] = useState(1);\r\n// //   const itemsPerPage = 30;\r\n\r\n// //   // -------------------- FETCH --------------------\r\n// //   useEffect(() => {\r\n// //     fetchItems();\r\n// //     fetchCategories();\r\n\r\n// //     const handleResize = () => setIsMobile(window.innerWidth < 768);\r\n// //     window.addEventListener(\"resize\", handleResize);\r\n// //     return () => window.removeEventListener(\"resize\", handleResize);\r\n// //     // eslint-disable-next-line\r\n// //   }, []);\r\n\r\n// //   const fetchItems = async () => {\r\n// //     try {\r\n// //       setLoading(true);\r\n// //       const res = await axios.get(API_URL);\r\n// //       if (res.data && res.data.success) setItems(res.data.data || []);\r\n// //     } catch (err) {\r\n// //       console.error(\"Fetch items error\", err);\r\n// //       alert(\"Could not fetch items\");\r\n// //     } finally {\r\n// //       setLoading(false);\r\n// //     }\r\n// //   };\r\n\r\n// //   const fetchCategories = async () => {\r\n// //     try {\r\n// //       const res = await axios.get(CATEGORY_URL);\r\n// //       if (res.data && res.data.success) setCategories(res.data.categories || []);\r\n// //     } catch (err) {\r\n// //       console.error(\"Fetch categories error\", err);\r\n// //       alert(\"Could not fetch categories\");\r\n// //     }\r\n// //   };\r\n\r\n// //   // -------------------- SUBCATEGORY AUTO LOAD --------------------\r\n// //   useEffect(() => {\r\n// //     if (!form.category) {\r\n// //       setSubcategories([]);\r\n// //       setForm((prev) => ({ ...prev, subcategory: \"\" }));\r\n// //       return;\r\n// //     }\r\n\r\n// //     const cat = categories.find((c) => c._id === form.category);\r\n// //     const subs = (cat && cat.subcategories) || [];\r\n// //     setSubcategories(subs);\r\n\r\n// //     // keep current subcategory if exists in new subs, otherwise reset\r\n// //     const exists = subs.some((s) => s._id === form.subcategory);\r\n// //     if (!exists) setForm((prev) => ({ ...prev, subcategory: \"\" }));\r\n// //   }, [form.category, categories]);\r\n\r\n// //   // -------------------- CREATE CATEGORY --------------------\r\n// //   const handleCreateCategory = async () => {\r\n// //     if (!newCategoryName.trim()) return alert(\"Enter category name\");\r\n// //     try {\r\n// //       const fd = new FormData();\r\n// //       fd.append(\"name\", newCategoryName.trim());\r\n// //       if (newCategoryImage) fd.append(\"image\", newCategoryImage);\r\n\r\n// //       const res = await axios.post(CATEGORY_URL, fd);\r\n// //       if (res.data && res.data.success) {\r\n// //         alert(\"Category created\");\r\n// //         setNewCategoryName(\"\");\r\n// //         setNewCategoryImage(null);\r\n// //         setNewCategoryPreview(null);\r\n// //         setAddingCategory(false);\r\n// //         fetchCategories();\r\n// //       } else {\r\n// //         alert(\"Category creation failed\");\r\n// //       }\r\n// //     } catch (err) {\r\n// //       console.error(\"Create category error\", err);\r\n// //       alert(\"Category creation failed\");\r\n// //     }\r\n// //   };\r\n\r\n// //   // -------------------- CREATE SUBCATEGORY --------------------\r\n// //   const handleCreateSub = async () => {\r\n// //     if (!newSubName.trim()) return alert(\"Enter subcategory name\");\r\n// //     if (!form.category) return alert(\"Select category first\");\r\n\r\n// //     try {\r\n// //       const fd = new FormData();\r\n// //       fd.append(\"name\", newSubName.trim());\r\n// //       if (newSubImage) fd.append(\"image\", newSubImage);\r\n\r\n// //       const res = await axios.post(`${CATEGORY_URL}/${form.category}/sub`, fd);\r\n// //       if (res.data && res.data.success) {\r\n// //         alert(\"Subcategory created\");\r\n// //         setNewSubName(\"\");\r\n// //         setNewSubImage(null);\r\n// //         setNewSubPreview(null);\r\n// //         setAddingSub(false);\r\n// //         fetchCategories();\r\n// //       } else {\r\n// //         alert(\"Subcategory creation failed\");\r\n// //       }\r\n// //     } catch (err) {\r\n// //       console.error(\"Create sub error\", err);\r\n// //       alert(\"Subcategory creation failed\");\r\n// //     }\r\n// //   };\r\n\r\n// //   // -------------------- FORM HANDLING --------------------\r\n// //   const handleChange = (e) => {\r\n// //     const { name, value, files } = e.target;\r\n// //     if (files && files.length) {\r\n// //       // file input (both image for product and category/sub)\r\n// //       setForm((p) => ({ ...p, file: files[0] }));\r\n// //     } else {\r\n// //       setForm((p) => ({ ...p, [name]: value }));\r\n// //     }\r\n// //   };\r\n\r\n// //   // -------------------- SUBMIT (ADD / UPDATE / COPY) --------------------\r\n// //   const handleSubmit = async (e) => {\r\n// //     e.preventDefault();\r\n// //     setLoading(true);\r\n\r\n// //     try {\r\n// //       if (!form.name || !form.category || !form.basePrice) {\r\n// //         alert(\"Name, category & base price are required\");\r\n// //         setLoading(false);\r\n// //         return;\r\n// //       }\r\n\r\n// //       const fd = new FormData();\r\n// //       // append all keys (including 0 or empty string when necessary)\r\n// //       Object.keys(form).forEach((k) => {\r\n// //         const val = form[k];\r\n// //         if (val !== undefined && val !== null) {\r\n// //           fd.append(k, val);\r\n// //         }\r\n// //       });\r\n\r\n// //       let res;\r\n// //       if (isCopyMode) {\r\n// //         res = await axios.post(API_URL, fd);\r\n// //         alert(\"Copied as new item\");\r\n// //       } else if (editId) {\r\n// //         res = await axios.put(`${API_URL}/${editId}`, fd);\r\n// //         alert(\"Updated\");\r\n// //       } else {\r\n// //         res = await axios.post(API_URL, fd);\r\n// //         alert(\"Added\");\r\n// //       }\r\n\r\n// //       // refresh\r\n// //       await fetchItems();\r\n// //       await fetchCategories();\r\n\r\n// //       // reset\r\n// //       setForm({\r\n// //         name: \"\",\r\n// //         category: \"\",\r\n// //         subcategory: \"\",\r\n// //         description: \"\",\r\n// //         basePrice: \"\",\r\n// //         difference: \"\",\r\n// //         validTill: \"\",\r\n// //         file: null,\r\n// //       });\r\n// //       setEditId(null);\r\n// //       setIsCopyMode(false);\r\n// //     } catch (err) {\r\n// //       console.error(\"Save error\", err);\r\n// //       alert(\"Save failed\");\r\n// //     } finally {\r\n// //       setLoading(false);\r\n// //     }\r\n// //   };\r\n\r\n// //   // -------------------- EDIT --------------------\r\n// //   const handleEdit = (item) => {\r\n// //     setForm({\r\n// //       name: item.name || \"\",\r\n// //       category: item.category?._id?.toString() || \"\",\r\n// //       subcategory: item.subcategory?._id?.toString() || \"\",\r\n// //       description: item.description || \"\",\r\n// //       basePrice: item.basePrice ?? \"\",\r\n// //       difference: item.difference ?? \"\",\r\n// //       validTill: item.validTill ? item.validTill.split(\"T\")[0] : \"\",\r\n// //       file: null,\r\n// //     });\r\n\r\n// //     // preload subs for better UX\r\n// //     const cat = categories.find((c) => c._id === item.category?._id);\r\n// //     setSubcategories(cat?.subcategories || []);\r\n\r\n// //     setEditId(item._id);\r\n// //     setIsCopyMode(false);\r\n// //     window.scrollTo({ top: 0, behavior: \"smooth\" });\r\n// //   };\r\n\r\n// //   // -------------------- COPY --------------------\r\n// //   const handleCopyToEdit = (item) => {\r\n// //     setForm({\r\n// //       name: item.name || \"\",\r\n// //       category: item.category?._id?.toString() || \"\",\r\n// //       subcategory: item.subcategory?._id?.toString() || \"\",\r\n// //       description: item.description || \"\",\r\n// //       basePrice: item.basePrice ?? \"\",\r\n// //       difference: item.difference ?? \"\",\r\n// //       validTill: item.validTill ? item.validTill.split(\"T\")[0] : \"\",\r\n// //       file: null,\r\n// //     });\r\n\r\n// //     const cat = categories.find((c) => c._id === item.category?._id);\r\n// //     setSubcategories(cat?.subcategories || []);\r\n\r\n// //     setEditId(null);\r\n// //     setIsCopyMode(true);\r\n// //     window.scrollTo({ top: 0, behavior: \"smooth\" });\r\n// //   };\r\n\r\n// //   // -------------------- DELETE --------------------\r\n// //   const handleDelete = async (id) => {\r\n// //     if (!window.confirm(\"Delete item?\")) return;\r\n// //     try {\r\n// //       await axios.delete(`${API_URL}/${id}`);\r\n// //       setItems((prev) => prev.filter((x) => x._id !== id));\r\n// //       setSelectedItems((prev) => prev.filter((x) => x !== id));\r\n// //     } catch (err) {\r\n// //       console.error(\"Delete error\", err);\r\n// //       alert(\"Delete failed\");\r\n// //     }\r\n// //   };\r\n\r\n// //   // -------------------- STATUS TOGGLE --------------------\r\n// //   const handleStatusToggle = async (item) => {\r\n// //     try {\r\n// //       const newStatus = item.status === \"active\" ? \"inactive\" : \"active\";\r\n// //       await axios.put(`${API_URL}/status/${item._id}`, { status: newStatus });\r\n// //       setItems((prev) => prev.map((x) => (x._id === item._id ? { ...x, status: newStatus } : x)));\r\n// //     } catch (err) {\r\n// //       console.error(\"Status toggle error\", err);\r\n// //       alert(\"Status update failed\");\r\n// //     }\r\n// //   };\r\n\r\n// //   // -------------------- BULK --------------------\r\n// //   const handleBulkDelete = async () => {\r\n// //     if (!selectedItems.length) return alert(\"No items selected\");\r\n// //     if (!window.confirm(\"Delete selected items?\")) return;\r\n\r\n// //     try {\r\n// //       await Promise.all(selectedItems.map((id) => axios.delete(`${API_URL}/${id}`)));\r\n// //       setSelectedItems([]);\r\n// //       fetchItems();\r\n// //       setBulkMode(false);\r\n// //     } catch (err) {\r\n// //       console.error(\"Bulk delete error\", err);\r\n// //       alert(\"Bulk delete failed\");\r\n// //     }\r\n// //   };\r\n\r\n// //   const updateLocalItemField = (id, key, value) => {\r\n// //     setItems((prev) => prev.map((x) => (x._id === id ? { ...x, [key]: value } : x)));\r\n// //   };\r\n\r\n// //   const handleBulkSave = async () => {\r\n// //     if (!selectedItems.length) return alert(\"No items selected for bulk save\");\r\n\r\n// //     const updates = items\r\n// //       .filter((x) => selectedItems.includes(x._id))\r\n// //       .map((x) => ({\r\n// //         id: x._id,\r\n// //         name: x.name,\r\n// //         basePrice: x.basePrice,\r\n// //         difference: x.difference,\r\n// //         validTill: x.validTill,\r\n// //       }));\r\n\r\n// //     try {\r\n// //       await axios.post(`${API_URL}/bulk-update`, { products: updates });\r\n// //       setBulkMode(false);\r\n// //       setSelectedItems([]);\r\n// //       fetchItems();\r\n// //     } catch (err) {\r\n// //       console.error(\"Bulk save error\", err);\r\n// //       alert(\"Bulk save failed\");\r\n// //     }\r\n// //   };\r\n\r\n// //   // -------------------- CSV IMPORT/EXPORT --------------------\r\n// //   const handleCsvSelect = (e) => {\r\n// //     setCsvFile(e.target.files[0]);\r\n// //   };\r\n\r\n// //   const handleImportCsv = async () => {\r\n// //     if (!csvFile) return alert(\"Select CSV file\");\r\n// //     try {\r\n// //       const fd = new FormData();\r\n// //       fd.append(\"file\", csvFile);\r\n// //       const res = await axios.post(`${API_URL}/import`, fd);\r\n// //       if (res.data && res.data.success) {\r\n// //         alert(`Imported ${res.data.inserted || 0} items`);\r\n// //         setCsvFile(null);\r\n// //         if (csvInputRef.current) csvInputRef.current.value = null;\r\n// //         fetchItems();\r\n// //       } else {\r\n// //         alert(\"CSV import failed\");\r\n// //       }\r\n// //     } catch (err) {\r\n// //       console.error(\"CSV import error\", err);\r\n// //       alert(\"CSV import failed\");\r\n// //     }\r\n// //   };\r\n\r\n// //   const handleExportCsv = async () => {\r\n// //     try {\r\n// //       const res = await axios.get(`${API_URL}/export`, { responseType: \"blob\" });\r\n// //       const url = window.URL.createObjectURL(new Blob([res.data]));\r\n// //       const a = document.createElement(\"a\");\r\n// //       a.href = url;\r\n// //       a.download = \"prices.csv\";\r\n// //       a.click();\r\n// //       URL.revokeObjectURL(url);\r\n// //     } catch (err) {\r\n// //       console.error(\"CSV export error\", err);\r\n// //       alert(\"CSV export failed\");\r\n// //     }\r\n// //   };\r\n\r\n// //   const handleExportSelectedCsv = () => {\r\n// //     if (!selectedItems.length) return alert(\"Select items to export\");\r\n\r\n// //     const selectedData = items.filter((x) => selectedItems.includes(x._id));\r\n// //     const header = [\r\n// //       \"id\",\r\n// //       \"name\",\r\n// //       \"categoryName\",\r\n// //       \"subcategoryName\",\r\n// //       \"basePrice\",\r\n// //       \"difference\",\r\n// //       \"finalPrice\",\r\n// //       \"status\",\r\n// //       \"validTill\",\r\n// //       \"description\",\r\n// //       \"imageUrl\",\r\n// //     ];\r\n\r\n// //     const rows = selectedData.map((p) => [\r\n// //       p._id,\r\n// //       p.name || \"\",\r\n// //       p.category?.name || \"\",\r\n// //       p.subcategory?.name || \"\",\r\n// //       p.basePrice ?? \"\",\r\n// //       p.difference ?? \"\",\r\n// //       (Number(p.basePrice) + Number(p.difference || 0)) || \"\",\r\n// //       p.status || \"\",\r\n// //       p.validTill ? new Date(p.validTill).toISOString().split(\"T\")[0] : \"\",\r\n// //       p.description || \"\",\r\n// //       p.image || \"\",\r\n// //     ]);\r\n\r\n// //     const csvArray = [header, ...rows];\r\n// //     const csvContent =\r\n// //       \"data:text/csv;charset=utf-8,\" +\r\n// //       csvArray.map((r) => r.map((c) => `\"${String(c).replace(/\"/g, '\"\"')}\"`).join(\",\")).join(\"\\n\");\r\n\r\n// //     const encodedUri = encodeURI(csvContent);\r\n// //     const link = document.createElement(\"a\");\r\n// //     link.href = encodedUri;\r\n// //     link.download = `selected_prices_${Date.now()}.csv`;\r\n// //     link.click();\r\n// //   };\r\n\r\n// //   // -------------------- SEARCH & PAGINATION --------------------\r\n// //   const filteredItems = items.filter((item) => {\r\n// //     const t = search.toLowerCase();\r\n// //     return (\r\n// //       (item.name || \"\").toString().toLowerCase().includes(t) ||\r\n// //       (item.category?.name || \"\").toLowerCase().includes(t) ||\r\n// //       (item.subcategory?.name || \"\").toLowerCase().includes(t)\r\n// //     );\r\n// //   });\r\n\r\n// //   const indexOfLast = currentPage * itemsPerPage;\r\n// //   const currentItems = filteredItems.slice(indexOfLast - itemsPerPage, indexOfLast);\r\n// //   const totalPages = Math.max(1, Math.ceil(filteredItems.length / itemsPerPage));\r\n\r\n// //   // -------------------- RENDER --------------------\r\n// //   return (\r\n// //     <div className=\"price-container\">\r\n// //       {/* HEADER */}\r\n// //       <div className=\"header-section\">\r\n// //         <h1>üí∞ Product Management</h1>\r\n// //         <p>Manage prices, categories, images, CSV & bulk actions.</p>\r\n// //       </div>\r\n\r\n// //       {/* SEARCH */}\r\n// //       <div className=\"search-bar\">\r\n// //         <input\r\n// //           type=\"text\"\r\n// //           placeholder=\"Search product, category or subcategory...\"\r\n// //           value={search}\r\n// //           onChange={(e) => {\r\n// //             setSearch(e.target.value);\r\n// //             setCurrentPage(1);\r\n// //           }}\r\n// //         />\r\n// //       </div>\r\n\r\n// //       {/* BULK BAR */}\r\n// //       {selectedItems.length > 0 && (\r\n// //         <div className=\"bulk-bar\">\r\n// //           <span>{selectedItems.length} selected</span>\r\n\r\n// //           {!bulkMode ? (\r\n// //             <div className=\"bulk-actions\" style={{ display: \"flex\", gap: 10 }}>\r\n// //               <button className=\"btn delete\" onClick={handleBulkDelete}>\r\n// //                 üóë Bulk Delete\r\n// //               </button>\r\n\r\n// //               <button className=\"btn primary\" onClick={() => setBulkMode(true)}>\r\n// //                 ‚úè Bulk Edit\r\n// //               </button>\r\n\r\n\r\n// //               <button className=\"btn small\" onClick={handleExportSelectedCsv}>\r\n// //                 ‚§ì Export Selected\r\n// //               </button>\r\n// //             </div>\r\n// //           ) : (\r\n// //             <div className=\"bulk-panel\">\r\n// //               <h3>‚úè Bulk Edit Selected Items</h3>\r\n\r\n// //               {items\r\n// //                 .filter((item) => selectedItems.includes(item._id))\r\n// //                 .map((item) => (\r\n// //                   <div key={item._id} className=\"bulk-edit-item-box\">\r\n// //                     <h4>{item.name}</h4>\r\n\r\n// //                     <div className=\"form-grid\">\r\n// //                       <div className=\"form-group\">\r\n// //                         <label>Name</label>\r\n// //                         <input\r\n// //                           type=\"text\"\r\n// //                           value={item.name}\r\n// //                           onChange={(e) => updateLocalItemField(item._id, \"name\", e.target.value)}\r\n// //                         />\r\n// //                       </div>\r\n\r\n// //                       <div className=\"form-group\">\r\n// //                         <label>Base Price</label>\r\n// //                         <input\r\n// //                           type=\"number\"\r\n// //                           value={item.basePrice}\r\n// //                           onChange={(e) =>\r\n// //                             updateLocalItemField(item._id, \"basePrice\", Number(e.target.value))\r\n// //                           }\r\n// //                         />\r\n// //                       </div>\r\n// //                           <div className=\"form-group\">\r\n// //   <label>Category</label>\r\n// //   <select\r\n// //     value={item.category?._id || \"\"}\r\n// //     onChange={(e) => {\r\n// //       const newCat = e.target.value;\r\n\r\n// //       updateLocalItemField(item._id, \"category\", { _id: newCat });\r\n\r\n// //       const catObj = categories.find((c) => c._id === newCat);\r\n// //       const firstSub = catObj?.subcategories?.[0]?._id || \"\";\r\n\r\n// //       updateLocalItemField(item._id, \"subcategory\", { _id: firstSub });\r\n// //     }}\r\n// //   >\r\n// //     <option value=\"\">Select Category</option>\r\n// //     {categories.map((c) => (\r\n// //       <option key={c._id} value={c._id}>\r\n// //         {c.name}\r\n// //       </option>\r\n// //     ))}\r\n// //   </select>\r\n// // </div>\r\n\r\n// // <div className=\"form-group\">\r\n// //   <label>Subcategory</label>\r\n// //   <select\r\n// //     value={item.subcategory?._id || \"\"}\r\n// //     onChange={(e) =>\r\n// //       updateLocalItemField(item._id, \"subcategory\", { _id: e.target.value })\r\n// //     }\r\n// //   >\r\n// //     <option value=\"\">Select Subcategory</option>\r\n\r\n// //     {categories\r\n// //       .find((c) => c._id === item.category?._id)\r\n// //       ?.subcategories?.map((s) => (\r\n// //         <option key={s._id} value={s._id}>\r\n// //           {s.name}\r\n// //         </option>\r\n// //       ))}\r\n// //   </select>\r\n// // </div>\r\n// //                       <div className=\"form-group\">\r\n// //                         <label>Difference</label>\r\n// //                         <input\r\n// //                           type=\"number\"\r\n// //                           value={item.difference || 0}\r\n// //                           onChange={(e) =>\r\n// //                             updateLocalItemField(item._id, \"difference\", Number(e.target.value))\r\n// //                           }\r\n// //                         />\r\n// //                       </div>\r\n\r\n// //                       {/* <div className=\"form-group\">\r\n// //                         <label>Valid Till</label>\r\n// //                         <input\r\n// //                           type=\"date\"\r\n// //                           value={item.validTill ? item.validTill.split(\"T\")[0] : \"\"}\r\n// //                           onChange={(e) => updateLocalItemField(item._id, \"validTill\", e.target.value)}\r\n// //                         />\r\n// //                       </div> */}\r\n// //                     </div>\r\n// //                   </div>\r\n// //                 ))}\r\n\r\n// //               <div style={{ display: \"flex\", gap: 10, marginTop: 12 }}>\r\n// //                 <button className=\"btn primary\" onClick={handleBulkSave}>\r\n// //                   ‚úî Save All\r\n// //                 </button>\r\n// //                 <button className=\"btn cancel\" onClick={() => setBulkMode(false)}>\r\n// //                   ‚úñ Cancel\r\n// //                 </button>\r\n// //               </div>\r\n// //             </div>\r\n// //           )}\r\n// //         </div>\r\n// //       )}\r\n\r\n// //       {/* FORM */}\r\n// //       <div className=\"price-form-card\">\r\n// //         <h2>{isCopyMode ? \"üìÑ Save Duplicate Product\" : editId ? \"‚úè Update Product\" : \"‚ûï Add Product\"}</h2>\r\n\r\n// //         <form onSubmit={handleSubmit}>\r\n// //           <div className=\"form-grid\">\r\n// //             {/* NAME */}\r\n// //             <div className=\"form-group\">\r\n// //               <label>Product Name *</label>\r\n// //               <input required name=\"name\" value={form.name} onChange={handleChange} />\r\n// //             </div>\r\n\r\n// //             {/* CATEGORY */}\r\n// //             <div className=\"form-group\">\r\n// //               <label>Category *</label>\r\n// //               <div className=\"category-row\">\r\n// //                 <select\r\n// //                   required\r\n// //                   name=\"category\"\r\n// //                   value={form.category}\r\n// //                   onChange={(e) => {\r\n// //                     handleChange(e);\r\n// //                     // reset subcategory on category change (useEffect will set subs)\r\n// //                     setForm((p) => ({ ...p, subcategory: \"\" }));\r\n// //                   }}\r\n// //                 >\r\n// //                   <option value=\"\">Select Category</option>\r\n// //                   {categories.map((c) => (\r\n// //                     <option value={c._id} key={c._id}>\r\n// //                       {c.name}\r\n// //                     </option>\r\n// //                   ))}\r\n// //                 </select>\r\n\r\n// //                 <button type=\"button\" className=\"btn small\" onClick={() => setAddingCategory((v) => !v)}>\r\n// //                   {addingCategory ? \"Close\" : \"Add\"}\r\n// //                 </button>\r\n// //               </div>\r\n// //             </div>\r\n\r\n// //             {/* ADD CATEGORY UI */}\r\n// //             {addingCategory && (\r\n// //               <div className=\"form-group full-width addCategoryBox\">\r\n// //                 <label>Add New Category</label>\r\n// //                 <div className=\"category-row\">\r\n// //                   <input\r\n// //                     value={newCategoryName}\r\n// //                     onChange={(e) => setNewCategoryName(e.target.value)}\r\n// //                     placeholder=\"Category name\"\r\n// //                   />\r\n// //                   <input\r\n// //                     type=\"file\"\r\n// //                     accept=\"image/*\"\r\n// //                     onChange={(e) => {\r\n// //                       setNewCategoryImage(e.target.files[0]);\r\n// //                       setNewCategoryPreview(e.target.files[0] ? URL.createObjectURL(e.target.files[0]) : null);\r\n// //                     }}\r\n// //                   />\r\n// //                   <button className=\"btn primary\" type=\"button\" onClick={handleCreateCategory}>\r\n// //                     Create\r\n// //                   </button>\r\n// //                 </div>\r\n// //                 {newCategoryPreview && <img src={newCategoryPreview} className=\"categoryPreview\" alt=\"preview\" />}\r\n// //               </div>\r\n// //             )}\r\n\r\n// //             {/* SUBCATEGORY */}\r\n// //             <div className=\"form-group\">\r\n// //               <label>Subcategory</label>\r\n// //               <div className=\"category-row\">\r\n// //                 <select name=\"subcategory\" value={form.subcategory} onChange={handleChange} disabled={!subcategories.length}>\r\n// //                   <option value=\"\">Select Subcategory</option>\r\n// //                   {subcategories.map((s) => (\r\n// //                     <option value={s._id} key={s._id}>\r\n// //                       {s.name}\r\n// //                     </option>\r\n// //                   ))}\r\n// //                 </select>\r\n\r\n// //                 {form.category && (\r\n// //                   <button type=\"button\" className=\"btn small\" onClick={() => setAddingSub((v) => !v)}>\r\n// //                     {addingSub ? \"Close\" : \"Add\"}\r\n// //                   </button>\r\n// //                 )}\r\n// //               </div>\r\n// //             </div>\r\n\r\n// //             {/* ADD SUBCATEGORY UI */}\r\n// //             {addingSub && (\r\n// //               <div className=\"form-group full-width addCategoryBox\">\r\n// //                 <label>Add New Subcategory</label>\r\n// //                 <div className=\"category-row\">\r\n// //                   <input value={newSubName} onChange={(e) => setNewSubName(e.target.value)} placeholder=\"Subcategory name\" />\r\n// //                   <input\r\n// //                     type=\"file\"\r\n// //                     accept=\"image/*\"\r\n// //                     onChange={(e) => {\r\n// //                       setNewSubImage(e.target.files[0]);\r\n// //                       setNewSubPreview(e.target.files[0] ? URL.createObjectURL(e.target.files[0]) : null);\r\n// //                     }}\r\n// //                   />\r\n// //                   <button className=\"btn primary\" type=\"button\" onClick={handleCreateSub}>\r\n// //                     Create\r\n// //                   </button>\r\n// //                 </div>\r\n// //                 {newSubPreview && <img src={newSubPreview} className=\"categoryPreview\" alt=\"preview\" />}\r\n// //               </div>\r\n// //             )}\r\n\r\n// //             {/* BASE PRICE */}\r\n// //             <div className=\"form-group\">\r\n// //               <label>Base Price *</label>\r\n// //               <input type=\"number\" required name=\"basePrice\" value={form.basePrice} onChange={handleChange} />\r\n// //             </div>\r\n\r\n// //             {/* DIFFERENCE */}\r\n// //             <div className=\"form-group\">\r\n// //               <label>Difference</label>\r\n// //               <input type=\"number\" name=\"difference\" value={form.difference} onChange={handleChange} />\r\n// //             </div>\r\n\r\n// //             {/* VALID TILL */}\r\n// //             <div className=\"form-group\">\r\n// //               <label>Valid Till</label>\r\n// //               <input type=\"date\" name=\"validTill\" value={form.validTill} onChange={handleChange} />\r\n// //             </div>\r\n\r\n// //             {/* IMAGE */}\r\n// //             <div className=\"form-group\">\r\n// //               <label>Image</label>\r\n// //               <input type=\"file\" accept=\"image/*\" onChange={handleChange} />\r\n// //             </div>\r\n// //           </div>\r\n\r\n// //           {/* DESCRIPTION */}\r\n// //           <div className=\"form-group full-width\">\r\n// //             <label>Description</label>\r\n// //             <textarea name=\"description\" value={form.description} onChange={handleChange}></textarea>\r\n// //           </div>\r\n\r\n// //           {/* ACTIONS */}\r\n// //           <div className=\"form-actions\">\r\n// //             <button className=\"btn primary\" disabled={loading}>\r\n// //               {loading ? \"Saving...\" : isCopyMode ? \"Save Copy\" : editId ? \"Update\" : \"Add\"}\r\n// //             </button>\r\n\r\n// //             {(editId || isCopyMode) && (\r\n// //               <button\r\n// //                 type=\"button\"\r\n// //                 className=\"btn cancel\"\r\n// //                 onClick={() => {\r\n// //                   setEditId(null);\r\n// //                   setIsCopyMode(false);\r\n// //                   setForm({\r\n// //                     name: \"\",\r\n// //                     category: \"\",\r\n// //                     subcategory: \"\",\r\n// //                     description: \"\",\r\n// //                     basePrice: \"\",\r\n// //                     difference: \"\",\r\n// //                     validTill: \"\",\r\n// //                     file: null,\r\n// //                   });\r\n// //                 }}\r\n// //               >\r\n// //                 Cancel\r\n// //               </button>\r\n// //             )}\r\n// //           </div>\r\n// //         </form>\r\n// //       </div>\r\n\r\n// //       {/* CSV CONTROLS */}\r\n// //       <div className=\"csv-controls\">\r\n// //         <div>\r\n// //           <input type=\"file\" accept=\".csv\" ref={csvInputRef} onChange={handleCsvSelect} />\r\n// //           <button className=\"btn small\" onClick={handleImportCsv}>\r\n// //             Import CSV\r\n// //           </button>\r\n// //         </div>\r\n\r\n// //         <div style={{ display: \"flex\", gap: 8 }}>\r\n// //           <button className=\"btn primary\" onClick={handleExportCsv}>\r\n// //             Export All CSV\r\n// //           </button>\r\n\r\n// //           <button className=\"btn\" onClick={handleExportSelectedCsv}>\r\n// //             Export Selected CSV\r\n// //           </button>\r\n// //         </div>\r\n// //       </div>\r\n\r\n// //       {/* TABLE */}\r\n// //       <div className=\"table-card\">\r\n// //         <div className=\"table-header\">\r\n// //           <h2>üìã Items</h2>\r\n// //           <span>Total: {filteredItems.length}</span>\r\n// //         </div>\r\n\r\n// //         {!isMobile ? (\r\n// //           <table>\r\n// //             <thead>\r\n// //               <tr>\r\n// //                 <th>\r\n// //                   <input\r\n// //                     type=\"checkbox\"\r\n// //                     checked={selectedItems.length === filteredItems.length && filteredItems.length > 0}\r\n// //                     onChange={() => {\r\n// //                       if (selectedItems.length === filteredItems.length) setSelectedItems([]);\r\n// //                       else setSelectedItems(filteredItems.map((x) => x._id));\r\n// //                     }}\r\n// //                   />\r\n// //                 </th>\r\n// //                 <th>Sr</th>\r\n// //                 <th>Image</th>\r\n// //                 <th>Name</th>\r\n// //                 <th>Category</th>\r\n// //                 <th>Subcategory</th>\r\n// //                 <th>Base</th>\r\n// //                 <th>Diff</th>\r\n// //                 <th>Final</th>\r\n// //                 <th>Status</th>\r\n// //                 <th>Valid Till</th>\r\n// //                 <th>Actions</th>\r\n// //               </tr>\r\n// //             </thead>\r\n\r\n// //             <tbody>\r\n// //               {currentItems.map((item, i) => (\r\n// //                 <tr key={item._id}>\r\n// //                   <td>\r\n// //                     <input\r\n// //                       type=\"checkbox\"\r\n// //                       checked={selectedItems.includes(item._id)}\r\n// //                       onChange={() =>\r\n// //                         setSelectedItems((prev) => (prev.includes(item._id) ? prev.filter((x) => x !== item._id) : [...prev, item._id]))\r\n// //                       }\r\n// //                     />\r\n// //                   </td>\r\n\r\n// //                   <td>{(currentPage - 1) * itemsPerPage + (i + 1)}</td>\r\n\r\n// //                   <td>{item.image ? <img src={item.image} alt=\"\" /> : \"No Img\"}</td>\r\n\r\n// //                   <td>{item.name}</td>\r\n// //                   <td>{item.category?.name || \"-\"}</td>\r\n// //                   <td>{item.subcategory?.name || \"-\"}</td>\r\n\r\n// //                   <td>‚Çπ{item.basePrice}</td>\r\n// //                   <td>{item.difference || 0}</td>\r\n// //                   <td>‚Çπ{Number(item.basePrice) + Number(item.difference || 0)}</td>\r\n\r\n// //                   <td>\r\n// //                     <button\r\n// //                       className={item.status === \"active\" ? \"status-active\" : \"status-inactive\"}\r\n// //                       onClick={() => handleStatusToggle(item)}\r\n// //                     >\r\n// //                       {item.status === \"active\" ? \" Active\" : \" Inactive\"}\r\n// //                     </button>\r\n// //                   </td>\r\n\r\n// //                   <td>{item.validTill ? new Date(item.validTill).toLocaleDateString() : \"-\"}</td>\r\n\r\n// //                   <td className=\"actions\">\r\n// //                     <button className=\"btn edit\" onClick={() => handleEdit(item)}>\r\n// //                       Edit\r\n// //                     </button>\r\n\r\n// //                     <button className=\"btn delete\" onClick={() => handleDelete(item._id)}>\r\n// //                       Delete\r\n// //                     </button>\r\n\r\n// //                     <button className=\"btn small\" style={{ background: \"#6f42c1\", color: \"white\" }} onClick={() => handleCopyToEdit(item)}>\r\n// //                       Copy\r\n// //                     </button>\r\n// //                   </td>\r\n// //                 </tr>\r\n// //               ))}\r\n// //             </tbody>\r\n// //           </table>\r\n// //         ) : (\r\n// //           <div className=\"mobile-list\">\r\n// //             {currentItems.map((item) => (\r\n// //               <div key={item._id} className=\"mobile-card\">\r\n// //                 <input\r\n// //                   type=\"checkbox\"\r\n// //                   checked={selectedItems.includes(item._id)}\r\n// //                   onChange={() =>\r\n// //                     setSelectedItems((prev) => (prev.includes(item._id) ? prev.filter((x) => x !== item._id) : [...prev, item._id]))\r\n// //                   }\r\n// //                 />\r\n\r\n// //                 {item.image ? <img src={item.image} alt=\"\" /> : <div>No Image</div>}\r\n\r\n// //                 <h3>{item.name}</h3>\r\n\r\n// //                 <p>\r\n// //                   <b>Category:</b> {item.category?.name || \"-\"}\r\n// //                 </p>\r\n\r\n// //                 <p>\r\n// //                   <b>Subcategory:</b> {item.subcategory?.name || \"-\"}\r\n// //                 </p>\r\n\r\n// //                 <p>\r\n// //                   <b>Base:</b> ‚Çπ{item.basePrice}\r\n// //                 </p>\r\n\r\n// //                 <p>\r\n// //                   <b>Final:</b> ‚Çπ{Number(item.basePrice) + Number(item.difference || 0)}\r\n// //                 </p>\r\n\r\n// //                 <button className={item.status === \"active\" ? \"status-active\" : \"status-inactive\"} onClick={() => handleStatusToggle(item)}>\r\n// //                   {item.status === \"active\" ? \"Active\" : \"Inactive\"}\r\n// //                 </button>\r\n\r\n// //                 <div className=\"actions\">\r\n// //                   <button className=\"btn edit\" onClick={() => handleEdit(item)}>\r\n// //                     Edit\r\n// //                   </button>\r\n\r\n// //                   <button className=\"btn delete\" onClick={() => handleDelete(item._id)}>\r\n// //                     Delete\r\n// //                   </button>\r\n\r\n// //                   <button className=\"btn small\" style={{ background: \"#6f42c1\", color: \"white\" }} onClick={() => handleCopyToEdit(item)}>\r\n// //                     Copy\r\n// //                   </button>\r\n// //                 </div>\r\n// //               </div>\r\n// //             ))}\r\n// //           </div>\r\n// //         )}\r\n\r\n// //         {/* PAGINATION */}\r\n// //         <div className=\"pagination\">\r\n// //           <button disabled={currentPage === 1} onClick={() => setCurrentPage((p) => p - 1)}>\r\n// //             Previous\r\n// //           </button>\r\n\r\n// //           {Array.from({ length: totalPages }, (_, i) => (\r\n// //             <button key={i} className={i + 1 === currentPage ? \"active-page\" : \"\"} onClick={() => setCurrentPage(i + 1)}>\r\n// //               {i + 1}\r\n// //             </button>\r\n// //           ))}\r\n\r\n// //           <button disabled={currentPage === totalPages} onClick={() => setCurrentPage((p) => p + 1)}>\r\n// //             Next\r\n// //           </button>\r\n// //         </div>\r\n// //       </div>\r\n// //     </div>\r\n// //   );\r\n// // }\r\n// import React, { useEffect, useState, useRef } from \"react\";\r\n// import axios from \"axios\";\r\n\r\n// const API_URL = \"https://grocerrybackend.vercel.app/api/prices\";\r\n// const CATEGORY_URL = \"https://grocerrybackend.vercel.app/api/categories\";\r\n\r\n// export default function PriceList() {\r\n//   const [items, setItems] = useState([]);\r\n//   const [categories, setCategories] = useState([]);\r\n//   const [subcategories, setSubcategories] = useState([]);\r\n//   const [isMobile, setIsMobile] = useState(window.innerWidth < 768);\r\n//   const [search, setSearch] = useState(\"\");\r\n//   const [loading, setLoading] = useState(false);\r\n\r\n//   // FORM state\r\n//   const [form, setForm] = useState({\r\n//     name: \"\",\r\n//     category: \"\",\r\n//     subcategory: \"\",\r\n//     description: \"\",\r\n//     basePrice: \"\",\r\n//     difference: \"\",\r\n//     validTill: \"\",\r\n//     file: null,\r\n//   });\r\n\r\n//   const [editId, setEditId] = useState(null);\r\n//   const [isCopyMode, setIsCopyMode] = useState(false);\r\n//   const [showForm, setShowForm] = useState(false);\r\n//   const [showModal, setShowModal] = useState(false);\r\n//   const [activeMenu, setActiveMenu] = useState(null);\r\n\r\n//   const [addingCategory, setAddingCategory] = useState(false);\r\n//   const [newCategoryName, setNewCategoryName] = useState(\"\");\r\n//   const [newCategoryImage, setNewCategoryImage] = useState(null);\r\n//   const [newCategoryPreview, setNewCategoryPreview] = useState(null);\r\n\r\n//   const [addingSub, setAddingSub] = useState(false);\r\n//   const [newSubName, setNewSubName] = useState(\"\");\r\n//   const [newSubImage, setNewSubImage] = useState(null);\r\n//   const [newSubPreview, setNewSubPreview] = useState(null);\r\n\r\n//   const [selectedItems, setSelectedItems] = useState([]);\r\n//   const [bulkMode, setBulkMode] = useState(false);\r\n\r\n//   const [csvFile, setCsvFile] = useState(null);\r\n//   const csvInputRef = useRef();\r\n\r\n//   const [currentPage, setCurrentPage] = useState(1);\r\n//   const itemsPerPage = 30;\r\n\r\n//   // useEffect(() => {\r\n//   //   fetchItems();\r\n//   //   fetchCategories();\r\n\r\n//   //   const handleResize = () => setIsMobile(window.innerWidth < 768);\r\n//   //   window.addEventListener(\"resize\", handleResize);\r\n//   //   return () => window.removeEventListener(\"resize\", handleResize);\r\n//   // }, []);\r\n//   // 1. Pehle categories load karo\r\n// useEffect(() => {\r\n//   fetchCategories();\r\n// }, []);\r\n\r\n// // 2. Categories load hone ke baad items load karo\r\n// useEffect(() => {\r\n//   if (categories.length > 0) {\r\n//     fetchItems();\r\n//   }\r\n// }, [categories]);\r\n\r\n// // 3. Resize listener\r\n// useEffect(() => {\r\n//   const handleResize = () => setIsMobile(window.innerWidth < 768);\r\n//   window.addEventListener(\"resize\", handleResize);\r\n//   return () => window.removeEventListener(\"resize\", handleResize);\r\n// }, []);\r\n\r\n\r\n//   const fetchItems = async () => {\r\n//     try {\r\n//       setLoading(true);\r\n//       const res = await axios.get(API_URL);\r\n//       // if (res.data && res.data.success) setItems(res.data.data || []);\r\n//       if (res.data && res.data.success) {\r\n//   const raw = res.data.data;\r\n\r\n//   // Agar categories abhi load nahi hui = raw items set\r\n//   if (!categories.length) {\r\n//     setItems(raw);\r\n//     return;\r\n//   }\r\n\r\n//   // Mapping to category + subcategory object\r\n//   const enriched = raw.map((item) => {\r\n//     const cat = categories.find(\r\n//       (c) =>\r\n//         c._id === item.category ||\r\n//         c._id === item.category?._id\r\n//     );\r\n\r\n//     const sub = cat?.subcategories?.find(\r\n//       (s) =>\r\n//         s._id === item.subcategory ||\r\n//         s._id === item.subcategory?._id\r\n//     );\r\n\r\n//     return {\r\n//       ...item,\r\n//       category: cat\r\n//         ? { _id: cat._id, name: cat.name }\r\n//         : item.category,\r\n\r\n//       subcategory: sub\r\n//         ? { _id: sub._id, name: sub.name }\r\n//         : item.subcategory,\r\n//     };\r\n//   });\r\n\r\n//   setItems(enriched);\r\n// }\r\n\r\n//     } catch (err) {\r\n//       console.error(\"Fetch items error\", err);\r\n//       alert(\"Could not fetch items\");\r\n//     } finally {\r\n//       setLoading(false);\r\n//     }\r\n//   };\r\n\r\n//   const fetchCategories = async () => {\r\n//     try {\r\n//       const res = await axios.get(CATEGORY_URL);\r\n//       if (res.data && res.data.success) setCategories(res.data.categories || []);\r\n//     } catch (err) {\r\n//       console.error(\"Fetch categories error\", err);\r\n//       alert(\"Could not fetch categories\");\r\n//     }\r\n//   };\r\n\r\n//   useEffect(() => {\r\n//     if (!form.category) {\r\n//       setSubcategories([]);\r\n//       setForm((prev) => ({ ...prev, subcategory: \"\" }));\r\n//       return;\r\n//     }\r\n\r\n//     const cat = categories.find((c) => c._id === form.category);\r\n//     const subs = (cat && cat.subcategories) || [];\r\n//     setSubcategories(subs);\r\n\r\n//     const exists = subs.some((s) => s._id === form.subcategory);\r\n//     if (!exists) setForm((prev) => ({ ...prev, subcategory: \"\" }));\r\n//   }, [form.category, categories]);\r\n\r\n//   const handleCreateCategory = async () => {\r\n//     if (!newCategoryName.trim()) return alert(\"Enter category name\");\r\n//     try {\r\n//       const fd = new FormData();\r\n//       fd.append(\"name\", newCategoryName.trim());\r\n//       if (newCategoryImage) fd.append(\"image\", newCategoryImage);\r\n\r\n//       const res = await axios.post(CATEGORY_URL, fd);\r\n//       if (res.data && res.data.success) {\r\n//         alert(\"Category created\");\r\n//         setNewCategoryName(\"\");\r\n//         setNewCategoryImage(null);\r\n//         setNewCategoryPreview(null);\r\n//         setAddingCategory(false);\r\n//         fetchCategories();\r\n//       } else {\r\n//         alert(\"Category creation failed\");\r\n//       }\r\n//     } catch (err) {\r\n//       console.error(\"Create category error\", err);\r\n//       alert(\"Category creation failed\");\r\n//     }\r\n//   };\r\n\r\n//   const handleCreateSub = async () => {\r\n//     if (!newSubName.trim()) return alert(\"Enter subcategory name\");\r\n//     if (!form.category) return alert(\"Select category first\");\r\n\r\n//     try {\r\n//       const fd = new FormData();\r\n//       fd.append(\"name\", newSubName.trim());\r\n//       if (newSubImage) fd.append(\"image\", newSubImage);\r\n\r\n//       const res = await axios.post(`${CATEGORY_URL}/${form.category}/sub`, fd);\r\n//       if (res.data && res.data.success) {\r\n//         alert(\"Subcategory created\");\r\n//         setNewSubName(\"\");\r\n//         setNewSubImage(null);\r\n//         setNewSubPreview(null);\r\n//         setAddingSub(false);\r\n//         fetchCategories();\r\n//       } else {\r\n//         alert(\"Subcategory creation failed\");\r\n//       }\r\n//     } catch (err) {\r\n//       console.error(\"Create sub error\", err);\r\n//       alert(\"Subcategory creation failed\");\r\n//     }\r\n//   };\r\n\r\n//   const handleChange = (e) => {\r\n//     const { name, value, files } = e.target;\r\n//     if (files && files.length) {\r\n//       setForm((p) => ({ ...p, file: files[0] }));\r\n//     } else {\r\n//       setForm((p) => ({ ...p, [name]: value }));\r\n//     }\r\n//   };\r\n\r\n//   const handleSubmit = async (e) => {\r\n//     e.preventDefault();\r\n//     setLoading(true);\r\n\r\n//     try {\r\n//       if (!form.name || !form.category || !form.basePrice) {\r\n//         alert(\"Name, category & base price are required\");\r\n//         setLoading(false);\r\n//         return;\r\n//       }\r\n\r\n//       const fd = new FormData();\r\n//       Object.keys(form).forEach((k) => {\r\n//         const val = form[k];\r\n//         if (val !== undefined && val !== null) {\r\n//           fd.append(k, val);\r\n//         }\r\n//       });\r\n\r\n//       let res;\r\n//       if (isCopyMode) {\r\n//         res = await axios.post(API_URL, fd);\r\n//         alert(\"Copied as new item\");\r\n//       } else if (editId) {\r\n//         res = await axios.put(`${API_URL}/${editId}`, fd);\r\n//         alert(\"Updated\");\r\n//       } else {\r\n//         res = await axios.post(API_URL, fd);\r\n//         alert(\"Added\");\r\n//       }\r\n\r\n//       await fetchItems();\r\n//       await fetchCategories();\r\n\r\n//       setForm({\r\n//         name: \"\",\r\n//         category: \"\",\r\n//         subcategory: \"\",\r\n//         description: \"\",\r\n//         basePrice: \"\",\r\n//         difference: \"\",\r\n//         validTill: \"\",\r\n//         file: null,\r\n//       });\r\n//       setEditId(null);\r\n//       setIsCopyMode(false);\r\n//       setShowModal(false);\r\n//       setShowForm(false);\r\n//     } catch (err) {\r\n//       console.error(\"Save error\", err);\r\n//       alert(\"Save failed\");\r\n//     } finally {\r\n//       setLoading(false);\r\n//     }\r\n//   };\r\n\r\n//   const handleEdit = (item) => {\r\n//     setForm({\r\n//       name: item.name || \"\",\r\n//       category: item.category?._id?.toString() || \"\",\r\n//       subcategory: item.subcategory?._id?.toString() || \"\",\r\n//       description: item.description || \"\",\r\n//       basePrice: item.basePrice ?? \"\",\r\n//       difference: item.difference ?? \"\",\r\n//       validTill: item.validTill ? item.validTill.split(\"T\")[0] : \"\",\r\n//       file: null,\r\n//     });\r\n\r\n//     const cat = categories.find((c) => c._id === item.category?._id);\r\n//     setSubcategories(cat?.subcategories || []);\r\n\r\n//     setEditId(item._id);\r\n//     setIsCopyMode(false);\r\n//     setShowModal(true);\r\n//     setActiveMenu(null);\r\n//   };\r\n\r\n//   const handleCopyToEdit = (item) => {\r\n//     setForm({\r\n//       name: item.name || \"\",\r\n//       category: item.category?._id?.toString() || \"\",\r\n//       subcategory: item.subcategory?._id?.toString() || \"\",\r\n//       description: item.description || \"\",\r\n//       basePrice: item.basePrice ?? \"\",\r\n//       difference: item.difference ?? \"\",\r\n//       validTill: item.validTill ? item.validTill.split(\"T\")[0] : \"\",\r\n//       file: null,\r\n//     });\r\n\r\n//     const cat = categories.find((c) => c._id === item.category?._id);\r\n//     setSubcategories(cat?.subcategories || []);\r\n\r\n//     setEditId(null);\r\n//     setIsCopyMode(true);\r\n//     setShowModal(true);\r\n//     setActiveMenu(null);\r\n//   };\r\n\r\n//   const handleDelete = async (id) => {\r\n//     if (!window.confirm(\"Delete item?\")) return;\r\n//     try {\r\n//       await axios.delete(`${API_URL}/${id}`);\r\n//       setItems((prev) => prev.filter((x) => x._id !== id));\r\n//       setSelectedItems((prev) => prev.filter((x) => x !== id));\r\n//       setActiveMenu(null);\r\n//     } catch (err) {\r\n//       console.error(\"Delete error\", err);\r\n//       alert(\"Delete failed\");\r\n//     }\r\n//   };\r\n\r\n//   const handleStatusToggle = async (item) => {\r\n//     try {\r\n//       const newStatus = item.status === \"active\" ? \"inactive\" : \"active\";\r\n//       await axios.put(`${API_URL}/status/${item._id}`, { status: newStatus });\r\n//       setItems((prev) => prev.map((x) => (x._id === item._id ? { ...x, status: newStatus } : x)));\r\n//     } catch (err) {\r\n//       console.error(\"Status toggle error\", err);\r\n//       alert(\"Status update failed\");\r\n//     }\r\n//   };\r\n\r\n//   const handleBulkDelete = async () => {\r\n//     if (!selectedItems.length) return alert(\"No items selected\");\r\n//     if (!window.confirm(\"Delete selected items?\")) return;\r\n\r\n//     try {\r\n//       await Promise.all(selectedItems.map((id) => axios.delete(`${API_URL}/${id}`)));\r\n//       setSelectedItems([]);\r\n//       fetchItems();\r\n//       setBulkMode(false);\r\n//     } catch (err) {\r\n//       console.error(\"Bulk delete error\", err);\r\n//       alert(\"Bulk delete failed\");\r\n//     }\r\n//   };\r\n\r\n//   const updateLocalItemField = (id, key, value) => {\r\n//     setItems((prev) => prev.map((x) => (x._id === id ? { ...x, [key]: value } : x)));\r\n//   };\r\n\r\n//   const handleBulkSave = async () => {\r\n//     if (!selectedItems.length) return alert(\"No items selected for bulk save\");\r\n\r\n//     const updates = items\r\n//       .filter((x) => selectedItems.includes(x._id))\r\n//       .map((x) => ({\r\n//         id: x._id,\r\n//         name: x.name,\r\n//         basePrice: x.basePrice,\r\n//         difference: x.difference,\r\n//         validTill: x.validTill,\r\n//       }));\r\n\r\n//     try {\r\n//       await axios.post(`${API_URL}/bulk-update`, { products: updates });\r\n//       setBulkMode(false);\r\n//       setSelectedItems([]);\r\n//       fetchItems();\r\n//     } catch (err) {\r\n//       console.error(\"Bulk save error\", err);\r\n//       alert(\"Bulk save failed\");\r\n//     }\r\n//   };\r\n\r\n//   const handleCsvSelect = (e) => {\r\n//     setCsvFile(e.target.files[0]);\r\n//   };\r\n\r\n//   const handleImportCsv = async () => {\r\n//     if (!csvFile) return alert(\"Select CSV file\");\r\n//     try {\r\n//       const fd = new FormData();\r\n//       fd.append(\"file\", csvFile);\r\n//       const res = await axios.post(`${API_URL}/import`, fd);\r\n//       if (res.data && res.data.success) {\r\n//         alert(`Imported ${res.data.inserted || 0} items`);\r\n//         setCsvFile(null);\r\n//         if (csvInputRef.current) csvInputRef.current.value = null;\r\n//         fetchItems();\r\n//       } else {\r\n//         alert(\"CSV import failed\");\r\n//       }\r\n//     } catch (err) {\r\n//       console.error(\"CSV import error\", err);\r\n//       alert(\"CSV import failed\");\r\n//     }\r\n//   };\r\n\r\n//   // const handleExportCsv = async () => {\r\n//   //   try {\r\n//   //     const res = await axios.get(`${API_URL}/export`, { responseType: \"blob\" });\r\n//   //     const url = window.URL.createObjectURL(new Blob([res.data]));\r\n//   //     const a = document.createElement(\"a\");\r\n//   //     a.href = url;\r\n//   //     a.download = \"prices.csv\";\r\n//   //     a.click();\r\n//   //     URL.revokeObjectURL(url);\r\n//   //   } catch (err) {\r\n//   //     console.error(\"CSV export error\", err);\r\n//   //     alert(\"CSV export failed\");\r\n//   //   }\r\n//   // };\r\n// const handleExportCsv = () => {\r\n//   if (!items.length) return alert(\"No items to export\");\r\n\r\n//   const header = [\r\n//     \"id\",\r\n//     \"name\",\r\n//     \"categoryName\",\r\n//     \"subcategoryName\",\r\n//     \"basePrice\",\r\n//     \"difference\",\r\n//     \"finalPrice\",\r\n//     \"status\",\r\n//     \"validTill\",\r\n//     \"description\",\r\n//     \"imageUrl\",\r\n//   ];\r\n\r\n//   const rows = items.map((p) => [\r\n//     p._id,\r\n//     p.name || \"\",\r\n//     p.category?.name || \"\",\r\n//     p.subcategory?.name || \"\",\r\n//     p.basePrice ?? \"\",\r\n//     p.difference ?? \"\",\r\n//     (Number(p.basePrice) + Number(p.difference || 0)) || \"\",\r\n//     p.status || \"\",\r\n//     p.validTill ? new Date(p.validTill).toISOString().split(\"T\")[0] : \"\",\r\n//     p.description || \"\",\r\n//     p.image || \"\",\r\n//   ]);\r\n\r\n//   const csvArray = [header, ...rows];\r\n//   const csvContent =\r\n//     \"data:text/csv;charset=utf-8,\" +\r\n//     csvArray\r\n//       .map((r) => r.map((c) => `\"${String(c).replace(/\"/g, '\"\"')}\"`).join(\",\"))\r\n//       .join(\"\\n\");\r\n\r\n//   const encodedUri = encodeURI(csvContent);\r\n//   const link = document.createElement(\"a\");\r\n//   link.href = encodedUri;\r\n//   link.download = `all_prices_${Date.now()}.csv`;\r\n//   link.click();\r\n// };\r\n\r\n//   const handleExportSelectedCsv = () => {\r\n//     if (!selectedItems.length) return alert(\"Select items to export\");\r\n\r\n//     const selectedData = items.filter((x) => selectedItems.includes(x._id));\r\n//     const header = [\r\n//       \"id\",\r\n//       \"name\",\r\n//       \"categoryName\",\r\n//       \"subcategoryName\",\r\n//       \"basePrice\",\r\n//       \"difference\",\r\n//       \"finalPrice\",\r\n//       \"status\",\r\n//       \"validTill\",\r\n//       \"description\",\r\n//       \"imageUrl\",\r\n//     ];\r\n\r\n//     const rows = selectedData.map((p) => [\r\n//       p._id,\r\n//       p.name || \"\",\r\n//       p.category?.name || \"\",\r\n//       p.subcategory?.name || \"\",\r\n//       p.basePrice ?? \"\",\r\n//       p.difference ?? \"\",\r\n//       (Number(p.basePrice) + Number(p.difference || 0)) || \"\",\r\n//       p.status || \"\",\r\n//       p.validTill ? new Date(p.validTill).toISOString().split(\"T\")[0] : \"\",\r\n//       p.description || \"\",\r\n//       p.image || \"\",\r\n//     ]);\r\n\r\n//     const csvArray = [header, ...rows];\r\n//     const csvContent =\r\n//       \"data:text/csv;charset=utf-8,\" +\r\n//       csvArray.map((r) => r.map((c) => `\"${String(c).replace(/\"/g, '\"\"')}\"`).join(\",\")).join(\"\\n\");\r\n\r\n//     const encodedUri = encodeURI(csvContent);\r\n//     const link = document.createElement(\"a\");\r\n//     link.href = encodedUri;\r\n//     link.download = `selected_prices_${Date.now()}.csv`;\r\n//     link.click();\r\n//   };\r\n\r\n//   const filteredItems = items.filter((item) => {\r\n//     const t = search.toLowerCase();\r\n//     return (\r\n//       (item.name || \"\").toString().toLowerCase().includes(t) ||\r\n//       (item.category?.name || \"\").toLowerCase().includes(t) ||\r\n//       (item.subcategory?.name || \"\").toLowerCase().includes(t)\r\n//     );\r\n//   });\r\n\r\n//   const indexOfLast = currentPage * itemsPerPage;\r\n//   const currentItems = filteredItems.slice(indexOfLast - itemsPerPage, indexOfLast);\r\n//   const totalPages = Math.max(1, Math.ceil(filteredItems.length / itemsPerPage));\r\n\r\n//   return (\r\n//     <div style={styles.container}>\r\n//       {/* HEADER */}\r\n//       <div style={styles.header}>\r\n//         <h1 style={styles.title}>Product Management</h1>\r\n//         {/* <p style={styles.subtitle}>Manage prices, categories, images, CSV & bulk actions.</p> */}\r\n//       </div>\r\n\r\n//       {/* SEARCH */}\r\n//       <div style={styles.searchBar}>\r\n//         <input\r\n//           type=\"text\"\r\n//           placeholder=\"Search product, category or subcategory...\"\r\n//           value={search}\r\n//           onChange={(e) => {\r\n//             setSearch(e.target.value);\r\n//             setCurrentPage(1);\r\n//           }}\r\n//           style={styles.searchInput}\r\n//         />\r\n//       </div>\r\n\r\n//       {/* ADD PRODUCT BUTTON */}\r\n//       <div style={styles.addButtonWrapper}>\r\n//         <button\r\n//           style={styles.addButton}\r\n//           onClick={() => {\r\n//             setShowForm(!showForm);\r\n//             setEditId(null);\r\n//             setIsCopyMode(false);\r\n//           }}\r\n//         >\r\n//           {showForm ? \"‚úñ Close Form\" : \"‚ûï Add Product\"}\r\n//         </button>\r\n//       </div>\r\n\r\n//       {/* BULK BAR */}\r\n//       {selectedItems.length > 0 && (\r\n//         <div style={styles.bulkBar}>\r\n//           <span style={styles.bulkText}>{selectedItems.length} selected</span>\r\n\r\n//           {!bulkMode ? (\r\n//             <div style={{ display: \"flex\", gap: 10, flexWrap: \"wrap\" }}>\r\n//               <button style={styles.btnDelete} onClick={handleBulkDelete}>\r\n//                 üóë Bulk Delete\r\n//               </button>\r\n\r\n//               <button style={styles.btnPrimary} onClick={() => setBulkMode(true)}>\r\n//                 ‚úè Bulk Edit\r\n//               </button>\r\n\r\n//               <button style={styles.btnSmall} onClick={handleExportSelectedCsv}>\r\n//                 ‚§ì Export Selected\r\n//               </button>\r\n//             </div>\r\n//           ) : (\r\n//             <div style={styles.bulkPanel}>\r\n//               <h3 style={styles.bulkPanelTitle}>‚úè Bulk Edit Selected Items</h3>\r\n\r\n//               {items\r\n//                 .filter((item) => selectedItems.includes(item._id))\r\n//                 .map((item) => (\r\n//                   <div key={item._id} style={styles.bulkItemBox}>\r\n//                     <h4 style={styles.bulkItemTitle}>{item.name}</h4>\r\n\r\n//                     <div style={styles.formGrid}>\r\n//                       <div style={styles.formGroup}>\r\n//                         <label style={styles.label}>Name</label>\r\n//                         <input\r\n//                           type=\"text\"\r\n//                           value={item.name}\r\n//                           onChange={(e) => updateLocalItemField(item._id, \"name\", e.target.value)}\r\n//                           style={styles.input}\r\n//                         />\r\n//                       </div>\r\n\r\n//                       <div style={styles.formGroup}>\r\n//                         <label style={styles.label}>Base Price</label>\r\n//                         <input\r\n//                           type=\"number\"\r\n//                           value={item.basePrice}\r\n//                           onChange={(e) =>\r\n//                             updateLocalItemField(item._id, \"basePrice\", Number(e.target.value))\r\n//                           }\r\n//                           style={styles.input}\r\n//                         />\r\n//                       </div>\r\n\r\n//                       <div style={styles.formGroup}>\r\n//                         <label style={styles.label}>Category</label>\r\n//                         <select\r\n//                           value={item.category?._id || \"\"}\r\n//                           onChange={(e) => {\r\n//                             const newCat = e.target.value;\r\n//                             updateLocalItemField(item._id, \"category\", { _id: newCat });\r\n//                             const catObj = categories.find((c) => c._id === newCat);\r\n//                             const firstSub = catObj?.subcategories?.[0]?._id || \"\";\r\n//                             updateLocalItemField(item._id, \"subcategory\", { _id: firstSub });\r\n//                           }}\r\n//                           style={styles.select}\r\n//                         >\r\n//                           <option value=\"\">Select Category</option>\r\n//                           {categories.map((c) => (\r\n//                             <option key={c._id} value={c._id}>\r\n//                               {c.name}\r\n//                             </option>\r\n//                           ))}\r\n//                         </select>\r\n//                       </div>\r\n\r\n//                       <div style={styles.formGroup}>\r\n//                         <label style={styles.label}>Subcategory</label>\r\n//                         <select\r\n//                           value={item.subcategory?._id || \"\"}\r\n//                           onChange={(e) =>\r\n//                             updateLocalItemField(item._id, \"subcategory\", { _id: e.target.value })\r\n//                           }\r\n//                           style={styles.select}\r\n//                         >\r\n//                           <option value=\"\">Select Subcategory</option>\r\n//                           {categories\r\n//                             .find((c) => c._id === item.category?._id)\r\n//                             ?.subcategories?.map((s) => (\r\n//                               <option key={s._id} value={s._id}>\r\n//                                 {s.name}\r\n//                               </option>\r\n//                             ))}\r\n//                         </select>\r\n//                       </div>\r\n\r\n//                       <div style={styles.formGroup}>\r\n//                         <label style={styles.label}>Difference</label>\r\n//                         <input\r\n//                           type=\"number\"\r\n//                           value={item.difference || 0}\r\n//                           onChange={(e) =>\r\n//                             updateLocalItemField(item._id, \"difference\", Number(e.target.value))\r\n//                           }\r\n//                           style={styles.input}\r\n//                         />\r\n//                       </div>\r\n//                     </div>\r\n//                   </div>\r\n//                 ))}\r\n\r\n//               <div style={{ display: \"flex\", gap: 10, marginTop: 12 }}>\r\n//                 <button style={styles.btnPrimary} onClick={handleBulkSave}>\r\n//                   ‚úî Save All\r\n//                 </button>\r\n//                 <button style={styles.btnCancel} onClick={() => setBulkMode(false)}>\r\n//                   ‚úñ Cancel\r\n//                 </button>\r\n//               </div>\r\n//             </div>\r\n//           )}\r\n//         </div>\r\n//       )}\r\n\r\n//       {/* FORM */}\r\n//       {showForm && (\r\n//         <div style={styles.formCard}>\r\n//           <h2 style={styles.formTitle}>‚ûï Add Product</h2>\r\n\r\n//           <form onSubmit={handleSubmit}>\r\n//             <div style={styles.formGrid}>\r\n//               <div style={styles.formGroup}>\r\n//                 <label style={styles.label}>Product Name *</label>\r\n//                 <input required name=\"name\" value={form.name} onChange={handleChange} style={styles.input} />\r\n//               </div>\r\n\r\n//               <div style={styles.formGroup}>\r\n//                 <label style={styles.label}>Category *</label>\r\n//                 <div style={styles.categoryRow}>\r\n//                   <select\r\n//                     required\r\n//                     name=\"category\"\r\n//                     value={form.category}\r\n//                     onChange={(e) => {\r\n//                       handleChange(e);\r\n//                       setForm((p) => ({ ...p, subcategory: \"\" }));\r\n//                     }}\r\n//                     style={styles.select}\r\n//                   >\r\n//                     <option value=\"\">Select Category</option>\r\n//                     {categories.map((c) => (\r\n//                       <option value={c._id} key={c._id}>\r\n//                         {c.name}\r\n//                       </option>\r\n//                     ))}\r\n//                   </select>\r\n\r\n//                   <button type=\"button\" style={styles.btnSmall} onClick={() => setAddingCategory((v) => !v)}>\r\n//                     {addingCategory ? \"Close\" : \"Add\"}\r\n//                   </button>\r\n//                 </div>\r\n//               </div>\r\n\r\n//               {addingCategory && (\r\n//                 <div style={styles.addCategoryBox}>\r\n//                   <label style={styles.label}>Add New Category</label>\r\n//                   <div style={styles.categoryRow}>\r\n//                     <input\r\n//                       value={newCategoryName}\r\n//                       onChange={(e) => setNewCategoryName(e.target.value)}\r\n//                       placeholder=\"Category name\"\r\n//                       style={styles.input}\r\n//                     />\r\n//                     <input\r\n//                       type=\"file\"\r\n//                       accept=\"image/*\"\r\n//                       onChange={(e) => {\r\n//                         setNewCategoryImage(e.target.files[0]);\r\n//                         setNewCategoryPreview(e.target.files[0] ? URL.createObjectURL(e.target.files[0]) : null);\r\n//                       }}\r\n//                       style={styles.fileInput}\r\n//                     />\r\n//                     <button style={styles.btnPrimary} type=\"button\" onClick={handleCreateCategory}>\r\n//                       Create\r\n//                     </button>\r\n//                   </div>\r\n//                   {newCategoryPreview && <img src={newCategoryPreview} style={styles.preview} alt=\"preview\" />}\r\n//                 </div>\r\n//               )}\r\n\r\n//               <div style={styles.formGroup}>\r\n//                 <label style={styles.label}>Subcategory</label>\r\n//                 <div style={styles.categoryRow}>\r\n//                   <select name=\"subcategory\" value={form.subcategory} onChange={handleChange} disabled={!subcategories.length} style={styles.select}>\r\n//                     <option value=\"\">Select Subcategory</option>\r\n//                     {subcategories.map((s) => (\r\n//                       <option value={s._id} key={s._id}>\r\n//                         {s.name}\r\n//                       </option>\r\n//                     ))}\r\n//                   </select>\r\n\r\n//                   {form.category && (\r\n//                     <button type=\"button\" style={styles.btnSmall} onClick={() => setAddingSub((v) => !v)}>\r\n//                       {addingSub ? \"Close\" : \"Add\"}\r\n//                     </button>\r\n//                   )}\r\n//                 </div>\r\n//               </div>\r\n\r\n//               {addingSub && (\r\n//                 <div style={styles.addCategoryBox}>\r\n//                   <label style={styles.label}>Add New Subcategory</label>\r\n//                   <div style={styles.categoryRow}>\r\n//                     <input value={newSubName} onChange={(e) => setNewSubName(e.target.value)} placeholder=\"Subcategory name\" style={styles.input} />\r\n//                     <input\r\n//                       type=\"file\"\r\n//                       accept=\"image/*\"\r\n//                       onChange={(e) => {\r\n//                         setNewSubImage(e.target.files[0]);\r\n//                         setNewSubPreview(e.target.files[0] ? URL.createObjectURL(e.target.files[0]) : null);\r\n//                       }}\r\n//                       style={styles.fileInput}\r\n//                     />\r\n//                     <button style={styles.btnPrimary} type=\"button\" onClick={handleCreateSub}>\r\n//                       Create\r\n//                     </button>\r\n//                   </div>\r\n//                   {newSubPreview && <img src={newSubPreview} style={styles.preview} alt=\"preview\" />}\r\n//                 </div>\r\n//               )}\r\n\r\n//               <div style={styles.formGroup}>\r\n//                 <label style={styles.label}>Base Price *</label>\r\n//                 <input type=\"number\" required name=\"basePrice\" value={form.basePrice} onChange={handleChange} style={styles.input} />\r\n//               </div>\r\n\r\n//               <div style={styles.formGroup}>\r\n//                 <label style={styles.label}>Difference</label>\r\n//                 <input type=\"number\" name=\"difference\" value={form.difference} onChange={handleChange} style={styles.input} />\r\n//               </div>\r\n\r\n//               <div style={styles.formGroup}>\r\n//                 <label style={styles.label}>Valid Till</label>\r\n//                 <input type=\"date\" name=\"validTill\" value={form.validTill} onChange={handleChange} style={styles.input} />\r\n//               </div>\r\n\r\n//               <div style={styles.formGroup}>\r\n//                 <label style={styles.label}>Image</label>\r\n//                 <input type=\"file\" accept=\"image/*\" onChange={handleChange} style={styles.fileInput} />\r\n//               </div>\r\n//             </div>\r\n\r\n//             <div style={styles.formGroup}>\r\n//               <label style={styles.label}>Description</label>\r\n//               <textarea name=\"description\" value={form.description} onChange={handleChange} style={styles.textarea}></textarea>\r\n//             </div>\r\n\r\n//             <div style={styles.formActions}>\r\n//               <button style={styles.btnPrimary} disabled={loading}>\r\n//                 {loading ? \"Saving...\" : \"Add Product\"}\r\n//               </button>\r\n//             </div>\r\n//           </form>\r\n//         </div>\r\n//       )}\r\n\r\n//       {/* CSV CONTROLS */}\r\n//       <div style={styles.csvControls}>\r\n//         <div>\r\n//           <input type=\"file\" accept=\".csv\" ref={csvInputRef} onChange={handleCsvSelect} style={styles.fileInput} />\r\n//           <button style={styles.btnSmall} onClick={handleImportCsv}>\r\n//             Import CSV\r\n//           </button>\r\n//         </div>\r\n\r\n//         <div style={{ display: \"flex\", gap: 8 }}>\r\n//           <button style={styles.btnPrimary} onClick={handleExportCsv}>\r\n//             Export All CSV\r\n//           </button>\r\n\r\n//           <button style={styles.btnSmall} onClick={handleExportSelectedCsv}>\r\n//             Export Selected CSV\r\n//           </button>\r\n//         </div>\r\n//       </div>\r\n\r\n//       {/* TABLE */}\r\n//       <div style={styles.tableCard}>\r\n//         <div style={styles.tableHeader}>\r\n//           <h2 style={styles.tableTitle}>üìã Items</h2>\r\n//           <span style={styles.totalCount}>Total: {filteredItems.length}</span>\r\n//         </div>\r\n\r\n//         <div style={styles.tableWrapper}>\r\n//           <table style={styles.table}>\r\n//             <thead>\r\n//               <tr>\r\n//                 <th style={styles.th}>\r\n//                   <input\r\n//                     type=\"checkbox\"\r\n//                     checked={selectedItems.length === filteredItems.length && filteredItems.length > 0}\r\n//                     onChange={() => {\r\n//                       if (selectedItems.length === filteredItems.length) setSelectedItems([]);\r\n//                       else setSelectedItems(filteredItems.map((x) => x._id));\r\n//                     }}\r\n//                   />\r\n//                 </th>\r\n//                 <th style={styles.th}>Sr</th>\r\n//                 <th style={styles.th}>Image</th>\r\n//                 <th style={styles.th}>Name</th>\r\n//                 <th style={styles.th}>Category</th>\r\n//                 <th style={styles.th}>Subcategory</th>\r\n//                 <th style={styles.th}>Base</th>\r\n//                 <th style={styles.th}>Diff</th>\r\n//                 <th style={styles.th}>Final</th>\r\n//                 <th style={styles.th}>Status</th>\r\n//                 <th style={styles.th}>Valid Till</th>\r\n//                 <th style={styles.th}>Actions</th>\r\n//               </tr>\r\n//             </thead>\r\n\r\n//             <tbody>\r\n//               {currentItems.map((item, i) => (\r\n//                 <tr key={item._id} style={styles.tr}>\r\n//                   <td style={styles.td}>\r\n//                     <input\r\n//                       type=\"checkbox\"\r\n//                       checked={selectedItems.includes(item._id)}\r\n//                       onChange={() =>\r\n//                         setSelectedItems((prev) => (prev.includes(item._id) ? prev.filter((x) => x !== item._id) : [...prev, item._id]))\r\n//                       }\r\n//                     />\r\n//                   </td>\r\n\r\n//                   <td style={styles.td}>{(currentPage - 1) * itemsPerPage + (i + 1)}</td>\r\n\r\n//                   <td style={styles.td}>{item.image ? <img src={item.image} style={styles.tableImg} alt=\"\" /> : \"No Img\"}</td>\r\n\r\n//                   <td style={styles.td}>{item.name}</td>\r\n//                   <td style={styles.td}>{item.category?.name || \"-\"}</td>\r\n//                   <td style={styles.td}>{item.subcategory?.name || \"-\"}</td>\r\n\r\n//                   <td style={styles.td}>‚Çπ{item.basePrice}</td>\r\n//                   <td style={styles.td}>{item.difference || 0}</td>\r\n//                   <td style={styles.td}>‚Çπ{Number(item.basePrice) + Number(item.difference || 0)}</td>\r\n\r\n//                   <td style={styles.td}>\r\n//                     <button\r\n//                       style={item.status === \"active\" ? styles.statusActive : styles.statusInactive}\r\n//                       onClick={() => handleStatusToggle(item)}\r\n//                     >\r\n//                       {item.status === \"active\" ? \"Active\" : \"Inactive\"}\r\n//                     </button>\r\n//                   </td>\r\n\r\n//                   <td style={styles.td}>{item.validTill ? new Date(item.validTill).toLocaleDateString() : \"-\"}</td>\r\n\r\n//                   <td style={styles.td}>\r\n//                     <div style={{ position: \"relative\" }}>\r\n//                       <button\r\n//                         style={styles.menuButton}\r\n//                         onClick={() => setActiveMenu(activeMenu === item._id ? null : item._id)}\r\n//                       >\r\n//                         ‚ãÆ\r\n//                       </button>\r\n\r\n//                       {activeMenu === item._id && (\r\n//                         <div style={styles.dropdown}>\r\n//                           <button style={styles.dropdownItem} onClick={() => handleEdit(item)}>\r\n//                             ‚úè Edit\r\n//                           </button>\r\n//                           <button style={styles.dropdownItem} onClick={() => handleCopyToEdit(item)}>\r\n//                             üìÑ Copy\r\n//                           </button>\r\n//                           <button style={styles.dropdownItemDelete} onClick={() => handleDelete(item._id)}>\r\n//                             üóë Delete\r\n//                           </button>\r\n//                         </div>\r\n//                       )}\r\n//                     </div>\r\n//                   </td>\r\n//                 </tr>\r\n//               ))}\r\n//             </tbody>\r\n//           </table>\r\n//         </div>\r\n\r\n//         {/* PAGINATION */}\r\n//         <div style={styles.pagination}>\r\n//           <button style={styles.paginationBtn} disabled={currentPage === 1} onClick={() => setCurrentPage((p) => p - 1)}>\r\n//             Previous\r\n//           </button>\r\n\r\n//           {Array.from({ length: totalPages }, (_, i) => (\r\n//             <button\r\n//               key={i}\r\n//               style={i + 1 === currentPage ? styles.paginationBtnActive : styles.paginationBtn}\r\n//               onClick={() => setCurrentPage(i + 1)}\r\n//             >\r\n//               {i + 1}\r\n//             </button>\r\n//           ))}\r\n\r\n//           <button style={styles.paginationBtn} disabled={currentPage === totalPages} onClick={() => setCurrentPage((p) => p + 1)}>\r\n//             Next\r\n//           </button>\r\n//         </div>\r\n//       </div>\r\n\r\n//       {/* MODAL FOR EDIT/COPY */}\r\n//       {showModal && (\r\n//         <div style={styles.modalOverlay} onClick={() => setShowModal(false)}>\r\n//           <div style={styles.modal} onClick={(e) => e.stopPropagation()}>\r\n//             <h2 style={styles.modalTitle}>{isCopyMode ? \"üìÑ Copy Product\" : \"‚úè Edit Product\"}</h2>\r\n\r\n//             <form onSubmit={handleSubmit}>\r\n//               <div style={styles.formGrid}>\r\n//                 <div style={styles.formGroup}>\r\n//                   <label style={styles.label}>Product Name *</label>\r\n//                   <input required name=\"name\" value={form.name} onChange={handleChange} style={styles.input} />\r\n//                 </div>\r\n\r\n//                 <div style={styles.formGroup}>\r\n//                   <label style={styles.label}>Category *</label>\r\n//                   <select\r\n//                     required\r\n//                     name=\"category\"\r\n//                     value={form.category}\r\n//                     onChange={(e) => {\r\n//                       handleChange(e);\r\n//                       setForm((p) => ({ ...p, subcategory: \"\" }));\r\n//                     }}\r\n//                     style={styles.select}\r\n//                   >\r\n//                     <option value=\"\">Select Category</option>\r\n//                     {categories.map((c) => (\r\n//                       <option value={c._id} key={c._id}>\r\n//                         {c.name}\r\n//                       </option>\r\n//                     ))}\r\n//                   </select>\r\n//                 </div>\r\n\r\n//                 <div style={styles.formGroup}>\r\n//                   <label style={styles.label}>Subcategory</label>\r\n//                   <select name=\"subcategory\" value={form.subcategory} onChange={handleChange} disabled={!subcategories.length} style={styles.select}>\r\n//                     <option value=\"\">Select Subcategory</option>\r\n//                     {subcategories.map((s) => (\r\n//                       <option value={s._id} key={s._id}>\r\n//                         {s.name}\r\n//                       </option>\r\n//                     ))}\r\n//                   </select>\r\n//                 </div>\r\n\r\n//                 <div style={styles.formGroup}>\r\n//                   <label style={styles.label}>Base Price *</label>\r\n//                   <input type=\"number\" required name=\"basePrice\" value={form.basePrice} onChange={handleChange} style={styles.input} />\r\n//                 </div>\r\n\r\n//                 <div style={styles.formGroup}>\r\n//                   <label style={styles.label}>Difference</label>\r\n//                   <input type=\"number\" name=\"difference\" value={form.difference} onChange={handleChange} style={styles.input} />\r\n//                 </div>\r\n\r\n//                 <div style={styles.formGroup}>\r\n//                   <label style={styles.label}>Valid Till</label>\r\n//                   <input type=\"date\" name=\"validTill\" value={form.validTill} onChange={handleChange} style={styles.input} />\r\n//                 </div>\r\n\r\n//                 <div style={styles.formGroup}>\r\n//                   <label style={styles.label}>Image</label>\r\n//                   <input type=\"file\" accept=\"image/*\" onChange={handleChange} style={styles.fileInput} />\r\n//                 </div>\r\n//               </div>\r\n\r\n//               <div style={styles.formGroup}>\r\n//                 <label style={styles.label}>Description</label>\r\n//                 <textarea name=\"description\" value={form.description} onChange={handleChange} style={styles.textarea}></textarea>\r\n//               </div>\r\n\r\n//               <div style={styles.formActions}>\r\n//                 <button style={styles.btnPrimary} disabled={loading}>\r\n//                   {loading ? \"Saving...\" : isCopyMode ? \"Save Copy\" : \"Update\"}\r\n//                 </button>\r\n\r\n//                 <button\r\n//                   type=\"button\"\r\n//                   style={styles.btnCancel}\r\n//                   onClick={() => {\r\n//                     setShowModal(false);\r\n//                     setEditId(null);\r\n//                     setIsCopyMode(false);\r\n//                     setForm({\r\n//                       name: \"\",\r\n//                       category: \"\",\r\n//                       subcategory: \"\",\r\n//                       description: \"\",\r\n//                       basePrice: \"\",\r\n//                       difference: \"\",\r\n//                       validTill: \"\",\r\n//                       file: null,\r\n//                     });\r\n//                   }}\r\n//                 >\r\n//                   Cancel\r\n//                 </button>\r\n//               </div>\r\n//             </form>\r\n//           </div>\r\n//         </div>\r\n//       )}\r\n//     </div>\r\n//   );\r\n// }\r\n\r\n// const styles = {\r\n//   container: {\r\n\r\n//   },\r\n//   header: {\r\n  \r\n//   },\r\n//   title: {\r\n//     fontSize: \"30px\",\r\n//     fontWeight: \"700\",\r\n//     color: \"#0d3b66\",\r\n//     marginBottom: \"6px\",\r\n//   },\r\n//   subtitle: {\r\n//    fontSize: \"16px\",\r\n//   },\r\n//   searchBar: {\r\n//     maxWidth: \"480px\",\r\n//     margin: \"0 auto 25px auto\",\r\n//   },\r\n//   searchInput: {\r\n//     width: \"100%\",\r\n//     padding: \"12px 15px\",\r\n//     borderRadius: \"12px\",\r\n//     border: \"1px solid #ced4da\",\r\n//     background: \"#f9fbfc\",\r\n//     fontSize: \"15px\",\r\n//     outline: \"none\",\r\n//     boxShadow: \"0 2px 6px rgba(0, 0, 0, 0.06)\",\r\n//   },\r\n//   addButtonWrapper: {\r\n//     textAlign: \"center\",\r\n//     marginBottom: \"25px\",\r\n//   },\r\n//   addButton: {\r\n//     background: \"#007bff\",\r\n//     color: \"#fff\",\r\n//     border: \"none\",\r\n//     borderRadius: \"12px\",\r\n//     padding: \"12px 24px\",\r\n//     fontSize: \"16px\",\r\n//     fontWeight: \"600\",\r\n//     cursor: \"pointer\",\r\n//     transition: \"0.25s ease\",\r\n//   },\r\n//   bulkBar: {\r\n//     background: \"#e9f2ff\",\r\n//     border: \"1px solid #c4d9ff\",\r\n//     borderRadius: \"14px\",\r\n//     padding: \"15px 18px\",\r\n//     marginBottom: \"25px\",\r\n//     display: \"flex\",\r\n//     justifyContent: \"space-between\",\r\n//     alignItems: \"center\",\r\n//     flexWrap: \"wrap\",\r\n//     gap: \"14px\",\r\n//     boxShadow: \"0 3px 10px rgba(0, 80, 160, 0.1)\",\r\n//   },\r\n//   bulkText: {\r\n//     fontSize: \"15px\",\r\n//     fontWeight: \"600\",\r\n//     color: \"#0d3b66\",\r\n//   },\r\n//   bulkPanel: {\r\n//     width: \"100%\",\r\n//     background: \"#f7faff\",\r\n//     border: \"1px solid #cfe2ff\",\r\n//     padding: \"20px\",\r\n//     borderRadius: \"14px\",\r\n//     marginTop: \"10px\",\r\n//     boxShadow: \"0 4px 14px rgba(0, 60, 120, 0.08)\",\r\n//   },\r\n//   bulkPanelTitle: {\r\n//     textAlign: \"center\",\r\n//     fontSize: \"18px\",\r\n//     fontWeight: \"700\",\r\n//     marginBottom: \"15px\",\r\n//   },\r\n//   bulkItemBox: {\r\n//     background: \"#ffffff\",\r\n//     border: \"1px solid #dbe5f5\",\r\n//     padding: \"18px\",\r\n//     borderRadius: \"12px\",\r\n//     marginBottom: \"16px\",\r\n//     boxShadow: \"0 2px 10px rgba(0, 0, 50, 0.05)\",\r\n//   },\r\n//   bulkItemTitle: {\r\n//     fontSize: \"16px\",\r\n//     fontWeight: \"600\",\r\n//     marginBottom: \"12px\",\r\n//     color: \"#0d3b66\",\r\n//     borderLeft: \"4px solid #007bff\",\r\n//     paddingLeft: \"10px\",\r\n//   },\r\n//   formCard: {\r\n//     borderRadius: \"16px\",\r\n//     padding: \"25px\",\r\n//     marginBottom: \"28px\",\r\n//     background: \"#ffffff\",\r\n//     boxShadow: \"0 4px 16px rgba(0, 0, 0, 0.08)\",\r\n//     border: \"1px solid #eef2f7\",\r\n//   },\r\n//   formTitle: {\r\n//     fontSize: \"21px\",\r\n//     fontWeight: \"700\",\r\n//     color: \"#0d3b66\",\r\n//     marginBottom: \"15px\",\r\n//   },\r\n//   formGrid: {\r\n//     display: \"grid\",\r\n//     gridTemplateColumns: \"repeat(auto-fit, minmax(230px, 1fr))\",\r\n//     gap: \"18px\",\r\n//   },\r\n//   formGroup: {\r\n//     display: \"flex\",\r\n//     flexDirection: \"column\",\r\n//     gap: \"6px\",\r\n//   },\r\n//   label: {\r\n//     fontWeight: \"600\",\r\n//     fontSize: \"14px\",\r\n//     color: \"#233142\",\r\n//   },\r\n//   input: {\r\n//     padding: \"10px\",\r\n//     borderRadius: \"10px\",\r\n//     border: \"1px solid #cfd6e0\",\r\n//     background: \"#f8fafc\",\r\n//     transition: \"0.2s ease\",\r\n//     fontSize: \"14px\",\r\n//   },\r\n//   select: {\r\n//     padding: \"10px\",\r\n//     borderRadius: \"10px\",\r\n//     border: \"1px solid #cfd6e0\",\r\n//     background: \"#f8fafc\",\r\n//     transition: \"0.2s ease\",\r\n//     fontSize: \"14px\",\r\n//   },\r\n//   textarea: {\r\n//     padding: \"10px\",\r\n//     borderRadius: \"10px\",\r\n//     border: \"1px solid #cfd6e0\",\r\n//     background: \"#f8fafc\",\r\n//     transition: \"0.2s ease\",\r\n//     resize: \"none\",\r\n//     minHeight: \"80px\",\r\n//     fontSize: \"14px\",\r\n//   },\r\n//   fileInput: {\r\n//     padding: \"8px\",\r\n//     fontSize: \"13px\",\r\n//   },\r\n//   categoryRow: {\r\n//     display: \"flex\",\r\n//     gap: \"10px\",\r\n//     alignItems: \"center\",\r\n//   },\r\n//   addCategoryBox: {\r\n//     gridColumn: \"1 / -1\",\r\n//     background: \"#f1f7ff\",\r\n//     border: \"1px solid #cfe1ff\",\r\n//     padding: \"16px\",\r\n//     borderRadius: \"12px\",\r\n//   },\r\n//   preview: {\r\n//     width: \"110px\",\r\n//     height: \"110px\",\r\n//     borderRadius: \"12px\",\r\n//     marginTop: \"10px\",\r\n//     objectFit: \"cover\",\r\n//     border: \"1px solid #b7c9e2\",\r\n//   },\r\n//   formActions: {\r\n//     marginTop: \"15px\",\r\n//     display: \"flex\",\r\n//     gap: \"12px\",\r\n//     flexWrap: \"wrap\",\r\n//   },\r\n//   btnPrimary: {\r\n//     background: \"#007bff\",\r\n//     color: \"#fff\",\r\n//     border: \"none\",\r\n//     borderRadius: \"10px\",\r\n//     padding: \"9px 16px\",\r\n//     fontWeight: \"600\",\r\n//     cursor: \"pointer\",\r\n//     transition: \"0.25s ease\",\r\n//   },\r\n//   btnSmall: {\r\n//     background: \"#43a047\",\r\n//     color: \"#fff\",\r\n//     border: \"none\",\r\n//     borderRadius: \"10px\",\r\n//     padding: \"9px 16px\",\r\n//     fontWeight: \"600\",\r\n//     cursor: \"pointer\",\r\n//     transition: \"0.25s ease\",\r\n//   },\r\n//   btnDelete: {\r\n//     background: \"#e63946\",\r\n//     color: \"#fff\",\r\n//     border: \"none\",\r\n//     borderRadius: \"10px\",\r\n//     padding: \"9px 16px\",\r\n//     fontWeight: \"600\",\r\n//     cursor: \"pointer\",\r\n//     transition: \"0.25s ease\",\r\n//   },\r\n//   btnCancel: {\r\n//     background: \"#adb5bd\",\r\n//     color: \"#fff\",\r\n//     border: \"none\",\r\n//     borderRadius: \"10px\",\r\n//     padding: \"9px 16px\",\r\n//     fontWeight: \"600\",\r\n//     cursor: \"pointer\",\r\n//     transition: \"0.25s ease\",\r\n//   },\r\n//   csvControls: {\r\n//     borderRadius: \"12px\",\r\n//     padding: \"16px\",\r\n//     background: \"#f7faff\",\r\n//     border: \"1px solid #d8e6ff\",\r\n//     display: \"flex\",\r\n//     alignItems: \"center\",\r\n//     justifyContent: \"space-between\",\r\n//     marginBottom: \"28px\",\r\n//     flexWrap: \"wrap\",\r\n//     gap: \"12px\",\r\n//   },\r\n//   tableCard: {\r\n//     background: \"#fff\",\r\n//     borderRadius: \"14px\",\r\n//     padding: \"20px\",\r\n//     boxShadow: \"0 4px 18px rgba(0, 0, 0, 0.08)\",\r\n//     border: \"1px solid #eef2f7\",\r\n//   },\r\n//   tableHeader: {\r\n//     display: \"flex\",\r\n//     justifyContent: \"space-between\",\r\n//     marginBottom: \"15px\",\r\n//   },\r\n//   tableTitle: {\r\n//     fontSize: \"21px\",\r\n//     fontWeight: \"700\",\r\n//     color: \"#0d3b66\",\r\n//   },\r\n//   totalCount: {\r\n//     fontSize: \"15px\",\r\n//     color: \"#6c757d\",\r\n//     fontWeight: \"600\",\r\n//   },\r\n//   tableWrapper: {\r\n//     overflowX: \"auto\",\r\n//   },\r\n//   table: {\r\n//     width: \"100%\",\r\n//     borderCollapse: \"collapse\",\r\n//     fontSize: \"14px\",\r\n//   },\r\n//   th: {\r\n//     background: \"#e9f2ff\",\r\n//     padding: \"12px\",\r\n//     fontWeight: \"700\",\r\n//     color: \"#0d3b66\",\r\n//     textAlign: \"left\",\r\n//     whiteSpace: \"nowrap\",\r\n//   },\r\n//   tr: {\r\n//     borderBottom: \"1px solid #edf2f7\",\r\n//   },\r\n//   td: {\r\n//     padding: \"12px 10px\",\r\n//     whiteSpace: \"nowrap\",\r\n//   },\r\n//   tableImg: {\r\n//     width: \"55px\",\r\n//     height: \"55px\",\r\n//     borderRadius: \"8px\",\r\n//     objectFit: \"cover\",\r\n//     border: \"1px solid #cfd9e5\",\r\n//   },\r\n//   statusActive: {\r\n//     background: \"#93d8ba\",\r\n//     padding: \"7px 12px\",\r\n//     borderRadius: \"8px\",\r\n//     color: \"black\",\r\n//     fontWeight: \"600\",\r\n//     border: \"none\",\r\n//     cursor: \"pointer\",\r\n//   },\r\n//   statusInactive: {\r\n//     background: \"#d9b1b1\",\r\n//     padding: \"7px 12px\",\r\n//     borderRadius: \"8px\",\r\n//     color: \"black\",\r\n//     fontWeight: \"600\",\r\n//     border: \"none\",\r\n//     cursor: \"pointer\",\r\n//   },\r\n//   menuButton: {\r\n//     background: \"#f0f0f0\",\r\n//     border: \"none\",\r\n//     borderRadius: \"6px\",\r\n//     padding: \"6px 12px\",\r\n//     fontSize: \"20px\",\r\n//     fontWeight: \"bold\",\r\n//     cursor: \"pointer\",\r\n//     transition: \"0.2s ease\",\r\n//   },\r\n//   dropdown: {\r\n//     position: \"absolute\",\r\n//     right: \"0\",\r\n//     top: \"35px\",\r\n//     background: \"#fff\",\r\n//     border: \"1px solid #ddd\",\r\n//     borderRadius: \"8px\",\r\n//     boxShadow: \"0 4px 12px rgba(0,0,0,0.15)\",\r\n//     zIndex: \"100\",\r\n//     minWidth: \"140px\",\r\n//   },\r\n//   dropdownItem: {\r\n//     display: \"block\",\r\n//     width: \"100%\",\r\n//     padding: \"10px 15px\",\r\n//     background: \"transparent\",\r\n//     border: \"none\",\r\n//     textAlign: \"left\",\r\n//     cursor: \"pointer\",\r\n//     fontSize: \"14px\",\r\n//     fontWeight: \"500\",\r\n//     transition: \"0.2s ease\",\r\n//     borderBottom: \"1px solid #f0f0f0\",\r\n//   },\r\n//   dropdownItemDelete: {\r\n//     display: \"block\",\r\n//     width: \"100%\",\r\n//     padding: \"10px 15px\",\r\n//     background: \"transparent\",\r\n//     border: \"none\",\r\n//     textAlign: \"left\",\r\n//     cursor: \"pointer\",\r\n//     fontSize: \"14px\",\r\n//     fontWeight: \"500\",\r\n//     color: \"#e63946\",\r\n//     transition: \"0.2s ease\",\r\n//   },\r\n//   pagination: {\r\n//     marginTop: \"18px\",\r\n//     display: \"flex\",\r\n//     justifyContent: \"center\",\r\n//     gap: \"10px\",\r\n//     flexWrap: \"wrap\",\r\n//   },\r\n//   paginationBtn: {\r\n//     padding: \"9px 13px\",\r\n//     borderRadius: \"8px\",\r\n//     background: \"#fff\",\r\n//     border: \"1px solid #ddd\",\r\n//     cursor: \"pointer\",\r\n//     fontSize: \"14px\",\r\n//   },\r\n//   paginationBtnActive: {\r\n//     padding: \"9px 13px\",\r\n//     borderRadius: \"8px\",\r\n//     background: \"#007bff\",\r\n//     color: \"white\",\r\n//     border: \"1px solid #0062cc\",\r\n//     cursor: \"pointer\",\r\n//     fontSize: \"14px\",\r\n//   },\r\n//   modalOverlay: {\r\n//     position: \"fixed\",\r\n//     top: 0,\r\n//     left: 0,\r\n//     right: 0,\r\n//     bottom: 0,\r\n//     background: \"rgba(0, 0, 0, 0.5)\",\r\n//     display: \"flex\",\r\n//     justifyContent: \"center\",\r\n//     alignItems: \"center\",\r\n//     zIndex: \"1000\",\r\n//     padding: \"20px\",\r\n//   },\r\n//   modal: {\r\n//     background: \"#fff\",\r\n//     borderRadius: \"16px\",\r\n//     padding: \"30px\",\r\n//     maxWidth: \"700px\",\r\n//     width: \"100%\",\r\n//     maxHeight: \"90vh\",\r\n//     overflowY: \"auto\",\r\n//     boxShadow: \"0 10px 40px rgba(0, 0, 0, 0.3)\",\r\n//   },\r\n//   modalTitle: {\r\n//     fontSize: \"22px\",\r\n//     fontWeight: \"700\",\r\n//     color: \"#0d3b66\",\r\n//     marginBottom: \"20px\",\r\n//     textAlign: \"center\",\r\n//   },\r\n  \r\n// }\r\nimport React, { useEffect, useState, useRef } from \"react\";\r\nimport axios from \"axios\";\r\nimport \"./PriceList.css\"; // <-- new CSS\r\n\r\nconst API_URL = \"https://grocerrybackend.vercel.app/api/prices\";\r\nconst CATEGORY_URL = \"https://grocerrybackend.vercel.app/api/categories\";\r\n\r\nexport default function PriceList() {\r\n  const [items, setItems] = useState([]);\r\n  const [categories, setCategories] = useState([]);\r\n  const [subcategories, setSubcategories] = useState([]);\r\n  const [isMobile, setIsMobile] = useState(window.innerWidth < 768);\r\n  const [search, setSearch] = useState(\"\");\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  // FORM state\r\n  const [form, setForm] = useState({\r\n    name: \"\",\r\n    category: \"\",\r\n    subcategory: \"\",\r\n    description: \"\",\r\n    basePrice: \"\",\r\n    difference: \"\",\r\n    validTill: \"\",\r\n    file: null,\r\n  });\r\n\r\n  const [editId, setEditId] = useState(null);\r\n  const [isCopyMode, setIsCopyMode] = useState(false);\r\n  const [showForm, setShowForm] = useState(false);\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [activeMenu, setActiveMenu] = useState(null);\r\n\r\n  const [addingCategory, setAddingCategory] = useState(false);\r\n  const [newCategoryName, setNewCategoryName] = useState(\"\");\r\n  const [newCategoryImage, setNewCategoryImage] = useState(null);\r\n  const [newCategoryPreview, setNewCategoryPreview] = useState(null);\r\n\r\n  const [addingSub, setAddingSub] = useState(false);\r\n  const [newSubName, setNewSubName] = useState(\"\");\r\n  const [newSubImage, setNewSubImage] = useState(null);\r\n  const [newSubPreview, setNewSubPreview] = useState(null);\r\n\r\n  const [selectedItems, setSelectedItems] = useState([]);\r\n  const [bulkMode, setBulkMode] = useState(false);\r\n\r\n  const [csvFile, setCsvFile] = useState(null);\r\n  const csvInputRef = useRef();\r\n\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const itemsPerPage = 30;\r\n\r\n  // load categories then items\r\n  useEffect(() => { fetchCategories(); }, []);\r\n  useEffect(() => { if (categories.length) fetchItems(); }, [categories]);\r\n\r\n  useEffect(() => {\r\n    const handleResize = () => setIsMobile(window.innerWidth < 768);\r\n    window.addEventListener(\"resize\", handleResize);\r\n    return () => window.removeEventListener(\"resize\", handleResize);\r\n  }, []);\r\n\r\n  const fetchItems = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const res = await axios.get(API_URL);\r\n      if (res.data && res.data.success) {\r\n        const raw = res.data.data || [];\r\n        // enrich categories/subcategories to names (if categories loaded)\r\n        const enriched = raw.map((item) => {\r\n          const cat = categories.find((c) => c._id === item.category || c._id === item.category?._id);\r\n          const sub = cat?.subcategories?.find((s) => s._id === item.subcategory || s._id === item.subcategory?._id);\r\n          return {\r\n            ...item,\r\n            category: cat ? { _id: cat._id, name: cat.name } : item.category,\r\n            subcategory: sub ? { _id: sub._id, name: sub.name } : item.subcategory,\r\n          };\r\n        });\r\n        setItems(enriched);\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Fetch items error\", err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchCategories = async () => {\r\n    try {\r\n      const res = await axios.get(CATEGORY_URL);\r\n      if (res.data && res.data.success) setCategories(res.data.categories || []);\r\n    } catch (err) {\r\n      console.error(\"Fetch categories error\", err);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!form.category) {\r\n      setSubcategories([]);\r\n      setForm((prev) => ({ ...prev, subcategory: \"\" }));\r\n      return;\r\n    }\r\n    const cat = categories.find((c) => c._id === form.category);\r\n    setSubcategories(cat?.subcategories || []);\r\n    const exists = (cat?.subcategories || []).some((s) => s._id === form.subcategory);\r\n    if (!exists) setForm((prev) => ({ ...prev, subcategory: \"\" }));\r\n  }, [form.category, categories]);\r\n\r\n  // form handlers (kept minimal)\r\n  const handleChange = (e) => {\r\n    const { name, value, files } = e.target;\r\n    if (files && files.length) setForm((p) => ({ ...p, file: files[0] }));\r\n    else setForm((p) => ({ ...p, [name]: value }));\r\n  };\r\n\r\n  // CSV export helpers (kept unchanged from your code)\r\n  const handleExportCsv = () => {\r\n    if (!items.length) return alert(\"No items to export\");\r\n    const header = [\"id\",\"name\",\"categoryName\",\"subcategoryName\",\"basePrice\",\"difference\",\"finalPrice\",\"status\",\"validTill\",\"description\",\"imageUrl\"];\r\n    const rows = items.map((p) => [\r\n      p._id, p.name||\"\", p.category?.name||\"\", p.subcategory?.name||\"\", p.basePrice||\"\", p.difference||\"\", (Number(p.basePrice||0) + Number(p.difference||0))||\"\", p.status||\"\", p.validTill?new Date(p.validTill).toISOString().split(\"T\")[0]:\"\", p.description||\"\", p.image||\"\"\r\n    ]);\r\n    const csvArray = [header, ...rows];\r\n    const csvContent = \"data:text/csv;charset=utf-8,\" + csvArray.map(r => r.map(c => `\"${String(c).replace(/\"/g,'\"\"')}\"`).join(\",\")).join(\"\\n\");\r\n    const encodedUri = encodeURI(csvContent);\r\n    const link = document.createElement(\"a\");\r\n    link.href = encodedUri;\r\n    link.download = `all_prices_${Date.now()}.csv`;\r\n    link.click();\r\n  };\r\n\r\n  const handleExportSelectedCsv = () => {\r\n    if (!selectedItems.length) return alert(\"Select items to export\");\r\n    const selectedData = items.filter((x) => selectedItems.includes(x._id));\r\n    const header = [\"id\",\"name\",\"categoryName\",\"subcategoryName\",\"basePrice\",\"difference\",\"finalPrice\",\"status\",\"validTill\",\"description\",\"imageUrl\"];\r\n    const rows = selectedData.map((p) => [\r\n      p._id, p.name||\"\", p.category?.name||\"\", p.subcategory?.name||\"\", p.basePrice||\"\", p.difference||\"\", (Number(p.basePrice||0) + Number(p.difference||0))||\"\", p.status||\"\", p.validTill?new Date(p.validTill).toISOString().split(\"T\")[0]:\"\", p.description||\"\", p.image||\"\"\r\n    ]);\r\n    const csvArray = [header, ...rows];\r\n    const csvContent = \"data:text/csv;charset=utf-8,\" + csvArray.map(r => r.map(c => `\"${String(c).replace(/\"/g,'\"\"')}\"`).join(\",\")).join(\"\\n\");\r\n    const encodedUri = encodeURI(csvContent);\r\n    const link = document.createElement(\"a\");\r\n    link.href = encodedUri;\r\n    link.download = `selected_prices_${Date.now()}.csv`;\r\n    link.click();\r\n  };\r\n\r\n  const filteredItems = items.filter((item) => {\r\n    const t = (search || \"\").toLowerCase();\r\n    return (item.name||\"\").toLowerCase().includes(t) || (item.category?.name||\"\").toLowerCase().includes(t) || (item.subcategory?.name||\"\").toLowerCase().includes(t);\r\n  });\r\n\r\n  const indexOfLast = currentPage * itemsPerPage;\r\n  const currentItems = filteredItems.slice(indexOfLast - itemsPerPage, indexOfLast);\r\n  const totalPages = Math.max(1, Math.ceil(filteredItems.length / itemsPerPage));\r\n\r\n  return (\r\n    <div className=\"pl-container\">\r\n      <header className=\"pl-header\">\r\n        <h1 className=\"pl-title\">Product Management</h1>\r\n\r\n        {/* search + add button aligned. mobile: same line, compact */}\r\n        <div className=\"pl-top-row\">\r\n          <div className=\"pl-search\">\r\n            <input\r\n              className=\"pl-search-input\"\r\n              type=\"text\"\r\n              placeholder=\"Search product, category or subcategory...\"\r\n              value={search}\r\n              onChange={(e) => { setSearch(e.target.value); setCurrentPage(1); }}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"pl-add-wrap\">\r\n            <button\r\n              className=\"pl-add-btn\"\r\n              onClick={() => { setShowForm(!showForm); setEditId(null); setIsCopyMode(false); }}\r\n            >\r\n              {showForm ? \"‚úñ Close Form\" : \"‚ûï Add Product\"}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </header>\r\n\r\n      {/* CSV & bulk area (compact on mobile) */}\r\n      <div className=\"pl-csv-controls\">\r\n        <div className=\"pl-csv-left\">\r\n          <input ref={csvInputRef} className=\"pl-file\" type=\"file\" accept=\".csv\" onChange={(e)=>setCsvFile(e.target.files[0])} />\r\n          <button className=\"pl-btn small\" onClick={() => {\r\n            if (!csvFile) return alert(\"Choose CSV\");\r\n            const fd = new FormData(); fd.append(\"file\", csvFile); axios.post(`${API_URL}/import`, fd).then(res => { alert(\"Imported\"); fetchItems(); if (csvInputRef.current) csvInputRef.current.value=null; setCsvFile(null); }).catch(()=>alert(\"Import failed\"));\r\n          }}>Import CSV</button>\r\n        </div>\r\n\r\n        <div className=\"pl-csv-right\">\r\n          <button className=\"pl-btn\" onClick={handleExportCsv}>Export All CSV</button>\r\n          <button className=\"pl-btn small\" onClick={handleExportSelectedCsv}>Export Selected CSV</button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* table card (background removed as requested) */}\r\n      <div className=\"pl-table-card\">\r\n        <div className=\"pl-table-header\">\r\n          <h2 className=\"pl-items-title\">üìã Items</h2>\r\n          <div className=\"pl-total\">Total: {filteredItems.length}</div>\r\n        </div>\r\n\r\n        <div className=\"pl-table-wrapper\">\r\n          <table className=\"pl-table\">\r\n            <thead>\r\n              <tr>\r\n                <th><input type=\"checkbox\" checked={selectedItems.length === filteredItems.length && filteredItems.length > 0} onChange={() => { if (selectedItems.length === filteredItems.length) setSelectedItems([]); else setSelectedItems(filteredItems.map(x=>x._id)); }} /></th>\r\n                <th>Sr</th>\r\n                <th>Image</th>\r\n                <th className=\"col-name\">Name</th>\r\n                <th>Category</th>\r\n                <th>Subcat</th>\r\n                <th>Base</th>\r\n                <th>Diff</th>\r\n                <th>Final</th>\r\n                <th>Status</th>\r\n                <th>Valid Till</th>\r\n                <th>Actions</th>\r\n              </tr>\r\n            </thead>\r\n\r\n            <tbody>\r\n              {currentItems.map((item, i) => (\r\n                <tr key={item._id} className=\"pl-row\">\r\n                  <td><input type=\"checkbox\" checked={selectedItems.includes(item._id)} onChange={() => setSelectedItems(prev => prev.includes(item._id) ? prev.filter(x=>x!==item._id) : [...prev, item._id])} /></td>\r\n                  <td>{(currentPage - 1) * itemsPerPage + (i + 1)}</td>\r\n                  <td className=\"pl-imgcell\">{item.image ? <img className=\"pl-img\" src={item.image} alt=\"\" /> : <div className=\"pl-noimg\">No Img</div>}</td>\r\n\r\n                  {/* name column allows wrap and keeps consistent height */}\r\n                  <td className=\"pl-namecell\">\r\n                    <div className=\"pl-name-text\">{item.name || \"-\"}</div>\r\n                    {item.description ? <div className=\"pl-name-sub\">{item.description}</div> : null}\r\n                  </td>\r\n\r\n                  <td>{item.category?.name || \"-\"}</td>\r\n                  <td>{item.subcategory?.name || \"-\"}</td>\r\n\r\n                  <td>‚Çπ{item.basePrice}</td>\r\n                  <td>{item.difference || 0}</td>\r\n                  <td>‚Çπ{Number(item.basePrice || 0) + Number(item.difference || 0)}</td>\r\n\r\n                  <td>\r\n                    <button className={`pl-status ${item.status === \"active\" ? \"active\" : \"inactive\"}`} onClick={() => {\r\n                      const newStatus = item.status === \"active\" ? \"inactive\" : \"active\";\r\n                      axios.put(`${API_URL}/status/${item._id}`, { status: newStatus }).then(()=> setItems(prev => prev.map(x => x._id === item._id ? {...x, status: newStatus} : x))).catch(()=>alert(\"Status update failed\"));\r\n                    }}>{item.status === \"active\" ? \"Active\" : \"Inactive\"}</button>\r\n                  </td>\r\n\r\n                  <td>{item.validTill ? new Date(item.validTill).toLocaleDateString() : \"-\"}</td>\r\n\r\n                  <td className=\"pl-actioncell\">\r\n                    <div className=\"pl-action-wrap\">\r\n                      <button className=\"pl-menu-btn\" onClick={() => setActiveMenu(activeMenu === item._id ? null : item._id)}>‚ãÆ</button>\r\n                      {activeMenu === item._id && (\r\n                        <div className=\"pl-dropdown\">\r\n                          <button className=\"pl-dropdown-item\" onClick={() => { handleEdit(item); setActiveMenu(null); }}>‚úè Edit</button>\r\n                          <button className=\"pl-dropdown-item\" onClick={() => { setIsCopyMode(true); handleCopyToEdit(item); setActiveMenu(null); }}>üìÑ Copy</button>\r\n                          <button className=\"pl-dropdown-item danger\" onClick={() => { if (window.confirm(\"Delete?\")) { axios.delete(`${API_URL}/${item._id}`).then(()=> { setItems(prev => prev.filter(x=>x._id !== item._id)); setActiveMenu(null); }).catch(()=>alert(\"Delete failed\")); } }}>üóë Delete</button>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </td>\r\n                </tr>\r\n              ))}\r\n\r\n              {currentItems.length === 0 && (\r\n                <tr><td colSpan=\"12\" className=\"pl-no-data\">No items found</td></tr>\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n\r\n        <div className=\"pl-pagination\">\r\n          <button className=\"pl-page-btn\" disabled={currentPage === 1} onClick={() => setCurrentPage(p => p - 1)}>Previous</button>\r\n          {Array.from({ length: totalPages }, (_, i) => (\r\n            <button key={i} className={`pl-page-btn ${currentPage === i+1 ? \"active\" : \"\"}`} onClick={() => setCurrentPage(i+1)}>{i+1}</button>\r\n          ))}\r\n          <button className=\"pl-page-btn\" disabled={currentPage === totalPages} onClick={() => setCurrentPage(p => p + 1)}>Next</button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* EDIT / COPY modal & form remain same as your implementation */}\r\n    </div>\r\n  );\r\n\r\n  // small helper functions inside (kept local for brevity)\r\n  function handleEdit(item) {\r\n    setForm({\r\n      name: item.name || \"\",\r\n      category: item.category?._id?.toString() || \"\",\r\n      subcategory: item.subcategory?._id?.toString() || \"\",\r\n      description: item.description || \"\",\r\n      basePrice: item.basePrice ?? \"\",\r\n      difference: item.difference ?? \"\",\r\n      validTill: item.validTill ? item.validTill.split(\"T\")[0] : \"\",\r\n      file: null,\r\n    });\r\n    const cat = categories.find((c) => c._id === item.category?._id);\r\n    setSubcategories(cat?.subcategories || []);\r\n    setEditId(item._id);\r\n    setIsCopyMode(false);\r\n    setShowModal(true);\r\n    setActiveMenu(null);\r\n  }\r\n\r\n  function handleCopyToEdit(item) {\r\n    setForm({\r\n      name: item.name || \"\",\r\n      category: item.category?._id?.toString() || \"\",\r\n      subcategory: item.subcategory?._id?.toString() || \"\",\r\n      description: item.description || \"\",\r\n      basePrice: item.basePrice ?? \"\",\r\n      difference: item.difference ?? \"\",\r\n      validTill: item.validTill ? item.validTill.split(\"T\")[0] : \"\",\r\n      file: null,\r\n    });\r\n    const cat = categories.find((c) => c._id === item.category?._id);\r\n    setSubcategories(cat?.subcategories || []);\r\n    setEditId(null);\r\n    setIsCopyMode(true);\r\n    setShowModal(true);\r\n    setActiveMenu(null);\r\n  }\r\n}\r\n"],"mappings":";;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}